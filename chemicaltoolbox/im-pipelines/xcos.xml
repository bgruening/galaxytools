<tool id="xcos_scoring" name="Enumerate changes" version="0.1">
    <description>shape and feature overlays</description>
    <macros>
        <import>macros.xml</import>
        <token name="@GALAXY_VERSION@">0</token>
    </macros>
    <expand macro="requirements" />
    <command detect_errors="exit_code">
<![CDATA[
        python -m pipelines.xchem.xcos
            -f '$fragments' --fragments-format sdf
            -i '$poses' -if sdf
            -o output -of sdf
            --no-gzip &&
            mv output.sdf '$output'
]]>
    </command>
    <inputs>
        <param name="poses" format="sdf" type="data" label="Poses to score" help="In SDF format"/>
        <param name="fragments" format="sdf" type="data" label="Fragments to compare" help="In SDF format"/>
    </inputs>
    <outputs>
        <data format="sdf" name="output" label="The scored ligands"/>
    </outputs>
    <tests>
        <test>
            <param name="poses" ftype='sdf' value="poses.sdf" />
            <param name="fragments" ftype='sdf' value="hits-17.sdf" />
            <output name="output" ftype="sdf">
                <assert_contents>
                    <has_text text="XCos_Score1" />
                    <has_text text="XCos_Score2" />
                    <has_text text="XCos_Score3" />
                </assert_contents>
            </output>
        </test>
    </tests>
    <help>
<![CDATA[

.. class:: infomark

**What this tool does**

XCos is a reverse shape and feature overlap score for a pose compared to a set of ligands that identifies which ligands
best overlap.
The molecule is fragmented using the BRICS algorithm and each fragment (bit) is compared to the ligands using the SuCOS
methodology. The resulting scores are the combined scores of the bits.

XCoseScore1 - XCOS-Heavy: Sum of each bit overlay score scaled by the number of heavy atoms in bit
XCoseScore2 - XCOS-Heavy penalised by XCOS-Feat
XCoseScore3 - XCOS-Feat: Fraction of matching features to the clustered features within a distance threshold

XCos was conceived and implemented by Warren Thompson <warren.thompson@diamond.ac.uk>.
The original code can be found here: https://github.com/Waztom/xchem-XCOS

-----

.. class:: infomark

**Input**

- poses: SD-file of ligand poses to score
- fragments: SD-file of fragments to compare the poses

-----

.. class:: infomark

 **Output**

SD-file with the XCos scores added.


]]>
    </help>
    <expand macro="citations" />
</tool>
