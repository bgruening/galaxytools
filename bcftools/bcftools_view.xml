<tool id="bcftools_view" name="bcftools view" version="0.1.19.0">
    <description>Converts BCF format to VCF format</description>
    <requirements>
        <requirement type="package" version="0.1.19">samtools</requirement>
    </requirements>
    <command>
        bcftools view
            --output-type $output_format
            $A
            #if str( $b ) == "true":
                -b
            #end if

            #if $D.seq_dictionary == "true":
                    -D "$D.input"
            #end if

            #if $i.alt_indel_snp_ratio == "true":
                -i $i.ratio
        #end if
            #if $p.variant_filter == "true":
                -p $p.float_value
        #end if
            #if $t.mutation_rate == "true":
                -t $t.rate
        #end if
            #if str( $v ) == "true":
                -v
        #end if

        $input

        > $output
    </command>
    <inputs>
        <param name="input" type="data" format="bcf,vcf" label="Choose a bcf file to view" />

        <param name="A" type="boolean" truevalue="-A" falsevalue="" checked="False"
             label="Retain all possible alternate alleles at variant sites" help="(-A)" />

        <param name="output_format" type="select" label="Choose the output format" help="(-b)">
            <option value="b">BCF</option>
            <option value="v" selected="true">VCF</option>
        </param>

        <conditional name="D">
            <param name="seq_dictionary" type="select" label="Sequence dictionary (list of chromosome names) for VCF->BCF conversion" help="(-D)">
                <option value="true">Yes</option>
                <option value="false" selected="true">No</option>
            </param>
            <when value="true">
                <param name="input" type="data" format="tabular" label="Sequence dictionary" />
            </when>
        </conditional>

        <param name="F" type="boolean" truevalue="-F" falsevalue="" checked="False"
            label="Indicate PL is generated by r921 or before (ordering is different)" help="(-F)" />

        <param name="G" type="boolean" truevalue="-G" falsevalue="" checked="False"
            label="Suppress all individual genotype information" help="(-G)" />

        <param name="N" type="boolean" truevalue="-N" falsevalue="" checked="False"
            label="Skip sites where the REF field is not A/C/G/T" help="(-N)" />


        <param name="u" type="boolean" truevalue="-u" falsevalue="" checked="False"
                label="Uncompressed BCF output" help="(-u)" />

        <param name="c" type="boolean" truevalue="-c" falsevalue="" checked="True"
            label="Call variants using Bayesian inference. Automatically performs max-likelihood inference only" help="(-c)" />

        <param name="e" type="boolean" truevalue="-e" falsevalue="" checked="False"
            label="Perform max-likelihood inference only, including estimating the site allele frequency, testing Hardy-Weinberg equilibrium and testing associations with LRT."
            help="(-e)" />

        <param name="g" type="boolean" truevalue="-g" falsevalue="" checked="True"
            label="Call per-sample genotypes at variant sites" help="(-g)" />

        <conditional name="i">
            <param name="alt_indel_snp_ratio" type="select" label="Use alternate INDEL-to-SNP mutation rate, default 0.15" help="(-i)">
                <option value="true">Yes</option>
                <option value="false" selected="true">No</option>
            </param>
            <when value="true">
                <param name="ratio" type="float" label="Ratio" value="0.15" />
            </when>
        </conditional>

        <conditional name="t">
            <param name="mutation_rate" type="select" label="Specify scaled mutation rate for variant calling, default is 0.001.">
                <option value="true">Yes</option>
                <option value="false" selected="true">No</option>
            </param>
            <when value="true">
                <param name="rate" type="float" label="Mutation Rate (float)" value="0.001" />
            </when>
        </conditional>
        <param name="v" type="select" label="Output variant sites only.">
            <option value="true" selected="true">Yes</option>
            <option value="false">No</option>
        </param>
    </inputs>
    <outputs>
        <data format="bcf" name="output">
            <change_format>
                <when input="output_format" value="v" format="vcf" />
            </change_format>
        </data>
    </outputs>
    <help>
**What it does:** 

This tool converts BCF files into VCF files using *bcftools view* tool from SAMtools:

http://samtools.github.io/bcftools/

------

**Citation:**

For the underlying tool, please cite `Li H, Handsaker B, Wysoker A, Fennell T, Ruan J, Homer N, Marth G, Abecasis G, Durbin R; 1000 Genome Project Data Processing Subgroup. The Sequence Alignment/Map format and SAMtools. Bioinformatics. 2009 Aug 15;25(16):2078-9. &lt;http://www.ncbi.nlm.nih.gov/pubmed/19505943&gt;`_


If you use this tool within Galaxy, please cite 

    </help>
</tool>
