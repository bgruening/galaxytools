<tool id="chicago_peak_matrix" name="Create peak matrix" version="0.1.0">
    <requirements>
        <requirement type="package" version="1.2.0">Chicago</requirement>
        <requirement type="package" version="1.2.0">chicagotools</requirement>
        <requirement type="package" version="2.24">bedtools</requirement>
        <requirement type="package" version="2.3.1">cran</requirement>
    </requirements>
    <stdio>
        <exit_code range="1:" />
    </stdio>
    <command><![CDATA[
        makePeakMatrix.R $twopass $input $output-prefix
        $advanced_options.notrans 
        $advanced_options.vanilla
        $advanced_options.lessthan
        $advanced_options.rda 
        #if $advanced_options.var:
            --var $advanced_options.var
        #end if
        #if $advanced_options.scorecol:
            --scorecol $advanced_options.scorecol
        #end if
        #if $advanced_options.cutoff:
            --cutoff $advanced_options.cutoff
        #end if
        #if $advanced_options.fetchcol:
            --fetchcol $advanced_options.fetchcol
        #end if
        #if $advanced_options.maxdist:
            --maxdist $advanced_options.maxdist
        #end if
        #if $advanced_options.digestmap:
            --digestmap $advanced_options.digestmap
        #end if
        #if $advanced_options.baitmap:
            --baitmap $advanced_options.baitmap
        #end if
        #if $advanced_options.peaklist:
            --peaklist $advanced_options.peaklist
        #end if
        #if $advanced_options.clustmethod:
            --clustmethod $advanced_options.clustmethod
        #end if
        #if $advanced_options.clustsubset:
            --clustsubset $advanced_options.clustsubset
        #end if
    ]]></command>
    <inputs>
    <param name="input" type="data" label="Input" help="Tab-separated file with sample names (1st column) and full paths to input Rds files (2nd column)"/>
    <param name="output-prefix" type="text" value="" label="Outprefix" help="All output files will have this prefix."/>
    <param argument="--twopass" type="boolean" truevalue="--twopass" falsevalue="" label="Two pass" help="First obtain a list of significant interactions as a union of peaks in each dataset, then reload and subset for these interactions prior to merging. Slower but uses significantly less memory."/>
    <section name="advanced_options" title="Advanced options">
        <param argument="--notrans" type="boolean" truevalue="--notrans" falsevalue="" label="No trans-chromosomal interactions" help="Exclude trans-chromosomal interactions from the peak matrix (an alternative, but faster way to save memory compared with --twopass)"/>
        <param argument="--vanilla" type="boolean" truevalue="--vanilla" falsevalue="" label="Input is only having data frames and no Chicago objects" help="A flag indicating that the input RDa/RDS images contain only the data frames and not Chicago objects. In this case, the --digestmap and --baitmap options are required "/>
        <param argument="--rda" type="boolean" truevalue="--rda" falsevalue="" label="Load data from an RDa archive " help="Load data from an RDa archive rather than the default Rds. In this case, the name of the variable in the RDa containing the image is given by the --var option (see below)."/>
        <param argument="--var" type="text" value="x" label="ChicagoObject variable name" help="The name of the variable containing the chicagoData object or the peak data frame in the RDa images (default: x)"/>
        <param argument="--scorecol" type="text" value="score" label="Column name" help="The column name in the chicagoData@x slot or the input data frame containing the Chicago scores (default: score). Note that this also allows to create peak matrices for entities other than Chicago scores (e.g., the raw or normalised reads)."/>
        <param argument="--cutoff" type="text" value="" label="Cutoff signal value" help="The scorecol signal cutoff"/>
        <param argument="--fetchcol" type="text" value="" label="Select column to collect information" help="Instead of collecting scores for the peak matrix, choose the name of a different column to collect information from. scorecol is still used to threshold interactions. Note that if fetchcol is different from scorecol, the --twopass mode will be enforced."/>
        <param argument="--lessthan" type="boolean" truevalue="--lessthan" falsevalue="" label="Choose values below threshold" help="Pick interactions with scorecol below the cutoff rather than above"/>
        <param argument="--maxdist" type="text" value="" label="Max distance" help="Max distance from bait to include into the peak matrix"/>
        <param argument="--digestmap" type="data" value="" label="Digest map" help="Full path to digest map file; will override settings from chicagoData if provided. Required for --vanilla."/>
        <param argument="--baitmap" type="data" value="" label="Bait map" help="Full path to bait map ID file; will override settings from chicagoData even if provided. Required for --vanilla."/>
        <param argument="--peaklist" type="data" value="" label="Predefined peak list" help="Use a predefined peak list (such as the one generated by the first pass of the --twopass mode)"/>
        <param argument="--clustmethod" type="select" label="Choose clustering method" help="The clustering method to use for clustering columns (average/ward.D2/complete) (default: average)">
            <option value="average" selected="True">average</option>
            <option value="ward.D2">ward.D2</option>
            <option value="complete">complete</option>
        </param>
        <param argument="--clustsubset" type="text" value="1e+06" label="Number of interactions  " help="Number of interactions to randomly subset for clustering. Full dataset used if total number of interactions in the peak matrix is below this number. (default: 1e+06)"/>
    </section>
    </inputs>
    <outputs>
        <data format="txt" name="digest_file">
            <discover_datasets pattern="__designation_and_ext__" visible="true" />
        </data>
    </outputs>
    <help><![CDATA[
        TODO: Fill in help.
    ]]></help>
</tool>
