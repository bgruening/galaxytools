<tool id="chicago_reestimate_p_value" name="Reestimate p-value" version="0.1.0">
    <requirements>
        <requirement type="package" version="1.2.0">Chicago</requirement>
        <requirement type="package" version="1.2.0">chicagotools</requirement>
        <requirement type="package" version="2.24">bedtools</requirement>
        <requirement type="package" version="2.3.1">cran</requirement>
    </requirements>
    <stdio>
        <exit_code range="1:" />
    </stdio>
    <command><![CDATA[
        fitDistCurve.R $cell_type $ouput-prefix
        #if $input_option.input_option_selection == "inputsOption":
            --inputs $inputs
        #elif $input_option.input_option_selection == "inputSummaryOption":
            --summaryInput $summaryInput
        #end if
        #if $opts:
            --opts $opts
        #end if
        --threshold $threshold
        --subsets $subsets
        --largeBinSize $bins_parameters.largeBinSize
        --binNumber $bins_parameters.binNumber
        --halfNumber $bins_parameters.halfNumber
    ]]></command>
    <inputs>
        <param name="cell_type" type="text" value="" label="Cell type" help="Define the name of your cell type for a correct naming schema."/>  
        <param name="output-prefix" type="text" value="" label="" help="All output files will begin with the value of this argument."/>
        <param argument="--opts" type="data" value="" format="RDS" label="Argument value file" help="RDS file containing argument values"/>
        <conditional name="input_option">
            <param name="input_option_selection" type="select" label="Select to use input files or an input summary">
                <option value="inputsOption"></option>
                <option value="inputSummaryOption"></option>
            </param>
            <when value="inputsOption">
                <param argument="--inputs" type="data" format="Rda" value="" multiple="true" label="Chicago data objects" help="ChicagoData objects, in either .Rda or .Rds form. If .Rda, there must be only one chicagoData object in the file."/>
            </when>
            <when value="inputSummaryOption">
                <param argument="--summaryInput" type="data" value="" format="rda" label="Summary Input" help="An .Rda file of summary information -- the max P-val for each putative interaction, and the location of the .rmap file. This file will be generated if it wasn't provided."/>
            </when>
        </conditional>
        <param argument="--threshold" type="text" value="-10" label="Threshold" help="Threshold applied to log(p) values (NB: not the CHiCAGO score!). In other words, log(p) must be below this value in all of the samples. [default: -10]"/>
        <param argument="--subsets" type="text" value="5" label="Subsets" help="To ensure robustness, the data are partitioned into approximately equal subsets. Parameters are estimated separately on each subset. Then, an estimate for each parameter is derived from its median value across subsets. The number of subsets is controlled by this argument. [default: 5]"/>
        <section name="bins_parameters" title="Bins parameters" help="Parameters pertaining to the bins used in the analysis. Default breaks occur at 0, 31.25k, 62.5k, 125k, 250k, 500k, 1m, 2m, 3m, 4m, ..., 16m. The breaks are constructed by taking [binNumber] bins of size [largeBinSize], then breaking the first bin into two, iterating [halfNumber] times. [default: 1000000, 16, 5]">
            <param argument="--largeBinSize" type="text" value="1000000" label="Large bin size" help="Largest bin size to consider [default: 1000000]"/>
            <param argument="--binNumber" type="text" value="10" label="Number of bins" help="Number of large bins [default: 16]"/>
            <param argument="--halfNumber" type="text" value="5" label="Half number" help="First bin is subdivided into halves - the number of times to do this [default: 5]"/>
        </section>
    </inputs>
    <outputs>
        <data format="txt" name="digest_file">
            <discover_datasets pattern="__designation_and_ext__" visible="true" />
        </data>
    </outputs>
    <help><![CDATA[
        TODO: Fill in help.
    ]]></help>
</tool>