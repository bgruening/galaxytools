<tool id="chicago_run_chicago" name="Run CHiCAGO" version="0.1.0">
    <requirements>
        <requirement type="package" version="1.2.0">Chicago</requirement>
        <requirement type="package" version="1.2.0">chicagotools</requirement>
        <requirement type="package" version="2.24">bedtools</requirement>
        <requirement type="package" version="2.3.1">cran</requirement>
    </requirements>
    <stdio>
        <exit_code range="1:" />
    </stdio>
    <command><![CDATA[
        #if $advanced_options.design_dir_extensions
            mkdir design_dir
            ln -s '$advanced_options.design_dir_extensions' design_dir/$advanced_options.design_dir_extensions
        && 
        runChicago.R --design-dir design_dir 
        
        #if $advanced_options.rda
            --rda
        #end if
        #if $advanced_options.save-df-only
            --save-df-only 
        #end if
        #if $advanced_options.examples-full-range
            --examples-full-range 
        #end if
        #if $advanced_options.settings-file
            --settings-file $advanced_options.settings-file 
        #end if
        #if $advanced_options.cutoff
            --cutoff $advanced_options.cutoff 
        #end if
        #if $advanced_options.export-format
            --export-format $advanced_options.export-format 
        #end if
        #if $advanced_options.export-order
            --export-order $advanced_options.export-order 
        #end if
        #if $advanced_options.examples-prox-dist
            --examples-prox-dist $advanced_options.examples-prox-dist 
        #end if
        #if $advanced_options.en-feat-list
            --en-feat-list $advanced_options.en-feat-list 
        #end if
        #if $advanced_options.en-feat-files
            --en-feat-files $advanced_options.en-feat-files 
        #end if
        $advanced_options.en-full-cis-range
        #if $advanced_options.en-trans
            --en-trans 
        #end if
        #if $advanced_options.en-min-dist
            --en-min-dist $advanced_options.en-min-dist 
        #end if
        #if $advanced_options.en-max-dist
            --en-max-dist $advanced_options.en-max-dist 
        #end if
        #if $advanced_options.en-sample-no
            --en-sample-no $advanced_options.en-sample-no 
        #end if
        #if $advanced_options.features-only
            --features-only 
        #end if
        #if $advanced_options.design_dir_extensions
            --design_dir design_dir 
        #end if
         --inputFiles $input-files
        &&
        #if $advanced_options.design_dir_extensions
            rm -rf design_dir
        #end if
    ]]></command>
    <inputs>
    <param argument="--inputFiles" type="data" format="chinput" label="Chinput file" help="A single .chinput file (produced by bam2chicago.sh or any other method) or multiple file names 
corresponding to the multiple biological replicates of the same experimental condition. Note that technical replicates should 
instead be deduplicated and pooled prior to running bam2chicago and submitted as a single .chinput file.   "/>
    <section name="advanced_options" title="Advanced options">
        <param argument="--design_dir_extensions" type="data" format="baitmap,rmap,npb,nbpb,poe" label="Corresponding extensions" help="File that should be placed in a design folder. Exactly one file is accepted. The file corresponds to the extensions."/>
        <param argument="--rda" type="boolean" value="False" label="Save data as an object" help="Save the image of the chicagoData object as an RDa (under the name cd) rather than an Rds file" />
        <param argument="--save-df-only" type="boolean" value="False" label="Save only the data table." help="Save the image of only the data table part of the chicagoData object (```cd@x```) as a data frame (i.e., converting from 
    data.table to data frame.)"/>
        <param argument="--examples-full-range" type="boolean" value="False" label="Examples full range" help="In addition to plotting interactions within 1Mb from baits, also plot the same for the full distance range"/>
        <param argument="--settings-file" type="data" value="" label="Custom settings" help="File with costum settings for CHiCAGO"/>
        <param argument="--cutoff" type="integer" value="5" label="Cutoff" help="A signal cutoff to use for significant interactions [default: 5]"/>
        <param argument="--export-format" type="text" value="washU_text" label="Export format(s)" help="File format for writing out peaks: one or more of the following: seqMonk,interBed,washU_text,washU_track (comma-separated) 
    [default: washU_text"/>
        <param argument="--export-order" type="select" label="Export order" help="Should the results be ordered by 'score' or genomic 'position'? [default: position]   ">
            <option value="score">Score</option>
            <option value="position" selected="True">Position</option>
        </param>
        <param argument="--examples-prox-dist" type="text" value="1Mb" label="Distance limit for plottin" help="The distance limit for plotting 'proximal' examples [default: 1Mb]"/>
        <param argument="--en-feat-list" type="text" value="" label="Feature list" help="The name of the feature list file of the format 'feature-name' 'feature-bed-file-location', where feature-bed-files  
    contain the genomic coordinates of the features to compute the enrichment at Chicago significant interactions 
    (Chicago signal cutoff 5 is used by default)."/>
        <param argument="--en-feat-files" type="data" value="" label="Feature files" help="A comma-separated list of files with genomic feature coordinates for computing peaks' enrichment (to provide them explicitly 
    instead of using the --en-feat-list option)"/>
        <param argument="--en-full-cis-range" type="boolean" value="False" truevalue="--en-full-cis-range" falsevalue="" label="Full cis range" help="Assess the enrichment for features for the full distance range (same chromosome only; use --en-trans in addition to include trans-interactions). Can be very slow!"/>
        <param argument="--en-trans" type="boolean" value="False" label="" help="Include trans-interactions into enrichment analysis   "/>
        <param argument="--en-min-dist" type="integer" value="0" label="Lower distance limit" help="The lower distance limit for computing enrichment for features (default: 0)  "/>
        <param argument="--en-max-dist" type="text" value="1Mb" label="" help="The upper distance limit for computing enrichment for features (default: 1Mb) "/>
        <param argument="--en-sample-no" type="integer" value="100" label="Number of negative samples" help="The number of negative samples, over which to compute the enrichment for features (default: 100)   "/>
        <param argument="--features-only" type="boolean" value="False" label="" help="Re-run feature enrichment analysis with Chicago output files. 
    With this option, 'input-files' must be either a single Rds file (must contain full Chicago objects) or '-', 
    in which case the file location will be inferred automatically from 'output-prefix' and files added to the corresponding folder."/>
    </section>
    </inputs>
    <outputs>
        <data format="txt" name="digest_file">
            <discover_datasets pattern="__designation_and_ext__" visible="true" />
        </data>
    </outputs>
    <help><![CDATA[
    ]]></help>
</tool>
