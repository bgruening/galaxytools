<tool id="tp_sort_header_tool" name="Sort" version="@TOOL_VERSION@+galaxy3" profile="@PROFILE@">
    <description>data in ascending or descending order</description>
    <macros>
        <import>macros.xml</import>
    </macros>
    <expand macro="creator"/>
    <expand macro="requirements">
        <requirement type="package" version="4.9">sed</requirement>
    </expand>
    <version_command>sort --version | head -n 1</version_command>
    <command>
<![CDATA[
        (
            export LC_ALL=C;
            #if int($header) > 0:
                sed -u '${header}'q &&
            #end if

            sort $unique $ignore_case --stable -t '	'

            #for $key in $sortkeys:
                #if str($key.mode.mode_select) == "basic"
                    -k '${key.start_column},${key.end_column}${key.order}${key.style}'
                #else
                    #if $key.mode.start_char and $key.mode.end_char
                        -k '${key.start_column}.${key.mode.start_char},${key.end_column}.${key.mode.end_char}${key.order}${key.style}'
                    #elif $key.mode.start_char
                        -k '${key.start_column}.${key.mode.start_char},${key.end_column}${key.order}${key.style}'
                    #elif $key.mode.end_char
                        -k '${key.start_column},${key.end_column}.${key.mode.end_char}${key.order}${key.style}'
                    #else
                        -k '${key.start_column},${key.end_column}${key.order}${key.style}'
                    #end if
                #end if
            #end for

        ) < '${infile}' > '${outfile}'
]]>
    </command>
    <inputs>
        <param format="tabular" name="infile" type="data" label="Sort Query" />
        <param name="header" type="integer" value="0"
            label="Number of header lines" help="These will be ignored during sort.">
            <validator type="in_range" message="Negative values are not allowed." min="0"/>
        </param>
        
        <repeat name="sortkeys" title="Column selections" min="1">
            <param name="start_column" label="Start column" type="data_column" data_ref="infile" accept_default="true" />
            <param name="end_column" label="End column" type="data_column" data_ref="infile" accept_default="true" />
            <conditional name="mode">
                <param name="mode_select" type="select" label="Choose between basic and advanced mode" help="The advanced mode allows you to set start and end sorting characters for the corresponding columns">
                    <option value="basic">Basic</option>
                    <option value="advanced">Advanced</option>
                </param>
                <when value="advanced">
                    <param name="start_char" label="Start character" type="integer" min="1" optional="true" help="The start character in the chosen start column" />
                    <param name="end_char" label="End character" type="integer" min="1" optional="true" help="The end character in the chosen end column" />
                </when>
                <when value="basic">
                </when>
            </conditional>
            <param name="order" type="select" display="radio" label="in">
                <option value="">Ascending order</option>
                <option value="r">Descending order</option>
            </param>
            <param name="style" type="select" display="radio" label="Flavor">
                <option value="n">Fast numeric sort (-n)</option>
                <option value="g">General numeric sort ( scientific notation -g)</option>
                <option value="V">Natural/Version sort (-V) </option>
                <option value="">Alphabetical sort</option>
                <option value="h">Human-readable numbers (-h)</option>
                <option value="R">Random order (-R)</option>
            </param>
        </repeat>

        <param name="unique" type="boolean" checked="false" truevalue="--unique" falsevalue=""
            label="Output unique values" help="Print only unique values, based on sorted key columns. See help section for details. (--unique)" />
        <param name="ignore_case" type="boolean" checked="false" truevalue="-i" falsevalue=""
            label="Ignore case" help="Sort and Join key column values regardless of upper/lower case letters. (-i)" />
    </inputs>
    <outputs>
        <data name="outfile" format_source="infile" metadata_source="infile"/>
    </outputs>
    <tests>
        <test expect_num_outputs="1">
            <param name="infile" value="sort1.bed"/>
            <param name="header" value="3"/>
            <repeat name="sortkeys">
                <param name="start_column" value="1"/>
                <param name="end_column" value="1"/>
                <conditional name="mode">
                    <param name="mode_select" value="basic"/>
                </conditional>
                <param name="style" value=""/>
                <param name="order" value=""/>
            </repeat>
            <repeat name="sortkeys">
                <param name="start_column" value="3"/>
                <param name="end_column" value="3"/>
                <conditional name="mode">
                    <param name="mode_select" value="basic"/>
                </conditional>
                <param name="style" value="n"/>
                <param name="order" value="r"/>
            </repeat>
            <output name="outfile" file="sort_result1.bed"/>
        </test>
        <test expect_num_outputs="1">
            <param name="infile" value="sort1.bed"/>
            <param name="header" value="3"/>
            <repeat name="sortkeys">
                <param name="start_column" value="1"/>
                <param name="end_column" value="1"/>
                <conditional name="mode">
                    <param name="mode_select" value="basic"/>
                </conditional>
                <param name="style" value=""/>
                <param name="order" value=""/>
            </repeat>
            <repeat name="sortkeys">
                <param name="start_column" value="3"/>
                <param name="end_column" value="3"/>
                <conditional name="mode">
                    <param name="mode_select" value="basic"/>
                </conditional>
                <param name="style" value="n"/>
                <param name="order" value=""/>
            </repeat>
            <output name="outfile" file="sort_result2.bed"/>
        </test>
        <test expect_num_outputs="1">
            <param name="infile" value="sort2.bed"/>
            <repeat name="sortkeys">
                <param name="start_column" value="5"/>
                <param name="end_column" value="5"/>
                <conditional name="mode">
                    <param name="mode_select" value="basic"/>
                </conditional>
                <param name="style" value="g"/>
                <param name="order" value=""/>
            </repeat>
            <output name="outfile" file="sort_result3.bed"/>
        </test>
        <test expect_num_outputs="1">
            <param name="infile" value="sort3.tabular"/>
            <param name="header" value="0"/>
            <param name="unique" value="false"/>
            <param name="ignore_case" value="false"/>
            <repeat name="sortkeys">
                <param name="start_column" value="2"/>
                <param name="end_column" value="2"/>
                <conditional name="mode">
                    <param name="mode_select" value="advanced"/>
                    <param name="start_char" value="7"/>
                    <param name="end_char" value="10"/>
                </conditional>
                <param name="order" value=""/>
                <param name="style" value="n"/>
            </repeat>
            <repeat name="sortkeys">
                <param name="start_column" value="2"/>
                <param name="end_column" value="2"/>
                <conditional name="mode">
                    <param name="mode_select" value="advanced"/>
                    <param name="start_char" value="4"/>
                    <param name="end_char" value="5"/>
                </conditional>
                <param name="order" value=""/>
                <param name="style" value="n"/>
            </repeat>
            <repeat name="sortkeys">
                <param name="start_column" value="2"/>
                <param name="end_column" value="2"/>
                <conditional name="mode">
                    <param name="mode_select" value="advanced"/>
                    <param name="start_char" value="1"/>
                    <param name="end_char" value="2"/>
                </conditional>
                <param name="order" value="r"/>
                <param name="style" value="n"/>
            </repeat>
            <output name="outfile" file="sorted3.tabular" ftype="tabular" />
        </test>
    </tests>
    <help>
<![CDATA[
**What it does**

This tool sorts an input file.

-----

**Sorting Styles**

* **Fast Numeric**: sort by numeric values. Handles integer values (e.g. 43, 134) and decimal-point values (e.g. 3.14). *Does not* handle scientific notation (e.g. -2.32e2).
* **General Numeric**: sort by numeric values. Handles all numeric notations (including scientific notation). Slower than *fast numeric*, so use only when necessary.
* **Natural Sort**: Sort in 'natural' order (natural to humans, not to computers). See example below.
* **Alphabetical sort**: Sort in strict alphabetical order. See example below.
* **Human-readable numbers**: Sort human readble numbers (e.g. 1G > 2M > 3K > 400)
* **Random order**: return lines in random order.

------

**Example - Header line**

**Input file** (note first line is a header line, should not be sorted)::

    Fruit   Color   Price
    Banana  Yellow  4.1
    Avocado Green   8.0
    Apple   Red     3.0
    Melon   Green   6.1

**Sorting** by **numeric order** on column **3**, with **header**, will return::

    Fruit   Color   Price
    Apple   Red     3.0
    Banana  Yellow  4.1
    Melon   Green   6.1
    Avocado Green   8.0


-----

**Example - Natural vs. Alphabetical sorting**

Given the following list::

    chr4
    chr13
    chr1
    chr10
    chr20
    chr2

**Alphabetical sort** would produce the following sorted list::

    chr1
    chr10
    chr13
    chr2
    chr20
    chr4

**Natural Sort** would produce the following sorted list::

    chr1
    chr2
    chr4
    chr10
    chr13
    chr20


.. class:: infomark

If you're planning to use the file with another tool that expected sorted files (such as *join*), you should use the **Alphabetical sort**,  not the **Natural Sort**. Natural sort order is easier for humans, but is unnatural for computer programs.

]]>
  </help>
  <expand macro="citations" />
</tool>
