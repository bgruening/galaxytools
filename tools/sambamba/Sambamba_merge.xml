<tool id="sambamba_merge" name="Merge" version="@WRAPPER_VERSION@">
    <description>Merge several BAM files into one!</description>
    <macros>
        <import>Sambamba_macros.xml</import>
    </macros>
    <expand macro="requirements" />
    <expand macro="stdio" />
    <command>
<![CDATA[
        ln -s ${input_file1} infile1.bam &&
        ln -s ${input_file2} infile2.bam &&           
        @EXECUTABLE
        merge
        $output
        infile1.bam
        infile2.bam
]]>
    </command>
    <inputs>
        <expand macro="inputSetup1"/>
        <expand macro="inputSetup2"/>
        <param name="l" type="integer" value= "0" label="Level of compression for merged BAM file, number from 0 to 9"/>
        <param name="F" type="text" optional="true" value="" label="Keep only reads that satisfy this filter" />
    </inputs>
    <outputs>
        <data name="output" format_source="input"/>
    </outputs>

    <tests>
        <test>
            <expand macro="inputSetup1"/>
            <param name="input_file1" value="Example.sorted.bam" ftype="bam"/>
            <expand macro="inputSetup2"/>
            <param name="input_file2" value="Example.sorted.bam" ftype="bam"/>
            <output name="o" file="Merge.bam">
                <assert_contents>
                    <has_text text="chr" />
                </assert_contents>
            </output>    
        </test>
    </tests>
    <help>
<![CDATA[
@REFERENCES@

sambamba_merge is used to merge several sorted BAM files into one. The sorting order of all the files must be the same, and it is maintained in the output file.

SAM headers are merged automatically like in Picard merging tool.
]]>
    </help>
    <expand macro="citations" />
</tool>
