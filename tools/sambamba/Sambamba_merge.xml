<tool id="sambamba_merge" name="Merge" version="@WRAPPER_VERSION@">
    <description>Merge several BAM files into one</description>
    <macros>
        <import>Sambamba_macros.xml</import>
    </macros>
    <expand macro="requirements" />
    <expand macro="stdio"/>

    <command><![CDATA[
        ln -s "${input_file1}" infile1.bam &&
        ln -s "${input_file2}" infile2.bam &&
        
        @EXECUTABLE merge
            -l $Compression_level
            #if $Filter
                 -F $Filter
            #end if
            '$output'
            infile1.bam
            infile2.bam
    ]]></command>

    <inputs>
        <expand macro="inputSetup1"/>
        <expand macro="inputSetup2"/>
        <expand macro="compression_level"/>
        <expand macro="filter"/>
    </inputs>

    <outputs>
        <data name="output" format_source="input"/>
    </outputs>

    <tests>
        <test>
            <expand macro="inputSetup1"/>
            <param name="input_file1" value="Example.sorted.bam" ftype="bam"/>
            <expand macro="inputSetup2"/>
            <param name="input_file2" value="Example.sorted.bam" ftype="bam"/>
            <param name="Compression_level" value="2"/> 
            <output name="o" file="Merge.bam">
                <assert_contents>
                    <has_text text="chr" />
                </assert_contents>
            </output>
        </test>
    </tests>
    <help>
<![CDATA[
@REFERENCES@

sambamba_merge is used to merge several sorted BAM files into one. The sorting order of all the files must be the same, and it is maintained in the output file.

SAM headers are merged automatically like in Picard merging tool.
]]>
    </help>
    <expand macro="citations" />
</tool>
