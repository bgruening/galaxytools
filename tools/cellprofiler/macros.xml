<macros>
    <token name="@CP_VERSION@">3.1.9</token>
    <token name="@PY_VERSION@">3.7</token>
    <token name="@FORMATS@">jpg,png,tiff,bmp,gif,pcx,ppm,psd,pbm,pgm,eps</token>
    <token name="@SPACES@">"    "</token>
    <!-- four spaces needed for CP pipeline file -->
    <token name="@COMMON_HELP@">
        .. class:: infomark

        **Input**

        Existing CellProfiler pipeline file *(.cppipe)* or generated by linking CellProfiler tools.

        .. class:: infomark

        **Output**

        The input CellProfiler pipeline file *(.cppipe)* in addition to the settings of this module.

        .. class:: warningmark

        **IMPORTANT**

        The first tool in a CellProfiler workflow has to be **Starting modules** and the last one **CellProfiler**. You can also execute the entire pipeline with the final CellProfiler tool, in which you feed in the images you want to process as well.
    </token>


    <xml name="output_pipeline_param">
        <data name="output_pipeline" from_work_dir="output.cppipe" format="txt"/>
    </xml>


    <xml name="input_pipeline_param">
        <param name="input_pipeline" type="data" format="data" label="Select the input CellProfiler pipeline"/>
    </xml>


    <xml name="cp_requirements">
        <requirements>
            <requirement type="package" version="@CP_VERSION@">cellprofiler</requirement>
        </requirements>
    </xml>


    <xml name="py_requirements">
        <requirements>
            <requirement type="package" version="@PY_VERSION@">python</requirement>
        </requirements>
    </xml>


    <xml name="citations">
        <citations>
            <citation type="bibtex">
                @article{McQuin_2018,
                title = {CellProfiler 3.0: Next-generation image processing for biology},
                author = {McQuin C, Goodman A, Chernyshev V, Kamentsky L, Cimini BA, Karhohs KW, Doan M, Ding L, Rafelski SM, Thirstrup D, Wiegraebe W, Singh S, Becker T, Caicedo JC, Carpenter AE},
                year = {2018},
                volume = {16(7):e2005970},
                DOI = {10.1371/journal.pbio.2005970},
                journal = {PLoS Biol.},
                url = {https://journals.plos.org/plosbiology/article?id=10.1371/journal.pbio.2005970},
                }
            </citation>
        </citations>
    </xml>


    <xml name="cmd_modules">
        <command detect_errors="aggressive">
            <![CDATA[
                python '$script_file' '$inputs' '$input_pipeline'
                ]]>
        </command>
    </xml>


    <xml name="text_validator">
        <validator type="regex" message="Only numbers, letters, hyphen, underscore and spaces are allowed">^[A-Za-z0-9 _-]*$</validator>
    </xml>


    <xml name="test_input_pipeline_param">
        <param name="input_pipeline" value="common.cppipe" />
    </xml>


    <xml name="test_out_file" token_file="common.cppipe">
        <output name="output_pipeline" ftype="txt" file="@FILE@" lines_diff="0"/>
    </xml>
    
</macros>

