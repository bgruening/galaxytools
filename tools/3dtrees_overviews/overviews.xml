<tool id="3dtrees_overviews" name="3Dtrees: Overviews" version="@TOOL_VERSION@+galaxy@VERSION_SUFFIX@" profile="24.2">
    <description>
        generates 3D overview images
    </description>
    <macros>
        <token name="@TOOL_VERSION@">1.0.0</token>
        <token name="@VERSION_SUFFIX@">0</token>
    </macros>
    <requirements>
        <container type="docker">ghcr.io/3dtrees-earth/tool_overviews:0.2</container>
    </requirements>
    <command><![CDATA[
      export MPLCONFIGDIR=\$TMPDIR &&
      ln -s $input input.laz &&
          python -u /src/run.py 
          --dataset-path input.laz
          --max-points '$max_points' 
          --section-width '$section_width' 
          --image-width '$image_width' 
          --image-height '$image_height' 
          --top-views-deg '$top_views_deg' 
          --cmap '$cmap' 
          --camera-distance '$camera_distance' 
          --output-dir .
          ]]>
  </command>
    <inputs>
        <param name="input" type="data" format="laz" label="Point Cloud Dataset" help="LAZ/LAS point cloud file to process"/>
        <param name="max_points" type="integer" value="100000000" label="Maximum Points" help="Maximum number of points to process (for downsampling large datasets)"/>
        <param name="section_width" type="integer" value="10" label="Section Width" help="Width of section views in meters"/>
        <param name="image_width" type="integer" value="1024" label="Image Width" help="Width of output images in pixels"/>
        <param name="image_height" type="integer" value="768" label="Image Height" help="Height of output images in pixels"/>
        <param name="top_views_deg" type="integer" value="10" label="Top View Rotation Step" help="Angular step size for top view rotation in degrees"/>
        <param name="cmap" type="select" label="Color Map" help="Colormap for point cloud visualization">
            <option value="turbo" selected="True">Turbo</option>
            <option value="viridis">Viridis</option>
            <option value="plasma">Plasma</option>
            <option value="inferno">Inferno</option>
            <option value="magma">Magma</option>
            <option value="cividis">Cividis</option>
            <option value="coolwarm">Cool Warm</option>
            <option value="rainbow">Rainbow</option>
            <option value="jet">Jet</option>
            <option value="hot">Hot</option>
            <option value="bone">Bone</option>
            <option value="pink">Pink</option>
            <option value="spring">Spring</option>
            <option value="summer">Summer</option>
            <option value="autumn">Autumn</option>
            <option value="winter">Winter</option>
        </param>
        <param name="camera_distance" type="float" value="35.0" label="Camera Distance" help="Distance of camera from point cloud center"/>
    </inputs>
    <outputs>
        <collection name="top_views" type="list" label="Top View Images">
            <discover_datasets pattern="(?P&lt;name&gt;top_view_.*\.png)" directory="." recurse="false" visible="false" format="png"/>
        </collection>
        <collection name="section_views" type="list" label="Section View Images">
            <discover_datasets pattern="(?P&lt;name&gt;section_.*\.png)" directory="." recurse="false" visible="false" format="png"/>
        </collection>
        <data name="overview_round" format="gif" label="Overview Animation" from_work_dir="overview_round.gif"/>
    </outputs>
    <tests>
        <test>
            <param name="input" value="mikro.laz"/>
            <param name="max_points" value="1000000"/>
            <param name="section_width" value="5"/>
            <param name="image_width" value="512"/>
            <param name="image_height" value="384"/>
            <param name="top_views_deg" value="45"/>
            <param name="cmap" value="viridis"/>
            <param name="camera_distance" value="25.0"/>
            <output_collection name="top_views" type="list">
                <element name="top_view_00.png" file="top_view_00.png" ftype="png"/>
            </output_collection>
            <output name="overview_round" file="overview_round.gif" ftype="gif"/>
        </test>
    </tests>
    <help>
  
  **What it does**
  
  This tool generates 3D overview visualizations from point cloud datasets (LAZ/LAS files). It creates:
  
  1. **Top View Images**: A series of top-down views rotated around the point cloud center
  2. **Section Views**: Cross-sectional views from north-south and east-west directions  
  3. **Overview Animation**: An animated GIF showing the rotation sequence
  
  The tool automatically handles large datasets by downsampling to a manageable number of points while preserving the overall structure and appearance.
  
  -----
  
  **Input**
  
  - **Point Cloud Dataset**: LAZ or LAS format point cloud file
  - **Maximum Points**: Limit for downsampling (default: 100M points)
  - **Section Width**: Width of cross-sectional views in meters
  - **Image Dimensions**: Width and height of output images in pixels
  - **Top View Rotation**: Angular step size for rotation sequence
  - **Color Map**: Visualization color scheme (height-based coloring)
  - **Camera Distance**: Distance from point cloud center for rendering
  
  -----
  
  **Output**
  
  - **Top View Images**: Collection of PNG images showing top-down views at different rotation angles
  - **Section View Images**: Collection of PNG images showing cross-sectional views
  - **Overview Animation**: GIF file showing the complete rotation sequence
  
  -----
  
  **Example**
  
  For a forest point cloud dataset, this tool will generate:
  - 36 top view images (every 10 degrees)
  - 2 section view images (north-south and east-west cuts)
  - 1 animated GIF showing the complete 360Â° rotation
  
  The images use height-based coloring to show terrain and vegetation structure.
  
    </help>
    <creator>
        <person name="Julian Frey" email="julian.frey@wwd.uni-freiburg.de" url="https://orcid.org/0000-0001-7895-702X"/>
        <person name="Kilian Gerberding" email="kilian.gerberding@geosense.uni-freiburg.de" url="https://orcid.org/0009-0002-5001-2571"/>
        <organization name="3Dtrees-Team, University of Freiburg" url="https://github.com/3dTrees-earth"/>
    </creator>
    <citations>
        <citation type="bibtex">@misc{3dtrees_overviews title = {3Dtrees Overview Generator}, author = {3Dtrees Project}, year = {2025}</citation>
    </citations>
</tool>
