<tool id="biomodels_BIOMD0000001076" name="Prediction of Breast Cancer (BC)" version="@VERSION@" profile="22.05">
    <description>proteins involved in cancer immunotherapy using molecular descriptors and Multi Layer Perceptron (MLP) neural network</description>
    <macros>
        <token name="@VERSION@">1</token>
    </macros>
    <requirements>
        <container type="docker">docker.io/anupkumar/biomodels_biomd0000001076</container>
    </requirements>
    <command><![CDATA[
    cp /home/\$NB_USER/MLP_model3.onnx ./ &&
    python '$biom_script'
]]>
    </command>
    <configfiles>
        <configfile name="biom_script">
            <![CDATA[
import os
import numpy
import onnxruntime as rt
import pandas as pd

#if $input_file.ext == "xlsx":
data_test = pd.read_excel('$input_file')
#elif $input_file.ext == "tabular":
data_test = pd.read_csv('$input_file', sep="\t")
#elif $input_file.ext == "csv":
data_test = pd.read_csv('$input_file', sep=",")
#end if

Xdatap = data_test.iloc[:,:-1].values
sess = rt.InferenceSession(os.getcwd() + "/MLP_model3.onnx")
input_name = sess.get_inputs()[0].name
label_name = sess.get_outputs()[0].name
pred_onx = sess.run([label_name], {input_name: Xdatap.astype(numpy.float32)})[0]
data_test["Predictions"] = pred_onx
data_test.to_csv('$output_file', sep="\t", index=None)

]]>
        </configfile>
    </configfiles>
    <inputs>
	<param name="input_file" type="data" label="Test data" format="tabular,csv,xlsx" multiple="false" />
    </inputs>
    <outputs>
        <data format="tabular" name="output_file" label="Predicted data"></data>
    </outputs>
    <tests>
        <test>
            <param name="input_file" value="test_data_BIOMD0000001076.tabular" ftype="tabular" />
            <output name="output_file" file="pred_data_BIOMD0000001076.tabular">
                <assert_contents>
                    <has_n_columns n="302" />
                    <has_n_lines n="401" />
                </assert_contents>
            </output>
        </test>
        <test>
            <param name="input_file" value="test_data_BIOMD0000001076.csv" ftype="csv" />
            <output name="output_file" file="pred_data_BIOMD0000001076.tabular">
                <assert_contents>
                    <has_n_columns n="302" />
                    <has_n_lines n="401" />
                </assert_contents>
            </output>
        </test>
        <test>
            <param name="input_file" value="test_data_BIOMD0000001076.xlsx" ftype="xlsx" />
            <output name="output_file" file="pred_data_BIOMD0000001076.tabular">
                <assert_contents>
                    <has_n_columns n="302" />
                    <has_n_lines n="401" />
                </assert_contents>
            </output>
        </test>
    </tests>
    <help>
        <![CDATA[
**What it does**




**Description**



**Input file**

Provide a tabular file (as tabular or csv or xlsx) containing all the features as mentioned above.

**Output file**

Returns predicted data as a tabular file - the predictions are concatenated as a last column of the test data.

        ]]>
    </help>
    <citations>
        <citation type="bibtex">
            @ARTICLE{BIOMD0000001066,
                Author = {Chowell D and et al.},
                title = {{Chowell2022 - Random Forest model to predict efficacy of immune checkpoint blockade across multiple cancer patient cohorts}},
                url = {https://www.ebi.ac.uk/biomodels/BIOMD0000001066}
            }
        </citation>
    </citations>
</tool>
