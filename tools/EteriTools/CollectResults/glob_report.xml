<tool id="glob_report" name="Report_Results" version="0.1">
   <!--parallelism method="multi" split_inputs="input1" split_mode="to_size" split_size="10" shared_inputs="" merge_outputs="output1, output2"></parallelism-->

    <stdio>
        <exit_code range="1:" />
    </stdio>
    <command>
        <![CDATA[


        cp ~/galaxytools/tools/EteriTools/CollectResults/glob_res.pl ./ &&
        cp ~/galaxytools/tools/EteriTools/CollectResults/gc_res.pl ./ &&
        cp -r ~/galaxytools/tools/EteriTools/CollectResults/Array ./ &&
        cp -r ~/galaxytools/tools/EteriTools/CollectResults/evaluation.py ./ &&

        unzip $FASTA  &&

        #set $inputFiles = ""

        #for $cms_res in $cmsearch_results:
            #set $inputFiles += str($cms_res)+','
        #end for
        #set $inputFiles = $inputFiles[:-1]

		    perl glob_res.pl $inputFiles $merge_cluster_ol $merge_overlap $min_cluster_size $cm_min_bitscore $cm_max_eval $cm_bitscore_sig ##&&
        ##python evaluation.py
]]>
</command>
    <inputs>
        <param type="data" name="FASTA" format="zip" />
        <param type="data" name="cmsearch_results" format="tabular" multiple="True"/>

        <param name="merge_cluster_ol" type="float" value="0.66" size="5" label="merge_cluster_ol" help="">
            <sanitizer>
                <valid initial="string.printable">
                    <remove value="&apos;"/>
                </valid>
            </sanitizer>
        </param>

        <param name="merge_overlap" type="float" value="0.51" size="5" label="$merge_overlap" help="">
            <sanitizer>
                <valid initial="string.printable">
                    <remove value="&apos;"/>
                </valid>
            </sanitizer>
        </param>

        <param name="min_cluster_size" type="integer" value="3" size="5" label="min_cluster_size" help="">
            <sanitizer>
                <valid initial="string.printable">
                    <remove value="&apos;"/>
                </valid>
            </sanitizer>
        </param>

        <param name="cm_min_bitscore" type="integer" value="20" size="5" label="cm_min_bitscore" help="">
            <sanitizer>
                <valid initial="string.printable">
                    <remove value="&apos;"/>
                </valid>
            </sanitizer>
        </param>

        <param name="cm_max_eval" type="float" value="0.001" size="5" label="cm_max_eval" help="">
            <sanitizer>
                <valid initial="string.printable">
                    <remove value="&apos;"/>
                </valid>
            </sanitizer>
        </param>

        <param name="cm_bitscore_sig" type="integer" value="1" size="5" label="cm_bitscore_sig" help="">
            <sanitizer>
                <valid initial="string.printable">
                    <remove value="&apos;"/>
                </valid>
            </sanitizer>
        </param>


    </inputs>
    <outputs>

    <data name="final_stats" format="txt" from_work_dir="RESULTS/cluster.final.stats" label = "cluster.final.stats"  />
    <data name="tableForEval" format="tabular" from_work_dir="RESULTS/fullTab.tabular" label = "tableForEval"  />
    <data name="final_soft" format="txt" from_work_dir="RESULTS/partitions/final_partition.soft" label = "soft_part"   />

    <collection name="clusters" type="list" format="txt" label="CLUSTERS">
      <discover_datasets pattern="(?P&lt;name&gt;^.*\.all$)" directory="RESULTS"  />
    </collection>

    <collection name="partitions" type="list" format="txt" label="Partitions">
      <discover_datasets pattern="(?P&lt;name&gt;^.*$)" directory="RESULTS/partitions" />
    </collection>

    </outputs>


    <tests>
        <test>
            <param name="FASTA" value="FASTA.zip" ftype="zip"/>
            <param name="cmsearch_results" value="1.tabular,2.tabular"/>
            <!--param name="cmsearch_results" value="2.tabular"/-->

            <output name="final_stats" file="RESULTS/cluster.final.stats"/>
            <output_collection name="clusters" type="list">
              <discover_datasets pattern="(?P&lt;name&gt;^.*\.all$)" directory="RESULTS" />
            </output_collection>
            <output_collection name="partitions" type="list">
              <discover_datasets pattern="(?P&lt;name&gt;^.*$)" directory="RESULTS/partitions" />
            </output_collection>
        </test>
    </tests>


    <help></help>
</tool>
