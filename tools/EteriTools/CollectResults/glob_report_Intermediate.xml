<tool id="glob_report_Inter" name="Report_Intermediate_Results" version="0.1">
   <!--parallelism method="multi" split_inputs="input1" split_mode="to_size" split_size="10" shared_inputs="" merge_outputs="output1, output2"></parallelism-->

    <stdio>
        <exit_code range="1:" />
    </stdio>
    <command>
        <![CDATA[


        cp ~/galaxytools/tools/EteriTools/CollectResults/glob_report_Intermediate.pl ./ &&
        cp -r ~/galaxytools/tools/EteriTools/CollectResults/Array ./ &&

        unzip $FASTA  &&

        #set $inputFiles = ""

        #for $cms_res in $cmsearch_results:
            #set $inputFiles += str($cms_res)+','
        #end for
        #set $inputFiles = $inputFiles[:-1]

		    perl glob_report_Intermediate.pl $inputFiles $round $last_round $merge_cluster_ol $merge_overlap $min_cluster_size $cm_min_bitscore $cm_max_eval $cm_bitscore_sig
        #if str( $iteration_num.iteration_num_selector ) == "multiple":
          $part_file
          $part_file_cm
        #end if
      ##  python evaluation.py
]]>
</command>
    <inputs>
        <param type="data" name="FASTA" format="zip" />
        <param type="data" name="cmsearch_results" format="tabular" multiple="True"/>

        <conditional name="iteration_num">
            <param name="iteration_num_selector" type="select" label="Choose single or multiple iteration(s)">
                <option value="single" selected="True">Single iteration</option>
                <option value="multiple">Multiple iterations</option>
            </param>
            <when value="multiple">
                <param type="data" name="part_file" format="txt" />
                <param type="data" name="part_file_cm" format="txt" />
            </when>
            <when value="single" />
        </conditional>

        <param name="round" type="integer" value="1" size="5" label="Number of current round" help="">
            <sanitizer>
                <valid initial="string.printable">
                    <remove value="&apos;"/>
                </valid>
            </sanitizer>
        </param>

        <param name="last_round" type="integer" value="1" size="5" label="Number of last round " help="Total numer of rounds">
            <sanitizer>
                <valid initial="string.printable">
                    <remove value="&apos;"/>
                </valid>
            </sanitizer>
        </param>



        <param name="merge_cluster_ol" type="float" value="0.66" size="5" label="merge_cluster_ol" help="">
            <sanitizer>
                <valid initial="string.printable">
                    <remove value="&apos;"/>
                </valid>
            </sanitizer>
        </param>

        <param name="merge_overlap" type="float" value="0.51" size="5" label="$merge_overlap" help="">
            <sanitizer>
                <valid initial="string.printable">
                    <remove value="&apos;"/>
                </valid>
            </sanitizer>
        </param>

        <param name="min_cluster_size" type="integer" value="3" size="5" label="min_cluster_size" help="">
            <sanitizer>
                <valid initial="string.printable">
                    <remove value="&apos;"/>
                </valid>
            </sanitizer>
        </param>

        <param name="cm_min_bitscore" type="integer" value="20" size="5" label="cm_min_bitscore" help="">
            <sanitizer>
                <valid initial="string.printable">
                    <remove value="&apos;"/>
                </valid>
            </sanitizer>
        </param>

        <param name="cm_max_eval" type="float" value="0.001" size="5" label="cm_max_eval" help="">
            <sanitizer>
                <valid initial="string.printable">
                    <remove value="&apos;"/>
                </valid>
            </sanitizer>
        </param>

        <param name="cm_bitscore_sig" type="integer" value="1" size="5" label="cm_bitscore_sig" help="">
            <sanitizer>
                <valid initial="string.printable">
                    <remove value="&apos;"/>
                </valid>
            </sanitizer>
        </param>


    </inputs>
    <outputs>

    <collection name="Round_partitions" type="list" format="txt" label="Round partitions">
      <discover_datasets pattern="(?P&lt;name&gt;^.*$)" directory="EVAL/partitions"  />
    </collection>

    <collection name="Round_final_partitions" type="list" format="txt" label="Round final partitions">
      <discover_datasets pattern="(?P&lt;name&gt;^.*$)" directory="RESULTS/partitions"  />
    </collection>

    </outputs>


    <tests>
        <test>
            <param name="FASTA" value="FASTA.zip" ftype="zip"/>
            <param name="cmsearch_results" value="1.tabular,2.tabular"/>
            <!--param name="cmsearch_results" value="2.tabular"/-->

            <output name="final_stats" file="RESULTS/cluster.final.stats"/>
            <output_collection name="clusters" type="list">
              <discover_datasets pattern="(?P&lt;name&gt;^.*\.all$)" directory="RESULTS" />
            </output_collection>
            <output_collection name="partitions" type="list">
              <discover_datasets pattern="(?P&lt;name&gt;^.*$)" directory="RESULTS/partitions" />
            </output_collection>
        </test>
    </tests>


    <help></help>
</tool>
