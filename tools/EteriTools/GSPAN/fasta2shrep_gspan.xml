<tool id="gspan" name="fasta_to_gspan" version="0.1">

  <requirements>
      <requirement type="package" version="2.1.6">rnashapes</requirement>

  </requirements>

    <stdio>
        <exit_code range="1:" />
    </stdio>

    <command>
		<![CDATA[

	  perl '$__tool_directory__/fasta2shrep_gspan.pl'  --fasta '$dataFasta' $i_crop_unpaired_ends $i_abstr $i_stacks -t "3=0,5=80" -M $M -c $rel_energy_range -win $wins -shift $shift $u $seq_graph_t --group $group

]]>
	</command>
    <inputs>

        <param type="data" name="dataFasta" format="fasta" />

        <param name="i_stacks" truevalue="-stack" falsevalue="" checked="True"  type="boolean" label="Add stacking information to graphs. This adds an additional vertex (type P) for each pair of stacked base-pairs and four edge (type p) from each of the involved bases to the new vertex." help="-stack"/>
        <param name="i_abstr" truevalue="-abstr" falsevalue=""  type="boolean" label="Add abstract structure graphs to the single shrep graphinstances." help="-abstr"/>
        <param name="i_crop_unpaired_ends" truevalue="-cue" falsevalue=""  type="boolean" label="Add abstract structure graphs to the single shrep graphinstances." help="-cue"/>

        <param name="M" type="integer" value="5" size="7" label="Max number of shreps that should be taken per window." help="-M">
					<sanitizer>
						<valid initial="string.printable">
							<remove value="&apos;"/>
						</valid>
					</sanitizer>
				</param>

        <param name="rel_energy_range" type="integer" value="20" size="7" label=" Relative energy range, i.e. percentage (%) of MFE energy (RNAshapes)" help="-c">
          <sanitizer>
            <valid initial="string.printable">
              <remove value="&apos;"/>
            </valid>
          </sanitizer>
        </param>

        <param name="wins" type="text" value="40,150" size="20" label=" A list of window sizes to use" help="comma separated integers">
					<sanitizer>
						<valid initial="string.printable">
							<remove value="&apos;"/>
						</valid>
					</sanitizer>
				</param>


        <param name="shift" type="integer" value="30" size="7" label="The shift of the window, relative to the window size given inpercent." help="by default 30">
          <sanitizer>
            <valid initial="string.printable">
              <remove value="&apos;"/>
            </valid>
          </sanitizer>
        </param>

        <param name="u" truevalue="-u" falsevalue="" checked="True"  type="boolean" label="Ignore unstable structures (RNAshapes)" help="-u"/>
				<param name="seq_graph_t" truevalue="--seq-graph-t" falsevalue="" checked="True"  type="boolean" label="Add for each 't #' a graph which contains no structure" help="--seq-graph-t"/>
				<param name="group" type="integer" value="10000" size="7" label="Group size." help="by default 10000">
					<sanitizer>
						<valid initial="string.printable">
							<remove value="&apos;"/>
						</valid>
					</sanitizer>
				</param>


    </inputs>
    <outputs>

        <data name="gspan.zip" format="searchgui_archive" from_work_dir="GSPAN_Outputs/1.group.gspan.bz2" label = "gspan zip"  />

        <!--> stex konkret file em output anum, bayc irakanum ine liqe bz2-nera sarqum. ete uzum enq vor
        hat hat et bolor filere tpi apa ancoment taki mase<-->

		<!--data format="bz2" name="zips">
			<discover_datasets pattern="__designation_and_ext__" directory="GSPAN" visible="true" />
        </data-->



    </outputs>
    <tests>
        <test>
            <param name="dataFasta" value="data.fasta"/>
            <output name="gspan.zip" file="GSPAN_Outputs/1.group.gspan.bz2" />


        </test>
    </tests>
    <help><![CDATA[

**What it does**

For each fragment of input sequence we use RNAshapes to create a set of structures.
The default parameters for example consider for each input fragment again a
window of size 40nt and 150nt with a window shift of 30%. This allows to
consider local structures as well as global structures for a fragment.
From each such RNAshape window we take the top 5 shreps (suboptimal
structures for the top 5 shapes) within 20% of the mfe energy of that window
and convert them into graphs.
As shape level (abstraction level) we use 3 for short sequences and 5 for
sequences >= 80nt. Please see also RNAshapes documentation for all these
terms.




Usage:

            COMPULSORY

            \-fasta                          <STRING> e.g. sequence.fasta
                                            All sequences in fasta format.

            OPTIONS

            \-wins                           [INTEGER] e.g. "50,100,200"
                                            A list of window sizes to use.
                                            If none are given (empty string ''), then the entire sequence is
                                            taken with no windows. Each window > 1 required!
            \-shift                          <INTEGER> e.g. 20
                                            The shift of the window, relative to the window size given in
                                            percent. So you give which percent of the window size shall be
                                            used for the shift. Of course the shift is rounded down to the
                                            nearest whole number.
                                            Example 20 % of a window 150 would result in a step size of 30 nt.
                                            It is a relative parameter, as you can give different window sizes.
                                            If you do not give this parameter there is a default shift of 1 nt.
            \-cue
                                            Crop unpaired ends.
                                            If you give this flag, then the unpaired ends of each
                                            single structure are ignored. E.g. the structure
                                            ...(((...))).. becomes just (((...)))
            \-stack
                                            Adds stacking information to graphs.
                                            This adds an additional vertex (type P) for each pair of stacked base-pairs and four edges
                                            (type p) from each of the involved bases to the new vertex.
            \-e                              <FLOAT> e.g. 5.0
                                            Energy range in kcal/mol (RNAshapes)
                                            Use only one of -e and -c!
            \-c                              <INTEGER> e.g. 10
                                            Relative energy range, i.e. percentage (%) of MFE energy (RNAshapes)
                                            Use only one of -e and -c!
            \-t                             <INTEGER> [1-5] e.g. 3 OR "3=0,4=100,5=200"
                                            The shape type (RNAshapes). Default is 3.
                                            With the list format, the shape level can be changed for different window length
                                            "4=100" means that shape level 4 is used from length 100nt (window length)
                                            The first given length has to be 0! Not continuous given levels are allowed!
            \-M                             <INTEGER> e.g. 10
                                            Max number of shreps that should be taken per window.
            \-u
                                            Ignore unstable structures (RNAshapes).
                                            This option filters out closed structures with positive free energy.
            \-r
                                            Calculate structure probabilities for shreps (RNAshapes)
            \-i                             <INT> e.g. 10
                                            Turn on structure sampling and gives number of sampling iterations. Default no sampling (i=0)
            \-sample\-len                   <INT> e.g. 100
                                            Only in sampling mode: Sampling is only used for seqs/windows >= given length,
                                            Default: sample all lengths (0), if -i > 0
            \-q
                                            Turn on shape probabilities for RNAshapes, no sampling mode allowed
            \-Tp                            <FLOAT> e.g 0.001
                                            Filter cutoff for shape probabilities, applied before -M filter!
            \-seq\-graph\-win
                                            add for each window a graph which contains no structure
            \-seq\-graph\-t
                                            add for each 't #' a graph which contains no structure
            \-seq\-graph\-alph
                                            change the alphabet of unstructured graphs
            \-annotate                      <STRING> annotation.tab
                                            A file with annotations to be added as abstract graphs on the sequence leven (if given) and on the structure
                                            (SHREP) level. The format is has the following TAB-delimited
                                            columns: SEQID, START, END, NAMESPACE#LABEL.
                                            Labels with the same name-space and SEQID form connected
                                            components, which is a sequence of label vertices ordered
                                            by the START position in the sequence.
            \-abstr
                                            Add abstract structure graphs to the single shrep graph
                                            instances.
            \-nostr
                                            Calculate no structures, only add sequence information,
                                            if this is given, then -seq-graph-win AND/OR -seq-graph-t
                                            are required.
            \-match\-shape                  <SHAPE>
                                            all seqs/windows will be constraint folded into that shape via
                                            RNAshapes (if structure is given in another way this struct will be kept),
                                            if this shape is not possible within given energy range, produce a
                                            specific t graph with only one vertex 'X'. By this the instance
                                            becomes very unsimilar to all other graphs (for knn)
            \-vp
                                            enable graph computation with viewpoints:
                                            svmsgdnspdk will center on those nucleotides that are given
                                            via capital letters and ignore those given as lowercase letters
            \-o                             <STRING> e.g. "ProjectX/MySequences/GSPAN/"
                                            Output directory for gspan files containing graphs.
            \-group                         <INTEGER> e.g. 5
                                            Combine/group that number of input seqs into 1 gspan file
                                            output name is then '<INT>.group.gspan.bz2'
            \-stdout
                                            send graphs to stdout instead of writing to files
            \-ignore\-header
                                            don't write fasta id part after first space to gspan


    ]]></help>
    <citations>

      </citations>

</tool>
