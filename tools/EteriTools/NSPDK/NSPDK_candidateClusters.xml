<tool id="NSPDK_candidateClust" name="NSPDK_candidateClusters" version="9.2">
   <!--parallelism method="multi" split_inputs="input1" split_mode="to_size" split_size="10" shared_inputs="" merge_outputs="output1, output2"></parallelism-->

   <!--requirements>
       <requirement type="package">Array</requirement>
   </requirements-->
    <stdio>
        <exit_code range="1:" />
    </stdio>

    <command>
<![CDATA[

        cp -r  $__tool_directory__/Array . &&

        mkdir -p SVECTOR &&

        cp $data_svector SVECTOR/data.svector &&

        perl $__tool_directory__/NSPDK_candidateClusters.pl  $data_fasta $data_names $noCache $ensf $oc $usn $knn $nhf $nspdk_nhf_max $nspdk_nhf_step $GLOBAL_num_clusters
        #if str( $iteration_num.iteration_num_selector ) == "single":
          1
        #end if


        #if str( $iteration_num.iteration_num_selector ) == "multiple":
          $iteration_num.CI
          $blacklist
          $final_partition_soft
          $round_partition_soft
          $fast_cluster_last_round
          $iteration_num.GLOBAL_hit_blacklist_overlap
        #end if

]]>
	</command>
    <inputs>
        <param type="data" name="data_svector" format="txt"  />
        <param type="data" name="data_fasta" format="fasta" />
        <param type="data" name="data_names" format="txt" />


        <conditional name="iteration_num">
            <param name="iteration_num_selector" type="boolean" truevalue="multiple" falsevalue="single" checked="no" label="Multiple iterations"  help="for single iteration- NO, for multiple-YES"/>
            <when value="multiple">

                  <param name="CI" type="integer" value="2" size="5" label="Number of current iteration ">
                   <sanitizer>
                             <valid initial="string.printable">
                                <remove value="&apos;"/>
                             </valid>
                         </sanitizer>
                 </param>
                <param type="data" name="blacklist" format="txt" />
                <param type="data" name="final_partition_soft" format="txt" />
                <param type="data" name="round_partition_soft" format="txt" />
                <param type="data" name="fast_cluster_last_round" format="txt" />

                <param name="GLOBAL_hit_blacklist_overlap" type="float" value="0.2" size="5" label="Blacklist hit overlap" >
                  <sanitizer>
                    <valid initial="string.printable">
                           <remove value="&apos;"/>
                    </valid>
                  </sanitizer>
                 </param>

            </when>
            <when value="single" >
              <param name="CI" type="hidden" value="1" size="5" label="Number of current iteration ">
             </param>
           </when>
        </conditional>


        <param name="noCache" truevalue="-no-cache" falsevalue="" checked="True" type="boolean"
                label="Deactivate caching of kernel value computation  (-no-cache)" help="to minimize memory usage"/>



        <param name="ensf" type="integer" value="5" size="5" label="eccess neighbour size factor" help="-ensf">
			<sanitizer>
                <valid initial="string.printable">
                   <remove value="&apos;"/>
                </valid>
            </sanitizer>
		 </param>



         <param name="usn" truevalue="-usn" falsevalue="" checked="True" type="boolean"
                label="Use shared neighbourhood to weight center density (-usn)" help="by default true"/>
         <param name="oc" truevalue="-oc" falsevalue="" checked="True" type="boolean"
                label=" flag to output clusters (-oc)" help="by default true"/>




		 <param name="knn" type="integer" value="20" size="5" label="Number of nearest neighbors" help="-knn num">
			 <sanitizer>
                  <valid initial="string.printable">
                     <remove value="&apos;"/>
                  </valid>
             </sanitizer>
		 </param>


		 <param name="nhf" type="integer" value="500" size="5" label="Number of hash functions " help="-nhf num">
			 <sanitizer>
                <valid initial="string.printable">
                   <remove value="&apos;"/>
                </valid>
            </sanitizer>
		 </param>


     <param name="nspdk_nhf_max" type="integer" value="1000" size="5" label="Maximal number of hash functions " >
			 <sanitizer>
                <valid initial="string.printable">
                   <remove value="&apos;"/>
                </valid>
            </sanitizer>
		 </param>

     <param name="nspdk_nhf_step" type="integer" value="25" size="5" label="Size of step for increasing hash functions " help="The number of hash functions is increased by this value after each iteration.">
      <sanitizer>
                <valid initial="string.printable">
                   <remove value="&apos;"/>
                </valid>
            </sanitizer>
    </param>

     <param name="GLOBAL_num_clusters" type="integer" value="100" size="5" label="Maxinum number of clusters " >
			 <sanitizer>
                <valid initial="string.printable">
                   <remove value="&apos;"/>
                </valid>
            </sanitizer>
		 </param>




    </inputs>
    <outputs>
        <!--data name="data_svector" format="txt" from_work_dir="SVECTOR/data.svector.1" label="data_svector"  /-->
        <!--data name="$data_svector.$CI.fast_cluster" format="txt" label="fast_cluster.$CI"  />
        <data name="$data_svector.$CI.fast_cluster_sim" format="txt"  label="fast_cluster_sim.1"  /-->

        <data name="fast_cluster" format="txt" from_work_dir="SVECTOR/data.svector.1.fast_cluster" label="fast_cluster.1"  >
          <filter> iteration_num['iteration_num_selector'] is False</filter>
        </data>
        <data name="fast_cluster_sim" format="txt" from_work_dir="SVECTOR/data.svector.1.fast_cluster_sim" label="fast_cluster_sim.1" >
          <filter> iteration_num['iteration_num_selector'] is False </filter>
        </data>

        <data name="black_list" format="txt" from_work_dir="SVECTOR/data.svector.blacklist.1" label="blacklist.1" >
          <filter> iteration_num['iteration_num_selector'] is False </filter>
        </data>


        <data name="fast_cluster_m" format="txt" from_work_dir="SVECTOR/data.svector.*.fast_cluster" label="fast_cluster.$iteration_num.CI"  >
          <filter> iteration_num['iteration_num_selector'] is True</filter>
        </data>
        <data name="fast_cluster_sim_m" format="txt" from_work_dir="SVECTOR/data.svector.*.fast_cluster_sim" label="fast_cluster_sim.$iteration_num.CI" >
          <filter> iteration_num['iteration_num_selector'] is True</filter>
        </data>
        <data name="black_list_m" format="txt" from_work_dir="SVECTOR/data.svector.blacklist.*" label="blacklist.$iteration_num.CI" >
            <filter> iteration_num['iteration_num_selector'] is True</filter>
        </data>

    </outputs>

    <tests>
        <test>
            <param name="data_fasta" value="data.fasta"/>
            <param name="data_names" value="data.names"/>
            <param name="data_svector" value="SVECTOR/data.svector"  />

            <param name="iteration_num.iteration_num_selector"  value="false"/>
            <param name="iteration_num.CI"  value="1"/>


            <param name="noCache" value="-no-cache"/>
            <param name="ensf" value="5"/>
            <param name="oc" value="-oc"/>
            <param name="usn" value="-usn"/>
            <param name="knn" value="20"/>
            <param name="nhf" value="500"/>
            <param name="nspdk_nhf_max" value="1000"/>
            <param name="nspdk_nhf_step" value="25"/>
            <param name="GLOBAL_num_clusters" value="100"/>

            <output name="fast_cluster" file="SVECTOR/data.svector.1.fast_cluster" />
            <output name="fast_cluster_sim" file="SVECTOR/data.svector.1.fast_cluster_sim" />
            <output name="black_list" file="SVECTOR/data.svector.blacklist.1" />
          

        </test>
    </tests>



    <help>
<![CDATA[

*	 **Name: Neighborhood Subgraph Paiwise Distance Kernel**
*	 **Version: 9.2**
*	 **Programmer: Fabrizio Costa**
*	 **Date: 3 July 2012**
*	 **Last build: Dec  2 2015**

Usage:
------
	*	**./NSPDK**
	*	**--fg** <file name gspan format> for input from file
	*	**--fsb** <file name sparse format binary> for input from file
	*	**-fsa** <file name sparse format ascii> for input from file
	*	**-fsats** <file name sparse format ascii> for input from file for test set
	*	**-ftrt** <file name> for target for train set
	*	**-knn** <num nearest neighbors> (default: 10)
	*	**-wl** <file name for white listed instances ids (1 based)> for data set
	*	**-bl** <file name for black listed instances ids (1 based)> for data set
	*	**-gl** <file name for grey listed instances ids (1 based)> for data set
	*	**-oacc** flag to output accuracy of approximation (default: 0)
	*	**-of** flag to output feature encoding (default: 0)
	*	**-ofm** flag to output feature map encoding (default: 0)
	*	**-ok** flag to output kernel matrix (default: 0)
	*	**-oaknn** flag to output approximate k-nearest neighburs (default: 0)
	*	**-otknn** flag to output true (i.e. implies full kernel matrix evaluation) k-nearest neighburs (default: 0)
	*	**-oc** flag to output clusters (default: 0)
	*	**-oac** flag to output approximate clusters (default: 0)
	*	**-nc** num centers (default: 10)
	*	**-fcs** fraction of dataset size to scan for centers (default: 1)
	*	**-nhf** <num hash functions> for the Locality Sensitive Hashing function (default: 250)
	*	**-hf** <hash factor> number of signatures to collate (default: 1)
	*	**-msb** <max size bin > (default: 0.1) (expressed as a fraction of the dataset size)
	*	**-ensf** <eccess neighbour size factor> (default: 10) (0 to avoid trimming)
	*	**-ss** <sample size> for clustering procedure (default: 10)
	*	**-mi** <maximum number of elements in intersection between center neighborhoods> (default: 0)
	*	**-oaknnp** flag to output approximate knn prediction (default: 0)
	*	**-otknnp** flag to output true knn prediction (default: 0)
	*	**-ohe** flag to output hash encoding (default: 0)
	*	**-b** <feature space bits size> (default: 30)
	*	**-R** <max radius> (default: 1)
	*	**-D** <max distance relations> (default: 4)
	*	**-gt** <graph type DIRECTED|UNDIRECTED> (default: UNDIRECTED)
	*	**-anhf** <number of hash functions for abstract> (default: 50)
	*	**-T** <nspdk|anspdk|mnspdk|nspdk3d|alnspdk|nspdkvp|abstnspdk> (default: nspdk)
	*	**-t** <hard | soft | hard_soft> as neighborhood matching use HARD=exact matching, use SOFT=attribute matching with root identifier as radius 0 neighborhood, use HARD-SOFT=attribute matching with root identifier as full neighborhood encoding (default: hard)
	*	**-mink** flag to set minimum kernel rather than dot product (default: 0)
	*	**-nn** flag to de-acivate normalization (default: 0)
	*	**-nrt** <similarity filtering of redundant centers [0,1]> for clustering procedure (default: 1) (the smaller the less similar the centers)
	*	**-no-cache** flag to deactivate caching of kernel value computation (to minimize memory usage) (default: 0)
	*	**-no-true-sort** flag to deactivate sorting approximate neighbours with true kernel computation (default: 0)
	*	**-st** <size threshold> (default: 30)
	*	**-it** <imbalance tolerance> (default: 1.5)
	*	**-v** flag for verbose output (default: 0)
	*	**-rs** rand seed (default: 1)
	*	**-usn** use shared neighbourhood to weight center density (default: 0)
	*	**-fde** perform full density estimation (default: 0)
	*	**-mri** <num max refinement iterations> (default: 100000)
	*	**-debug** <debug level> for NSPDK data structures (default: 0)


    ]]></help>
    <citations>
        <citation type="bibtex">
@misc{githubseqtk,
  author = {LastTODO, FirstTODO},
  year = {TODO},


}</citation>
    </citations>
</tool>
