<tool id="nspdk" name="NSPDK" version="9.2">
   <!--parallelism method="multi" split_inputs="input1" split_mode="to_size" split_size="10" shared_inputs="" merge_outputs="output1, output2"></parallelism-->

    <stdio>
        <exit_code range="1:" />
    </stdio>
    <command>
<![CDATA[

        cp /home/eteri/GalaxyProject/galaxy/tools/NSPDK/NSPDK.pl ./ &&
        cp -r /home/eteri/GalaxyProject/galaxy/tools/NSPDK/Array ./ &&
        cp -r /home/eteri/GalaxyProject/galaxy/tools/NSPDK/NSPDK ./ &&

        perl NSPDK.pl $data_fasta $gspan_file  $max_rad $max_dist_relations $noCache $ensf $oc $usn $knn $nhf

]]>
	</command>
    <inputs>
        <param type="data" name="gspan_file" format="zip"  />
        <param type="data" name="data_fasta" format="fasta" />

         <param name="max_rad" type="integer" value="3" size="5" label="maximum radius " help="-R">
			<sanitizer>
                <valid initial="string.printable">
                   <remove value="&apos;"/>
                </valid>
            </sanitizer>
		 </param>
         <param name="max_dist_relations" type="integer" value="3" size="5" label="maximum distance relations" help="-D">
			<sanitizer>
                <valid initial="string.printable">
                   <remove value="&apos;"/>
                </valid>
            </sanitizer>
		 </param>

        <param name="noCache" truevalue="-no-cache" falsevalue="" checked="True" type="boolean"
                label="Deactivate caching of kernel value computation  (-no-cache)" help="to minimize memory usage"/>



        <param name="ensf" type="integer" value="5" size="5" label="eccess neighbour size factor" help="-ensf">
			<sanitizer>
                <valid initial="string.printable">
                   <remove value="&apos;"/>
                </valid>
            </sanitizer>
		 </param>



         <param name="usn" truevalue="-usn" falsevalue="" checked="True" type="boolean"
                label="Use shared neighbourhood to weight center density (-usn)" help="by default true"/>
         <param name="oc" truevalue="-oc" falsevalue="" checked="True" type="boolean"
                label=" flag to output clusters (-oc)" help="by default true"/>




		 <param name="knn" type="integer" value="20" size="5" label="Number of nearest neighbors" help="-knn num">
			 <sanitizer>
                  <valid initial="string.printable">
                     <remove value="&apos;"/>
                  </valid>
             </sanitizer>
		 </param>


		 <param name="nhf" type="integer" value="500" size="5" label="Number of hash functions " help="-nhf num">
			 <sanitizer>
                <valid initial="string.printable">
                   <remove value="&apos;"/>
                </valid>
            </sanitizer>
		 </param>

    </inputs>
    <outputs>
        <!--data name="data_svector" format="txt" from_work_dir="SVECTOR/data.svector.1" label="data_svector"  /-->
        <data name="fast_cluster" format="txt" from_work_dir="SVECTOR/data.svector.1.fast_cluster" label="fast_cluster"  />
        <data name="fast_cluster_sim" format="txt" from_work_dir="SVECTOR/data.svector.1.fast_cluster_sim" label="fast_cluster_sim"  />
    </outputs>

    <tests>
        <test>
            <param name="data_fasta" value="data.fasta"/>
            <!--param name="gspan_file" value="1.group.gspan.bz2"/-->
            <param name="gspan_file" value="1.group.gspan.bz2" ftype="zip" />

            <param name="max_rad" value="3"/>
            <param name="max_dist_relations" value="3"/>
            <param name="noCache" value="-no-cache"/>
            <param name="ensf" value="5"/>
            <param name="oc" value="-oc"/>
            <param name="usn" value="-usn"/>
            <param name="knn" value="20"/>
            <param name="nhf" value="500"/>

            <output name="fast_cluster" file="SVECTOR/data.svector.1.fast_cluster" />
            <output name="fast_cluster_sim" file="SVECTOR/data.svector.1.fast_cluster_sim" />
            <!--output name="data_svector" file="SVECTOR/data.svector.1" /-->

        </test>
    </tests>



    <help>
<![CDATA[

*	 **Name: Neighborhood Subgraph Paiwise Distance Kernel**
*	 **Version: 9.2**
*	 **Programmer: Fabrizio Costa**
*	 **Date: 3 July 2012**
*	 **Last build: Dec  2 2015**

Usage:
------
	*	**./NSPDK**
	*	**--fg** <file name gspan format> for input from file
	*	**--fsb** <file name sparse format binary> for input from file
	*	**-fsa** <file name sparse format ascii> for input from file
	*	**-fsats** <file name sparse format ascii> for input from file for test set
	*	**-ftrt** <file name> for target for train set
	*	**-knn** <num nearest neighbors> (default: 10)
	*	**-wl** <file name for white listed instances ids (1 based)> for data set
	*	**-bl** <file name for black listed instances ids (1 based)> for data set
	*	**-gl** <file name for grey listed instances ids (1 based)> for data set
	*	**-oacc** flag to output accuracy of approximation (default: 0)
	*	**-of** flag to output feature encoding (default: 0)
	*	**-ofm** flag to output feature map encoding (default: 0)
	*	**-ok** flag to output kernel matrix (default: 0)
	*	**-oaknn** flag to output approximate k-nearest neighburs (default: 0)
	*	**-otknn** flag to output true (i.e. implies full kernel matrix evaluation) k-nearest neighburs (default: 0)
	*	**-oc** flag to output clusters (default: 0)
	*	**-oac** flag to output approximate clusters (default: 0)
	*	**-nc** num centers (default: 10)
	*	**-fcs** fraction of dataset size to scan for centers (default: 1)
	*	**-nhf** <num hash functions> for the Locality Sensitive Hashing function (default: 250)
	*	**-hf** <hash factor> number of signatures to collate (default: 1)
	*	**-msb** <max size bin > (default: 0.1) (expressed as a fraction of the dataset size)
	*	**-ensf** <eccess neighbour size factor> (default: 10) (0 to avoid trimming)
	*	**-ss** <sample size> for clustering procedure (default: 10)
	*	**-mi** <maximum number of elements in intersection between center neighborhoods> (default: 0)
	*	**-oaknnp** flag to output approximate knn prediction (default: 0)
	*	**-otknnp** flag to output true knn prediction (default: 0)
	*	**-ohe** flag to output hash encoding (default: 0)
	*	**-b** <feature space bits size> (default: 30)
	*	**-R** <max radius> (default: 1)
	*	**-D** <max distance relations> (default: 4)
	*	**-gt** <graph type DIRECTED|UNDIRECTED> (default: UNDIRECTED)
	*	**-anhf** <number of hash functions for abstract> (default: 50)
	*	**-T** <nspdk|anspdk|mnspdk|nspdk3d|alnspdk|nspdkvp|abstnspdk> (default: nspdk)
	*	**-t** <hard | soft | hard_soft> as neighborhood matching use HARD=exact matching, use SOFT=attribute matching with root identifier as radius 0 neighborhood, use HARD-SOFT=attribute matching with root identifier as full neighborhood encoding (default: hard)
	*	**-mink** flag to set minimum kernel rather than dot product (default: 0)
	*	**-nn** flag to de-acivate normalization (default: 0)
	*	**-nrt** <similarity filtering of redundant centers [0,1]> for clustering procedure (default: 1) (the smaller the less similar the centers)
	*	**-no-cache** flag to deactivate caching of kernel value computation (to minimize memory usage) (default: 0)
	*	**-no-true-sort** flag to deactivate sorting approximate neighbours with true kernel computation (default: 0)
	*	**-st** <size threshold> (default: 30)
	*	**-it** <imbalance tolerance> (default: 1.5)
	*	**-v** flag for verbose output (default: 0)
	*	**-rs** rand seed (default: 1)
	*	**-usn** use shared neighbourhood to weight center density (default: 0)
	*	**-fde** perform full density estimation (default: 0)
	*	**-mri** <num max refinement iterations> (default: 100000)
	*	**-debug** <debug level> for NSPDK data structures (default: 0)


    ]]></help>
    <citations>
        <citation type="bibtex">
@misc{githubseqtk,
  author = {LastTODO, FirstTODO},
  year = {TODO},


}</citation>
    </citations>
</tool>
