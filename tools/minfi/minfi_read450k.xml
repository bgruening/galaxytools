<tool id="minfi_read450k" name="Minfi read450k" version="@VERSION@">
  <description>load .IDAT files</description>
    <macros>
        <import>macros.xml</import>
    </macros>
    <expand macro="requirements" />
    <command detect_errors="exit_code">
    <![CDATA[
        #for $counter, $file in enumerate($files_red):
            ln -s $file ./${counter+1}_Red.idat &&
        #end for
        #for $counter, $file in enumerate($files_grn):
            ln -s $file ./${counter+1}_Grn.idat &&
        #end for
        Rscript '$read_idat_script'
      ]]></command>
    <configfiles>
        <configfile name="read_idat_script"><![CDATA[
        require("minfi", quietly=TRUE)
        files<-list()
        #for $counter, $input in enumerate($files_red):
            files['${counter+1}'] <- '${counter+1}'
        #end for
        out <- read.metharray(files)
        save(out, file='$RGChannelSet')
        ]]>
        </configfile>
    </configfiles>
    <inputs>
        <param type="data" name="files_red" multiple="true" format="idat" label="IDAT files for the red channel"/>
        <param type="data" name="files_grn" multiple="true" format="idat" label="IDAT files for the green channel" />
    </inputs>
    <outputs>
        <data name="RGChannelSet" format="rdata" label="RGChannelSet"/>
    </outputs>
    <tests>
        <test>
            <param name="files_red" value="GSM1588707_8795207119_R06C02_Red.idat" ftype="idat"/>
            <param name="files_grn" value="GSM1588707_8795207119_R06C02_Grn.idat" ftype="idat"/>
            <output name="RGChannelSet" file="RGChannelSet.rdata" compare="sim_size"/>
        </test>
    </tests>
    <help><![CDATA[
The tool load the binary 450K array "IDAT" raw files generated by the Illumina Scanner.
In addition to the methylated and an unmethylated intensity values for each 450,000 CpG positions, IDAT file contains some extra info such as control probes.
    ]]></help>
    <citations>
        <citation type="doi">10.18129/B9.bioc.illuminaio</citation>
    </citations>
</tool>
