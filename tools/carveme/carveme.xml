<tool id="carveme" name="CarveMe" version="@TOOL_VERSION@+galaxy@VERSION_SUFFIX@" profile="21.05">
    <description>reconstruct genome-scale metabolic models</description>
    <macros>
        <token name="@TOOL_VERSION@">1.6.5</token>
        <token name="@VERSION_SUFFIX@">0</token>
        <xml name="biotools">
            <xrefs>
                <xref type="bio.tools">CarveMe</xref>
            </xrefs>
        </xml>
    </macros>
    <requirements>
        <requirement type='package' version="@TOOL_VERSION@">carveme</requirement>
    </requirements>
    <command detect_errors="exit_code"><![CDATA[
    carve '$genome'
    $input_format
    $output_format
    $universe
    #if $diamond_args
        --diamond-args '$diamond_args'
    #end if
    #if $universe_file
        --universe-file '$universe_file'
    #end if
    #if $mediadb
        --mediadb '$mediadb'
    #end if
    #if $soft
        --soft '$soft'
    #end if
    #if $hard
        --hard '$hard'
    #end if
    #if $reference
        --reference '$reference'
    #end if
    --solver scip
    --output $model
    ]]></command>
    <inputs>
    <param name="genome" label="Genome file (default: protein fasta)" type="data" format="fasta" optional="false" multiple="false"/>
    <param name="input_format"
        label="Genome input format"
        type="select"
        optional="true"
        multiple="false">
        <option value="" selected="true">Protein FASTA file (default)</option>
        <option value="--dna">DNA FASTA file</option>
    </param>
    <param name="output_format"
       label="Output format: SBML (default), SBML-fbc2, or old cobra format"
       type="select"
       optional="true"
       multiple="false">
        <option value="" selected="true">SBML (default)</option>
        <option value="--fc2">SBML-fbc2</option>
        <option value="--cobra">Cobra (legacy)</option>
    </param>
    <param name="universe"
        label="Pre-built universe model (default: Bacteria)"
        type="select"
        optional="true"
        multiple="false">
        <option value="" selected="true">Bacteria (default)</option>
        <option value="--universe grampos">Gram Positive</option>
        <option value="--universe gramneg">Gram Negative</option>
        <option value="--universe cyanobacteria">Cyanobacteria</option>
        <option value="--universe archaea">Archaea</option>
    </param>
    <param name="diamond_args" label="Additional arguments for running diamond"  type="text" optional="true"/>
    <param name="universe_file" label="Reaction universe file (SBML format)"  type="data" format="sbml" optional="true"/>
    <param argument="--mediadb" label="Media database file" type="data" format="tabular" optional="true"/>
    <param name="soft" label="Soft constraints file" type="data" format="tsv" optional="true"/>
    <param name="hard" label="Hard constraints file" type="data" format="tsv" optional="true"/>
    <param name="reference" type="data" format="sbml" optional="true" label="Manually curated model of a close reference species"/>
    </inputs>
    <outputs>
        <data name="model" format="xml"/>
    </outputs>
    <tests>
        <test expect_num_outputs="1">
            <param name="genome" value="test.faa"/>
            <output name="model" ftype='xml'>
                <assert_contents>
                    <has_size value="1264310" delta="500"/>
                </assert_contents>
            </output>
        </test>
    </tests>
    <help>

CarveMe reconstructs genome-scale metabolic models of prokaryotes using an annotated genome to 'carve' a universal model.

An annotation input is required as a protein or DNA FASTA file.

The default universe is 'bacteria', but alternative, more specific, universes are available for Gram-Positive/Negative, Cyanobacteria and Archaea.

Other universes might be uploaded by the user (e.g. for yeast reconstructions).

Providing a Media database file enforces the model to grow in the said media.

Reactions' directionalities (1:forward, -1:backward, 0:blocked) can be enforced with a soft constraints tabular file:  (e.g R_XXX    -1).

Reactions' bounds can be enforced with a hard constraints tabular file (e.g. R_XXX      -10     10)


Note: Different solvers may result in slightly different models. 
Here, the reconstructions rely on the open source solver SCIP. 
For local installations, CPLEX or Gurobi are faster alternatives.

    </help>
    <citations>
        <citation type="doi">10.1093/nar/gky537</citation>
    </citations>    
</tool>
