<tool id="racon" name="Racon" version="1.3.1">
    <description>Consensus module for raw de novo DNA assembly of long uncorrected reads.</description>

    <macros>
        <import>macros.xml</import>
    </macros>
    <expand macro="requirements" />
    <version_command>racon --version</version_command>
    <command detect_errors="exit_code"><![CDATA[
        ln -s '$reads' reads.${reads.ext} && 
        ln -s '$overlaps' overlaps.${overlaps.ext} && 
        ln -s '$corrected_reads' corrected_reads.${corrected_reads.ext} && 

        racon 
            reads.${reads.ext}  
            overlaps.${overlaps.ext}  
            corrected_reads.${corrected_reads.ext}
            -t \${GALAXY_SLOTS:-4} 
            $u
            $f
            -w $w
            -q $q
            -e $e
            -m $m
            -x $x
            -g $g
            > racon_polished_consensus.fa  
    ]]></command>
    <inputs>
        <param type="data" name="reads" format="fasta,fasta.gz,fastq,fastq.gz" label="sequences"/>
        <param type="data" name="overlaps" format="sam,sam.gz" label="overlaps"/>
        <param type="data" name="corrected_reads" format="fasta,fasta.gz,fastq,fastq.gz" label="target sequences"/>

        <param argument="-u" type="boolean" truevalue="-u" falsevalue="" label="output unpolished target sequences" />
        <param argument="-f" type="boolean" truevalue="-f" falsevalue="" label="perform fragment correction instead of contig polishing" />
        <param argument="-w" type="integer" value="500" label="size of window on which POA is performed" />
        <param argument="-q" type="float" value="10.0" label="threshold for average base quality of windows used in poa" />
        <param argument="-e" type="float" value="0.3" label="maximum allowed error rate used for filtering overlaps" />
        <param argument="-m" type="integer" value="5" label="score for matching bases" />
        <param argument="-x" type="integer" value="-4" label="score for mismatching bases" />
        <param argument="-g" type="integer" value="-8" max="0" label="gap penalty" />        
        
    </inputs>
    <outputs>
        <data name="consensus" format="fasta" from_work_dir="racon_polished_consensus.fa" label="Consensus " />
    </outputs>
    <tests>
<!--         <test>
            <param name="reads" ftype="fasta" value="sample_reads.fasta"/>
            <param name="overlaps" ftype="sam" value="sample_overlaps.sam"/>
            <param name="corrected_reads" ftype="fasta" value="sample_layout.fasta"/>
            <output name="consensus" ftype="fasta" file="consensus_result1.fasta"/>
        </test> -->
        <test>
            <param name="reads" ftype="fasta" value="sample_reads.fasta"/>
            <param name="overlaps" ftype="sam" value="sample_overlaps.sam"/>
            <param name="corrected_reads" ftype="fasta" value="sample_layout.fasta"/>
            <param name="u" value="true"/>
            <param name="f" value="true"/>
            <param name="w" value="800"/>
            <param name="e" value="0.2"/>
            <output name="consensus" ftype="fasta" file="consensus_result2.fasta"/>
        </test>
    </tests>
    <help><![CDATA[
        usage: racon [options ...] <sequences> <overlaps> <target sequences>

    <sequences>
        input file in FASTA/FASTQ format (can be compressed with gzip)
        containing sequences used for correction
    <overlaps>
        input file in MHAP/PAF/SAM format (can be compressed with gzip)
        containing overlaps between sequences and target sequences
    <target sequences>
        input file in FASTA/FASTQ format (can be compressed with gzip)
        containing sequences which will be corrected

    options:
        -u, --include-unpolished
            output unpolished target sequences
        -f, --fragment-correction
            perform fragment correction instead of contig polishing
            (overlaps file should not contain dual/self overlaps!)
        -w, --window-length <int>
            default: 500
            size of window on which POA is performed
        -q, --quality-threshold <float>
            default: 10.0
            threshold for average base quality of windows used in poa
        -e, --error-threshold <float>
            default: 0.3
            maximum allowed error rate used for filtering overlaps
        -m, --match <int>
            default: 5
            score for matching bases
        -x, --mismatch <int>
            default: -4
            score for mismatching bases
        -g, --gap <int>
            default: -8
            gap penalty (must be negative)
        -t, --threads <int>
            default: 1
            number of threads
        --version
            prints the version number
        -h, --help
            prints the usage

    ]]></help>
    <expand macro="citations" />
</tool>