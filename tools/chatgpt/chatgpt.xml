<tool id="chatgpt" name="chatGPT" version="@TOOL_VERSION@+galaxy@VERSION_SUFFIX@" python_template_version="3.5" profile="21.05">
    <description>Integrating OpenAI's ChatGPT into Galaxy</description>
    <macros>
        <token name="@TOOL_VERSION@">2024</token>
        <token name="@VERSION_SUFFIX@">0</token>
    </macros>
    <requirements>
        <requirement type="package" version="3.12.4">python</requirement>
        <requirement type="package" version="1.35.13">openai</requirement>
    </requirements>
    <command detect_errors="exit_code"><![CDATA[
#set count = 1
#set LINK_LIST = ""
#for $input in $context:
    #set LINK = "input" + str($count) + "." + $input.ext
    ln -s "$input" "$LINK" &&
    #if count == 1
        #set LINK_LIST = $LINK
    #else
        #set LINK_LIST = $LINK_LIST + "," + $LINK
    #end if
    #set count = $count + 1
#end for

python "$__tool_directory__/chatgpt.py"
"$LINK_LIST"
"$question"
"$model"
"$openai_api_key"
    ]]></command>
    <configfiles>
        <configfile name="openai_api_key"><![CDATA[
$__user__.extra_preferences.get('chatgpt|api_key', "")
        ]]></configfile>
    </configfiles>
    <inputs>
        <param name="context" type="data" multiple="true" optional="false" format="c,cs,cpp,doc,docx,html,java,json,md,pdf,php,pptx,py,rb,tex,txt,css,js,sh,ts,jpg,jpeg,png,webp,gif" label="Context"/>
        <param name="question" type="text" optional="false" label="Question" help="Question about the text provided"/>
        <param name="model" type="select" optional="false" label="Model" help="Select the model you want to use">
            <option value="gpt-4o-mini">Affordable and intelligent small model for fast, lightweight tasks (gpt-4o-mini)</option>
            <option value="gpt-4o">High-intelligence flagship model for complex, multi-step tasks (gpt-4o)</option>
            <option value="gpt-4-turbo">The previous set of high-intelligence model with vision capabilities (gpt-4-turbo)</option>
            <option value="gpt-4">The previous set of high-intelligence model (gpt-4) (not supporting images)</option>
            <option value="gpt-3.5-turbo">A fast, inexpensive model for simple tasks (GPT-3.5-turbo) (not supporting images)</option>
        </param>
    </inputs>
    <outputs>
        <data name="output" format="txt" label="${tool.name} on ${on_string}" from_work_dir="./output.txt"/>
    </outputs>
    <tests>
        <test expect_failure="true">
            <param name="context" value="chatgpt_test.txt" ftype="txt"/>
            <param name="question" value="What is this?"/>
            <param name="model" value="gpt-4o-mini"/>
        </test>
        <test>
            <param name="context" value="chatgpt_test.pdf" ftype="pdf"/>
            <param name="question" value="Sumerize this PDF file?"/>
            <param name="model" value="gpt-4o-mini"/>
            <output name="output" file="output.txt"/>
        </test>
    </tests>
    <help><![CDATA[

.. class:: infomark

**What it does**

This tool uses OpenAI's ChatGPT API. Provide context data and a question, select the model you want to use, and get a response generated by ChatGPT.

Usage
.....

**Input**

.. change file formats to wahtever it is supporting in galaxy

* Context data (up to 500 files) in one of the following formats: c,cs,cpp,doc,docx,html,java,json,md,pdf,php,pptx,py,rb,tex,txt,css,js,sh,ts,jpg,jpeg,png,webp,gif
* A question about the data
* The model_ you want to use

.. _model: https://platform.openai.com/docs/models

**Output**

A response generated by ChatGPT based on the provided context data and question
.. ADD MODEL DESCRIPTION AND WHAT WE DO EXACTLY (we send file with openai api to their server and then get data that is there responsibility and then delete the files) AND ALSO ADD A README FILE to guide admins to install the tool

    ]]></help>
    <citations>
        <citation type="bibtex">
            @misc{openai,
                author = {OpenAI},
                title = {OpenAI's ChatGPT},
                howpublished = {\url{https://openai.com/chatgpt}},
                year = {2024},
                note = {Accessed: 2024-07-26}
            }
        </citation>
    </citations>
</tool>
