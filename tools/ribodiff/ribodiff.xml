<tool id="ribodiff" name="RiboDiff" version="0.2.2">
    <description>Detect protein translational efficiency difference</description>
    <requirements>
        <requirement type="package" version="0.2.2">ribodiff</requirement>
    </requirements>
    <command detect_errors="aggressive"><![CDATA[ 
        TE.py 
        -e $exp_design
        -c $count_table
        -o $ribodiff_out
        -p 1
        #if str($sumcntcutoff):
            -s $sumcntcutoff
        #end if
        #if str($dispinitial):
            -i $dispinitial
        #end if
        #if str($cutofffdr):
            -q $cutofffdr
        #end if
        #if $dispdiff:
            -d $dispdiff
        #end if
        #if $multitest:
            -m $multitest_option
        #end if
        && mv *EmpDisp.scatter* EmpDisp.scatter.pdf
        && mv *TEchange.scatter* TEchange.scatter.pdf
        && mv *TEchange.hist* TEchange.hist.pdf
        ]]>
    </command>

    <inputs>
        <param format="tabular" name="count_table" type="data" label="Sequencing read count file" help="Can be created with BAM files."/>
        <param format="csv" name="exp_design" type="data" label="Experiment outline" help="This can guide to infer the read count file."/>
        <param name="sumcntcutoff" type="integer" value="10" min="0" optional="True" label="The sum of normalized read count as the threshold to do the test." help="This option applies for both Ribo-seq and RNA-seq data."/>
        <param name="dispinitial" type="float" value="0.01" min="0" optional="True" label="The initial dispersion to start the estimation."/>
        <param name="cutofffdr" type="float" value="0.1" min="0" optional="True" label="The FDR cutoff for significant case to plot"/>
        <param name="dispdiff" type="boolean" truevalue="1" falsevalue="0" checked="false" label="Dispersion" help="Allow different dispersions for Ribo-seq and RNA-seq count data." />
        <param name="multitest" type="boolean" truevalue="1" falsevalue="0" checked="false" label="Enable Multiple Test Correction" help="Check to enable Multiple Test Correction" />
        <param name="multitest_option" type="select" optional="true" multiple="false" label="Multiple Test Correction" help="Method for multiple test correction">
            <option value="BH">Benjamini-Hochberg</option>
            <option value="Bonferroni">Bonferroni</option>
        </param>
    </inputs>

    <outputs>
        <data format="tabular" name="ribodiff_out" label="${tool.name} on ${on_string}: Differential Translational Efficiency"/>
        <data format="pdf" name="EmpDisp_scatter" from_work_dir="EmpDisp.scatter.pdf" label="Empirical Dispersion on ${on_string}: Differential Translational Efficiency"/>
        <data format="pdf" name="TEchange_scatter" from_work_dir="TEchange.scatter.pdf" label="Translation Efficiency Change on ${on_string}: Differential Translational Efficiency"/>
        <data format="pdf" name="TEchange_hist" from_work_dir="TEchange.hist.pdf" label="Histogram of Translation Efficiency Change on ${on_string}: Differential Translational Efficiency"/>
    </outputs>

    <tests>
        <test>
            <param name="count_table" value="gene_count_table.tab"/>
            <param name="exp_design" value="experimental_design.csv"/>
            <output name="EmpDisp_scatter" file="EmpDisp_scatter.pdf" compare="sim_size" delta="7500" />
            <output name="TEchange_scatter" file="TEchange_scatter.pdf" compare="sim_size" delta="5000" />
            <output name="TEchange_hist" file="TEchange_hist.pdf" compare="sim_size" delta="2000" />
            <output name="ribodiff_out" file="ribodiff_out.tab" compare="sim_size" delta="20000" />
        </test>
    </tests> 
    <help>

.. class:: infomark

**What it does** 

RiboDiff_ is a tool for detecting protein translational efficiency difference based on data from high-thoughput deep sequencing assays such as RNA-Seq and Ribosome footprinting.

**Requires**:

Experiment files grouped into replicate groups, each containing several replicates. The program will also work with only two groups containing only a single replicate each. However, this analysis has less statistical power and is therefore not recommended!

RiboDiff_ takes sequencing read count table generated from htseq-count program. Count table must be generated for each sample (group, replicates) and merged according to the experiment outline file which describes the experiment setup. 

- The following gives example of sequencing read counts from different experiments:: 

    ID  RFcontrolRep1   RFcontrolRep2   RFtreatedRep1   RFtreatedRep2   RNAcontrolRep1  RNAcontrolRep2  RNAcontrolRep3  RNAtreatedRep1  RNAtreatedRep2  RNAtreatedRep3
    ENSG00000000457 50  24  33  39  3860    4815    3798    2927    4319    3649
    ENSG00000001461 19  27  21  14  3870    4982    3753    2751    4204    3579
    ENSG00000001631 106 66  106 56  10912   13989   10613   8415    11724   9840
    ENSG00000002834 401 319 363 335 40262   52792   38721   28950   42485   35989
    ENSG00000003402 85  43  51  32  4909    6290    4621    3690    5407    4727

- The corresponding experiment outline file as follows:: 

    Samples,Data_Type,Conditions
    RFcontrolRep1,Ribo-Seq,Control
    RFcontrolRep2,Ribo-Seq,Control
    RFtreatedRep1,Ribo-Seq,Treated
    RFtreatedRep2,Ribo-Seq,Treated
    RNAcontrolRep1,RNA-Seq,Control
    RNAcontrolRep2,RNA-Seq,Control
    RNAcontrolRep3,RNA-Seq,Control
    RNAtreatedRep1,RNA-Seq,Treated
    RNAtreatedRep2,RNA-Seq,Treated
    RNAtreatedRep3,RNA-Seq,Treated

**Output**:

RiboDiff_ generates a tabular file containing different columns and optional visual plots in PDF format. 

------

**Reference**

If **RiboDiff** is used to obtain results for scientific publications it should be cited as [1]_.

.. [1] Zhong, Y et.al. 2015. RiboDiff: Detecting Changes of Translation Efficiency from Ribosome Footprints. bioRxiv `doi:http://dx.doi.org/10.1101/017111`_.

.. _doi:http://dx.doi.org/10.1101/017111: http://dx.doi.org/10.1101/017111

------

.. class:: infomark

**About formats**

**Sequencing read count file** gives the count of how many aligned reads map to each genomic feature (defined in genome annotation file) from different samples (tab-seaparated fields)::
    
    1. feature_id - The identifier to the genomic feature.
    2. sample_name - This field indicates the number of reads aligned to the feature from this specific sample. 
    .
    .
    . there will be multiple such fields, depends on the number of samples.
    .

For more information see `here`_. 

.. _here: https://github.com/ratschlab/RiboDiff/blob/master/MANUAL#L32

**Experiment outline file** describes the design of the experiment, the fields are coma-seaparated::

    1. sample_name - Unique sample name. 
    2. data_type - Sequencing experiment data type.
    3. conditions - Different testing conditions. 

The format specification see `details`_.

.. _details: https://github.com/ratschlab/RiboDiff/blob/master/MANUAL#L11

------

.. _RiboDiff: http://bioweb.me/ribo

**Copyright**

RiboDiff Wrapper Version 0.2 (Mar 2015)

2014-2015 Memorial Sloan Kettering Cancer Center &amp; University of TÃ¼bingen 
    </help>
    <citations>
        <citation type="doi">10.1101/017111</citation>
    </citations>
</tool>