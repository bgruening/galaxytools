<tool id="mlocarna" name="LocARNA" version="1.8.11">
    <description>
        Multiple Alignment and Folding of RNAs
    </description>

    <macros>
        <import>macros.xml</import>
    </macros>
    
    <expand macro="requirements" />

    <expand macro="stdio" />
    
    <expand macro="version" />
    
    <command><![CDATA[
    mlocarna
    
    $input_data
    --stockholm
    --tgtdir outdir
    
    ## -------------------- alignment mode and specific options

    #if $alignment_mode.alignment_mode_selector=="global_locarna":
        $alignment_mode.free_endgaps
    #else if $alignment_mode.alignment_mode_selector=="local_locarna":
        --sequ-local on
    #else if $alignment_mode.alignment_mode_selector=="probabilistic":
        --probabilistic
        $alignment_mode.consistency_transformation
        
        #if $alignment_mode.iterate=="true":
            --iterate
            --iterations $alignment_mode.iterations
        #end if
    #else if $alignment_mode.alignment_mode_selector=="sparse":
        --sparse
    #end if
    
    ## -------------------- scoring parameters
    
    --indel $scoring.indel
    --indel-opening $scoring.indel_opening
    --struct-weight $scoring.struct_weight
    --tau $scoring.tau
    
    #if $scoring.sequence_score.sequence_score_selector=="match":
        --match $scoring.sequence_score.match
        --mismatch $scoring.sequence_score.mismatch
    #else if $scoring.sequence_score.sequence_score_selector=="ribosum":
        --use-ribosum true
    #else if $scoring.sequence_score.sequence_score_selector=="ribofit":
        --ribofit true
    #end if

    ## -------------------- folding parameters

    #if $folding.plfold_span>=0:
        --plfold-span $folding.plfold_span
        --plfold-winsize $folding.plfold_winsize
    #end if
    
    --rnafold-temperature $folding.rnafold_temperature
    
    ## -------------------- heuristic parameters
    
    -p $heuristics.min_prob
    --max-diff-am $heuristics.max_diff_am
    --max-diff $heuristics.max_diff
    --max-diff-at-am $heuristics.max_diff_at_am
    --max-bps-length-ratio $heuristics.max_bps_length_ratio
    
    $heuristics.alifold_consensus_dp

    ## -------------------- other parameters
    
    $other.lonely_pairs
    
    > $stdout
    ]]></command>

    <inputs>
        <param name="input_data" type="data" format="text,fasta" label="Sequence input"
               help="Sequence input in fasta format, optionally with locarna-specific extensions"
               />
        
        <conditional name="alignment_mode">
            <param name="alignment_mode_selector" type="select" label="Alignment mode">
                <option value="global_locarna">Global alignment (LocARNA)</option>
                <option value="local_locarna">Local alignment (LocARNA)</option>
                <option value="probabilistic">Probabilistic alignment (LocARNA-P)</option>
                <option value="sparse">Global alignment (SPARSE)</option>
            </param>
            <when value="global_locarna">
                <param name="free_endgaps" type="select" label="Free endgaps">
                    <option value="">No free endgaps</option>
                    <option value="--free-endgaps">Free endgaps</option>
                    <option value="--free-endgaps-5">Free endgaps, only 5'</option>
                    <option value="--free-endgaps-3">Free endgaps, only 3'</option>
                </param>
            </when>
            <when value="local_locarna" />
            <when value="probabilistic">
                <param name="consistency_transformation" type="boolean" 
                       truevalue="--consistency-transformation" falsevalue="" 
                       checked="true" label="Consistency transformation" 
                       help="--consistency-transformation" />
                <param name="iterate" type="boolean"
                       truevalue="true" falsevalue="false"
                       checked="false" label="Iterative refinement"
                       help="--iterate" />
                <param name="iterations" type="integer"
                       value="1" label="Number of refinement iterations"
                       help="--iterations num" />
            </when>
            <when value="sparse" />
        </conditional>
        
        <section name="scoring" title="Scoring parameters">
            <expand macro="common_scoring_parameters" />
        </section>
        
        <section name="folding" title="RNA folding parameters">
            <expand macro="common_folding_parameters" />
        </section>

        <section name="heuristics" title="Heuristic parameters">
            <expand macro="common_heuristic_parameters" />
        </section>

        <section name="other" title="Other parameters">
            <expand macro="common_other_parameters" />
            <param name="lonely_pairs" type="boolean" truevalue="--LP" falsevalue="--noLP" 
                   checked="false" label="Allow lonely base-pairs" help="(--LP/--noLP)" />
        </section>
    </inputs>
    
    <outputs>
        <expand macro="common_outputs" />
    </outputs>
    
    <tests>
        <test>
            <param name="input_data" value="archaea.fa" />
            <output name="stdout" file="archaea-default.stdout" />
        </test>
        <test>
            <param name="input_data" value="haca.snoRNA.fa" />
            <output name="stdout" file="haca.snoRNA-default.stdout" />
        </test>
        <test>
            <param name="input_data" value="archaea.fa" />
            <param name="alignment_mode_selector" value="probabilistic" />
            <output name="stdout" file="archaea-probabilistic.stdout" />
        </test>
    </tests>

    <help><![CDATA[ **Multiple alignment of RNAs**
    
For more information, see     
.. __: http://www.bioinf.uni-freiburg.de/Software/LocARNA/
    ]]></help>

    <expand macro="citations" />
    
</tool>
