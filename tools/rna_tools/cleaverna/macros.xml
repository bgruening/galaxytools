<macros>
    <token name="@TOOL_VERSION@">1.0.0</token>
    <token name="@VERSION_SUFFIX@">0</token>
    <token name="@PROFILE@">21.01</token>
    <xml name="requirements">
        <requirements>
            <requirement type="package" version="1.0.0">cleaverna</requirement>
            <requirement type="package" version="8.32">coreutils</requirement>
        </requirements>
    </xml>
    <xml name="version_command">
        <version_command>cleaverna --help | head -1</version_command>
    </xml>
    <xml name="citations">
        <citations>
            <citation type="bibtex">
                @unpublished{cleaverna2024,
                    author = {Reyhaneh Tavakoli and contributors},
                    title = {CleaveRNA: Advanced machine learning-based computational tool for scoring candidate DNAzyme cleavage sites},
                    year = {2024},
                    url = {https://github.com/reyhaneh-tavakoli/CleaveRNA}
                }
            </citation>
        </citations>
    </xml>
    <xml name="prediction_prediction_mode">
        <param name="prediction_mode" type="select" label="Analysis mode">
            <option value="default" selected="true">Default - Standard cleavage site prediction</option>
            <option value="target_screen">Target Screen - Screen custom cleavage sites</option>
            <option value="target_check">Target Check - Validate sites in specific regions</option>
            <option value="specific_query">Specific Query - Analyze custom DNAzyme sequences</option>
        </param>
    </xml>
    <xml name="fasta_input">
        <param name="target_files" type="data" format="fasta" multiple="true" label="Target RNA sequence files" help="Target RNA sequence files in FASTA format as the substrate of DNAzyme cleavage"/>
    </xml>
    <xml name="prediction_training_inputs">
        <conditional name="training_source">
            <param name="training_type" type="select" label="Select your training model">
                <option value="HPBC_default" help="Trained on published DNAzyme cleavage data for HPV genome and human BCL mRNA. Uses validated parameters and bundled FASTA files.">HPV_BCL model</option>
                <option value="SARS_default" help="Trained on published DNAzyme cleavage data for SARS-CoV-2 RNA. Uses validated parameters and bundled FASTA files.">SARS_CoV_2 model</option>
                <option value="custom_upload">Create new model</option>
            </param>
            <when value="HPBC_default">
                <!-- Uses bundled HPBC_user_merged_num.csv and HPBC_scores.csv -->
                <param name="training_scores" type="data" format="csv,tabular" optional="true" label="Training target scores (optional)" help="If not provided, will use default HPBC_scores.csv"/>
            </when>
            <when value="SARS_default">
                <!-- Uses bundled SARS_user_merged_num.csv and SARS_scores.csv -->
                <param name="training_scores" type="data" format="csv,tabular" optional="true" label="Training target scores (optional)" help="If not provided, will use default SARS_scores.csv"/>
            </when>
            <when value="custom_upload">
                <param name="training_file" type="data" format="csv,tabular" label="Training file for machine learning model" help="Upload the generated training file with training mode"/>
                <param name="training_scores" type="data" format="csv,tabular" label="Training target labels/scores" help="Training target labels/scores"/>
            </when>
        </conditional>
    </xml>
    <xml name="training_prediction_mode">
        <!-- Professional interface: Only one analysis mode, so use a hidden token instead of a select box -->
        <token name="prediction_mode">default</token>
    </xml>
    <xml name="cleavage_sites_param">
        <param name="CS" type="select" label="✂️ CS - Cleavage Sites" help="Define the dinucleotide cleavage sites (select one or more)" multiple="true" display="checkboxes">
            <option value="AA">AA</option>
            <option value="AC" selected="true">AC</option>
            <option value="AG">AG</option>
            <option value="AU" selected="true">AU</option>
            <option value="CA">CA</option>
            <option value="CC">CC</option>
            <option value="CG">CG</option>
            <option value="CU">CU</option>
            <option value="GA">GA</option>
            <option value="GC" selected="true">GC</option>
            <option value="GG">GG</option>
            <option value="GU" selected="true">GU</option>
            <option value="UA">UA</option>
            <option value="UC">UC</option>
            <option value="UG">UG</option>
            <option value="UU">UU</option>
            <validator type="no_options" message="At least one cleavage site must be selected"/>
        </param>
    </xml>
    <xml name="model_name_param">
        <param name="model_name" type="text" label="Output_Prefix">
            <validator type="empty_field"/>
            <validator type="regex">^[a-zA-Z0-9_]+$</validator>
        </param>
    </xml>
    <xml name="fasta_targets">
        <param name="target_files" type="data" format="fasta" multiple="true" label="Upload Sequence Files">
        <help><![CDATA[Download the <a href="static/data/template.fasta" target="_blank"> FASTA template file </a>]]></help>
    </param>
    </xml>
    <xml name="fasta_training">
        <param name="training_target_files" type="data" format="fasta" multiple="true" label="RNA sequence files"/>
    </xml>
    <xml name="cleavage_sites_param">
        <param name="CS" type="select" multiple="true" label="Cleavage Sites (CS)">
            <option value="AG">AG</option>
            <option value="AU" selected="true">AU</option>
            <option value="CA">CA</option>
            <option value="CC">CC</option>
            <option value="CG">CG</option>
            <option value="CU">CU</option>
            <option value="GA">GA</option>
            <option value="GC" selected="true">GC</option>
            <option value="GG">GG</option>
            <option value="GU" selected="true">GU</option>
            <option value="UA">UA</option>
            <option value="UC">UC</option>
            <option value="UG">UG</option>
            <option value="UU">UU</option>
        </param>
    </xml>
    <xml name="dnazyme_basic_params">
        <param name="LA" type="integer" min="1" max="50" value="9" label="Left Arm Length (LA)"/>
        <param name="RA" type="integer" min="1" max="50" value="9" label="Right Arm Length (RA)"/>
        <expand macro="cleavage_sites_param"/>
        <param name="CA" type="text" value="GGCUAGCUACAACGA" label="Catalytic Core Sequence (CA)">
            <validator type="regex">^[ACGU]+$</validator>
        </param>
        <param name="Tem" type="integer" min="10" max="99" value="37" label="Reaction Temperature (°C)"/>
    </xml>
    <xml name="param_source_conditional">
        <conditional name="param_source">
            <param name="param_mode" type="select" label="Parameter source">
                <option value="manual" selected="true">Manual parameters</option>
                <option value="file">Upload CSV file</option>
            </param>
            <when value="manual">
                <expand macro="dnazyme_basic_params"/>
            </when>
            <when value="file">
                <param name="params_file" type="data" format="csv,tabular" label="Upload parameter file (CSV)">
                    <help><![CDATA[Download the<a href="static/data/training_parameter_template.csv" target="_blank"> parameter file template</a>, fill it with your values, and upload it here.
        ]]></help>
                </param>
            </when>
        </conditional>
    </xml>
</macros>
