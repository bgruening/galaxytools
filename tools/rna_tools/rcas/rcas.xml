<tool id="rcas" name="RNA Centric Annotation System" version="0.1.0">
    <requirements>
            <requirement type="package" version="0.1.19">samtools</requirement>
            <requirement type="package" version="2.19.1">bedtools</requirement>
            <requirement type="package" version="1.2">R_dependencies</requirement>
    </requirements>
    <stdio>
        <exit_code range="1:" />
    </stdio>

    <command><![CDATA[
            python2 $__tool_directory__/src/RCAS.py
            --RCAS_path $__tool_directory__

            #if $source.source_select=="local_path"
                    --genome $source1.local_genome
            #else
                    --$genome $source1.uploaded_genome
            #end if

            #if $source.source_select=="local_path"
                    --gff3 $source.local_gff3
            #else
                    --gff3 $source.uploaded_gff3
            #end if

            --species $species
            --cores "\${GALAXY_SLOTS:-12}"
            $run_motif
            $run_PATHrich
            $run_GOrich
            $run_coverage
            $run_all
            $BED
    ]]></command>
    <inputs>
        <conditional name="source1">
           <param name="source_select" type="select" label="The source of genome">
                   <option value="local_path">Local File Path to genome</option>
                   <option value="input_file">Upload genome</option>
           </param>
           <when value="local_path">
                   <param name="local_genome" type="text" label="genome from Local Path" value="/home/ydilimu/database/hg19.fa"/>
           </when>
           <when value="input_file">
                   <param name="uploaded_genome" type="data" format="fasta" label="GFF3 from Galaxy History" />
           </when>
        </conditional>

        <conditional name="source">
           <param name="source_select" type="select" label="The source of GFF3">
                   <option value="local_path">Local File Path to gff3</option>
                   <option value="input_file">Upload gff3</option>
           </param>
           <when value="local_path">
                   <param name="local_gff3" type="text" label="GFF3 from Local Path" value="/home/ydilimu/database/gencode.v19.annotation.gff3"/>
           </when>
           <when value="input_file">
                   <param name="uploaded_gff3" type="data" format="GFF3" label="GFF3 from Galaxy History" />
           </when>
        </conditional>

        <param name="BED" type="data" format="BED" label="Peak intervals in BED format"
        help="Reference genome used to generate BED file should conform with the reference genome for running RCAS."/>

        <param name="species" type="select" label="Species">
            <option value="human" selected="true">humna</option>
            <option value="fly">fly</option>
            <option value="fly">worm</option>
            <option value="fly">mouse</option>
        </param>

        <param name="run_motif" label="Run motif search"
        type="boolean" falsevalue="" truevalue="--run_motif" checked="false"
        help="Use this option if you want to run motif search."/>

        <param name="run_PATHrich" label="Run pathway enrichment"
        type="boolean" falsevalue="" truevalue="--run_PATHrich" checked="false"
        help="Use this option if you want to run pathway enrichment."/>

        <param name="run_GOrich" label="Run GO term enrichment"
        type="boolean" falsevalue="" truevalue="--run_GOrich" checked="false"
        help="Use this option if you want to run GO term enrichment."/>

        <param name="run_coverage" label="Run coverage profile"
        type="boolean" falsevalue="" truevalue="--run_coverage" checked="false"
        help="Use this option if you want to run coverage profile."/>

        <param name="run_all" label="Run run all steps."
        type="boolean" falsevalue="" truevalue="--run_all" checked="false"
        help="Use this option if you want to run all steps."/>


    </inputs>
    <outputs>
        <data name="report" format="HTML">
		        <discover_datasets pattern="__designation__" ext="html" visible="true" />
        </data>
    </outputs>
    <tests>
        <test>
            <param name="gtf" value="test.gtf"/>
            <param name="fa" value="test.fa"/>
            <param name="ccdsid" value="true"/>
            <param name="appris" value="true"/>
            <param name="ribo_bam" value="test_ribo.bam"/>
            <param name="rna_bam" value="test_rna.bam"/>
            <param name="read_lenghts_ribo1" value="26"/>
            <param name="read_lenghts_ribo2" value="28"/>
            <param name="read_lenghts_ribo3" value="29"/>
            <param name="cutoff1" value="9"/>
            <param name="cutoff2" value="12"/>
            <param name="cutoff3" value="12"/>
            <output name="output1" file="ORFs_genes_found"/>
        </test>
    </tests>
    <help><![CDATA[
**What it does**:

rcas is a new analysis pipeline for Ribosome Profiling (Ribo-seq) experiments, which exploits the triplet periodicity of ribosomal footprints to call translated regions.

**Run time**:

We ran the rcas analysis on a SGE cluster, using 7 cores and h_vmem 8G. For each dataset the complete rcas workflow (from the bam files to final results) took ~ 1 day.

**Environment**: Linux

**IMPORTANT:**

At least **2** cores should be used for running rcas, therefore please configure job_conf.xml accordingly.

Be careful about scaffolds, both in the genome and GTF files, which may slow the whole pipeline.

The current rcas framework is not designed to identify and quantify ORFs on different transcripts. Which means the transcript annotation is crucial.

**Outputs:**

*Output 1*:  a table with the translated ORFs/genes identified with their category/annotation,
which reports tab-separated values for number of ORFs found and their corresponding genes.

*Output 2*: a pdf containing info about the number of ORFs found, together with length/coverage distributions for different ORF categories.

]]></help>
    <citations>
        <citation type="doi">10.1038/nmeth.3688</citation>
    </citations>
</tool>
