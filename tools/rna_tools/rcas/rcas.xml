<tool id="rcas" name="RNA Centric Annotation System" version="0.1.0">
    <requirements>
            <requirement type="package" version="1.0.0">bioconductor-rcas</requirement>
    </requirements>
    <stdio>
        <exit_code range="1:" />
    </stdio>

    <command><![CDATA[
            R  -e   'library(RCAS);

                    runReport(queryFilePath = "$input_BED",

                    gffFilePath = "$input_GTF",

                    msigdbFilePath = "$human_msigdb_gmt",

                    annotationSummary = $run_anot,

                    goAnalysis = $run_GOrich,

                    msigdbAnalysis = $run_PATHrich,

                    motifAnalysis = $run_motif,

                    genomeVersion = "$genomeVersion",

                    outDir = getwd(),

                    printProcessedTables = TRUE,

                    sampleN = "$downsampling",

                    selfContained = TRUE)'

            &&

                cp *RCAS.report.html RCAS.report.html

            &&
                if [ $run_anot == TRUE ]; then
                  cp Figure*summarizeQueryRegions.data.tsv summarizeQueryRegions.data.tsv;
                fi

            &&
                tar czvf "$tables_tar" *tsv

    ]]></command>
    <inputs>
        <param name="genomeVersion" type="select" label="Genome Version">
            <option value="hg19" selected="true">hg19</option>
            <option value="dm3">dm3</option>
            <option value="ce10">ce10</option>
            <option value="mm9">mm9</option>
        </param>

        <param name="input_BED" type="data" format="BED" label="Target regions in BED format"
        help="The coordinates should be in accord with Genome Version."/>

        <param name="input_GTF" type="data" format="GTF"
            label="Reference annotation in ENSEMBL GTF format"/>

        <param name="human_msigdb_gmt" type="data" format="tabular"
        label="Human Molecular Signatures Database (MSigDB)"
        optional="true"
        help="The database is usesd for gene set enrichment.
        For non-human species, the human MSigDB will be automatically converted accordingly."/>

        <param name="run_anot" label="Run annotation."
        type="boolean" falsevalue="FALSE" truevalue="TRUE" checked="True"
        help="Use this option if you want to run annotation."/>

        <param name="run_GOrich" label="Run GO term enrichment"
        type="boolean" falsevalue="FALSE" truevalue="TRUE" checked="False"
        help="Use this option if you want to run GO term enrichment."/>

        <param name="run_PATHrich" label="Run gene set enrichment"
        type="boolean" falsevalue="FALSE" truevalue="TRUE" checked="False"
        help="Use this option if you want to run gene set enrichment.
        Please provide the MSigDB database."/>

        <param name="run_motif" label="Run motif search"
        type="boolean" falsevalue="FALSE" truevalue="TRUE" checked="False"
        help="Use this option if you want to run motif search."/>

        <param name="downsampling" label="Downsampling (N)"
        type="text" value="0"
        help="Randomly sample query regions down to (N)"/>
    </inputs>
    <outputs>
        <data name="report" format="html" from_work_dir="RCAS.report.html"
            label="${tool.name} on ${on_string}: dynamic HTML"/>
        <data name="tables_tar" format="tar"
            label="${tool.name} on ${on_string}: tables"/>
        <data name="table" format="tsv" from_work_dir="summarizeQueryRegions.data.tsv"
            label="${tool.name} on ${on_string}: Query regions summary"
            hidden="true"/>
    </outputs>
    <tests>
        <test>
            <param name="input_BED" value="TIA1.bed"/>
            <param name="input_GTF" value="Homo_sapiens.GRCh37-chr1-f10k.75.gtf"/>
            <param name="run_anot" value="TRUE"/>
            <param name="run_GOrich" value="FALSE"/>
            <param name="run_PATHrich" value="FALSE"/>
            <param name="run_motif" value="FALSE"/>
            <param name="genomeVersion" value="hg19"/>
            <output name="table" file="summarizeQueryRegions.data.tsv"/>
        </test>
    </tests>
    <help><![CDATA[

.. class:: infomark

**Purpose**

RNA Centric Annotation System (RCAS) automatically generates
dynamic annotations for custom input files
that contain transcriptomic target regions.
RCAS automatically summarizes annotated features
that overlap with targets in the BED file,
and perform enrichment analysis of
Gene Ontology (GO) terms, gene set and motifs.

-----

.. class:: infomark

**Inputs**

1. A target region file in BED format
2. A reference annotation file in GTF format
3. A Human Molecular Signatures Database (MSigDB) (optional)

-----

.. class:: infomark

**Outputs**

**The outputs consist of a dynamic HTML file and
a tar ball of the tables, which are provided for download.**

The contents in the HTML and tables correspond to:

1. Annotation summary for query regions
2. GO term analysis results
3. Gene set enrichment analysis results
4. Motif analysis results

]]></help>
    <citations>
        <citation type="bibtex">
        @ARTICLE{RCAS,
            author = {},
            keywords = {bioinformatics, transcriptome, peak, annotation},
            priority = {},
            title = {{RNA Centric Annotation System (RCAS)}},
            url = {https://github.com/BIMSBbioinfo/RCAS}
        }
        </citation>
    </citations>
</tool>
