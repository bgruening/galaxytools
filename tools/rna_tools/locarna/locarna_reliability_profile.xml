<tool id="locarna_reliability_profile" name="LocARNA reliability-profile" version="@VERSION@.1">
    <description>
        Plot reliability profile for probabilistic mlocarna
    </description>

    <macros>
        <import>macros.xml</import>
    </macros>
    
    <expand macro="requirements" />

    <expand macro="stdio" />
    
    <expand macro="version" />
    
    <command><![CDATA[
    (if file '$input_archive' | grep 'gzip compressed' > /dev/null ;
    then tar xzf '$input_archive' ;
    else tar xf '$input_archive' ;
    fi)
    &&
    reliability-profile.pl mlocarna_results

    --output-format='$output_format'

    #if $output_format == 'pdf'
         --out '$pdf_output_plot'
    #else if $output_format == 'png'
         --out '$png_output_plot'
    #end if

    #if str($title) != ""
        --title '$title'
    #end if

    #if str($seqname) != ""
        --seqname '$seqname'
    #end if

    --beta $beta
    --structure-weight $structure_weight
    
    #if str($signals)!=""
        --signals '$signals'
    #end if

    --offset $offset

    #if $write_rscript:
        --write-R-script '$rscript_output'
    #end if

    #if $write_subsequence
        --write-subseq
    #end if
    
    $predict
    $fit_once_on
    $show_sw
    $rev_compl

    > '$stdout'
    ]]></command>
    
    <inputs>
        <param name="input_archive" type="data" format="tar.gz" label="MLocARNA archive"
               help="Archive of MLocARNA results (tar or tar.gz as generated by running
                     mlocarna in probabilistic alignment mode)." />

        <param name="title" type="text" label="Plot title"
               help="Title of the plot"
               />

        <param name="seqname" type="text" label="Reference sequence"
               help="Project to a reference sequence. Provide one of the sequence names in the alignment input
                     or leave blank to plot without projection."
               />

        <param name="predict" type="boolean" checked="True"
               truevalue="" falsevalue="--dont-predict"
               argument="dont-predict"
               help="Turn on/off predicting."
               />

        <param name="fit_once_on" type="boolean" checked="False"
               truevalue="--fit-once-on" falsevalue=""
               argument="fit-once-on"
               help="Predict exactly one 'on'-region"
               />

        <param name="show_sw" type="boolean" checked="True"
               truevalue="--show-sw" falsevalue=""
               argument="show-sw"
               help="Show the influence of structure weight."
               />

        <param name="rev_compl" type="boolean" checked="False"
               truevalue="--revcompl" falsevalue=""
               argument="revcompl"
               help="Plot and fit a reverse complement."
               />

        <param argument="beta" help="Inverse temperature for fitting." 
               type="float" value="12.0" min="1.0" max="25.0" />
        
        <param name="structure_weight" argument="structure-weight"
               type="float" value="1.0" min="0.0" max="8.0"
               help="Weight of structure against sequence (1.0 means equal)"
               />
 
        <param argument="offset" help="Genomic offset." 
               type="integer" value="1" />
        
        <param name="signals" type="text" label="List of signals"
               help="List of '{from to} orientation' signal specifications. Show signals in plot
                     and compared infered signal to them. Ranges 'from to' can be repeated; 
                     the orientation must be either +1 or -1.
                     The specifications of the single signals are separated by ';'. Example of two signal, 
                     where the first one consists of two ranges: 1 15 20 30 +1; 15 45 -1"
               >
            <sanitizer invalid_char=" ">
                <valid initial="string.digits"> <add value="+" /> <add value="-" /> <add value=";" /> </valid>
            </sanitizer>
        </param>
       
        <param name="output_format" type="select" 
               label="Output options">
            <option value="pdf" selected="True">Plot in pdf
            format</option>
            <option value="png" selected="False">Plot in png format</option>
        </param>

        <param name="write_rscript" type="boolean" argument="write-R-script"
               label="Write R script" checked="False"
               help="Write R script that can produce the output plot."
               />

        <param name="write_subsequence" type="boolean" argument="write-subseq"
               label="Write Subsequence" checked="False"
               help="Write subsequence in output."
               />
        
    </inputs>
               
    
    <outputs>
        <data format="pdf" name="pdf_output_plot"
              label="${tool.name} reliability plot (pdf) ${on_string}">
            <filter>output_format == 'pdf'</filter>
        </data>
        <data format="png" name="png_output_plot"
              label="${tool.name} reliability plot (png) ${on_string}">
            <filter>output_format == 'png'</filter>
        </data>
        <data format="txt" name="rscript_output"
              label="${tool.name} reliability plot (R script) ${on_string}">
            <filter> write_rscript is True </filter>
        </data>
        <data format="txt" name="stdout" label="${tool.name} std out on ${on_string}" />
    </outputs>
    
    <tests>
        <test>
            <param name="input_archive" value="archaea.tar.gz" />
            <param name="write_rscript" value="True" />
            <output name="rscript_output" file="archaea_relplot.scr" lines_diff="2" />
        </test>
    </tests>

    <help><![CDATA[**Reliability Profiles for Multiple RNA
Alignment**
    
This tool draws reliability profiles for mlocarna alignments that have
been computed in probabilistic alignment mode. Moreover, it predicts
reliably aligned regions, which can be used to determine the
boundaries of well conserved structured RNA motifs in less closely
related sequence context.
    
**Input.**
Results archive of an alignment by the mlocarna tool; for this
purpose, mlocarna must be run in probabilistic mode in order to
generate the required reliability information.

**Output.**
Plot of the reliability profile for the input alignment. Moreover,
a signal prediction is performed and predicted regions are
annotated in the plot.


For more information, see
.. __: http://www.bioinf.uni-freiburg.de/Software/LocARNA/
    ]]></help>

    <expand macro="citations" />
    
</tool>
