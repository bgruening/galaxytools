<tool id="ribotaper_create_metaplots" name="ribotaper part II: metagene analysis for P-sites definition" version="0.1.0">
    <requirements>
            <requirement type="package" version="0.1.19">samtools</requirement>
            <requirement type="package" version="2.19.1">bedtools</requirement>
            <requirement type="package" version="1.2">R_dependencies</requirement>
    </requirements>
    <stdio>
        <exit_code range="1:" />
    </stdio>

    <command><![CDATA[
        $__tool_directory__/scripts/create_metaplots.bash
            "$ribo_bam"
            "$start_stops_FAR"
            "metagene"
            "$__tool_directory__/bedtools_dir/"
            "$__tool_directory__/scripts"

        &&

        find "metaplots -name '*.pdf'"
            | sort | xargs gs
            "-dAutoRotatePages=/None"
            "-dBATCH"
            "-dNOPAUSE"
            "-q"
            "-sDEVICE=pdfwrite"
            "-sOutputFile=merged_metagene.pdf"


    ]]></command>
    <inputs>
        <param name="ribo_bam" type="data" format="bam" label="ribo_bam" help="Ribo-seq alignment file in BAM format."/>
        <param name="start_stops_FAR" type="data" format="bed" label="start_stops_FAR" help="Table of start_stops_FAR generated from part I."/>
    </inputs>
    <outputs>
        <data name="output1" type="data" format="pdf" from_work_dir="merged_metagene.pdf" label="Metagene analysis results for P-sites definition"/> ??
    </outputs>
    <tests>
        <test>
            <param name="ribo_bam" value="test_ribo.bam"/>
            <param name="cutoff3" value="12"/> ??
            <output name="output1" file="ORFs_genes_found"/>
        </test>
    </tests>
    <help><![CDATA[
**What it does**:

RiboTaper is a new analysis pipeline for Ribosome Profiling (Ribo-seq) experiments, which exploits the triplet periodicity of ribosomal footprints to call translated regions.

**Run time**:

We ran the RiboTaper analysis on a SGE cluster, using 7 cores and h_vmem 8G. For each dataset the complete RiboTaper workflow (from the bam files to final results) took ~ 1 day.

**Environment**: Linux

**IMPORTANT:**

At least **2** cores should be used for running RiboTaper, therefore please configure job_conf.xml accordingly.

Be careful about scaffolds, both in the genome and GTF files, which may slow the whole pipeline.

The current RiboTaper framework is not designed to identify and quantify ORFs on different transcripts. Which means the transcript annotation is crucial.

**Outputs:**

*Output 1*:  a table with the translated ORFs/genes identified with their category/annotation,
which reports tab-separated values for number of ORFs found and their corresponding genes.

*Output 2*: a pdf containing info about the number of ORFs found, together with length/coverage distributions for different ORF categories.

]]></help>
    <citations>
        <citation type="doi">10.1038/nmeth.3688</citation>
    </citations>
</tool>
