<tool id="ribotaper_create_metaplots" name="ribotaper part II: metagene analysis for P-sites definition" version="0.1.0">
    <requirements>
            <requirement type="package" version="0.1.19">samtools</requirement>
            <requirement type="package" version="2.19.1">bedtools</requirement>
            <requirement type="package" version="1.2">R_dependencies</requirement>
    </requirements>
    <stdio>
        <exit_code range="1:" />
    </stdio>

    <command><![CDATA[
        $__tool_directory__/scripts/create_metaplots.bash
            "$ribo_bam"
            "$start_stops_FAR"
            "metagene"
            "$__tool_directory__/bedtools_dir/"
            "$__tool_directory__/scripts"

        &&

        find "metaplots"
            "-name"
            "metagene*.pdf"
            | sort | xargs gs
            "-dAutoRotatePages=/None"
            "-dBATCH"
            "-dNOPAUSE"
            "-q"
            "-sDEVICE=pdfwrite"
            "-sOutputFile=merged_metagene.pdf"

    ]]></command>
    <inputs>
        <param name="ribo_bam" type="data" format="bam" label="ribo_bam" help="Ribo-seq alignment file in BAM format."/>
        <param name="start_stops_FAR" type="data" format="bed" label="start_stops_FAR" help="Table of start_stops_FAR generated from part I."/>
    </inputs>
    <outputs>
        <data name="output1" type="data" format="pdf" from_work_dir="merged_metagene.pdf" label="Metagene analysis results for P-sites definition"/> ??
    </outputs>
    <tests>
        <test>
            <param name="ribo_bam" value="test_ribo.bam"/>
            <param name="start_stops_FAR" value="annotation_path/start_stops_FAR.bed"  ftype="bed"/>
            <output name="output1" file="merged_metagene.pdf"/>
        </test>
    </tests>
    <help><![CDATA[
**What it does**:

@Lorenzo

**Run time**:
@Lorenzo

**Environment**: Linux

**Outputs:**
@Lorenzo how users should interpret the metagene analysis output? given an example on how P-sites values should be determined.



]]></help>
    <citations>
        <citation type="doi">10.1038/nmeth.3688</citation>
    </citations>
</tool>
