<tool id="ribotaper" name="ribotaper part III: ribosome profiling" version="0.1.0">
    <requirements>
            <requirement type="package" version="0.1.19">samtools</requirement>
            <requirement type="package" version="2.19.1">bedtools</requirement>
            <requirement type="package" version="1.2">R_dependencies</requirement>
    </requirements>
    <stdio>
        <exit_code range="1:" />
    </stdio>

    <command><![CDATA[
       $__tool_directory__/scripts/Ribotaper.sh
            "$ribo_bam"
            "$rna_bam"
            "$annotation_path"
            "$read_lenghts_ribo1,$read_lenghts_ribo2,$read_lenghts_ribo3"
            "$cutoff1,$cutoff2,$cutoff3"
            "$__tool_directory__/scripts"
            "$__tool_directory__/bedtools_dir"
            "\${GALAXY_SLOTS:-12}"

    ]]></command>
    <inputs>
        <param name="ribo_bam" type="data" format="BAM" label="ribo_bam" help="Ribo-seq alignment file in BAM format."/>
        <param name="rna_bam" type="data" format="BAM" label="rna_bam" help="RNA-seq alignment file in BAM format."/>
        <param name="annotation_path" type="text" value=""  label="annotation_path" help="Path to annotation directory generated by ribotaper part I."/>
        <param name="read_lenghts_ribo1" type="text" value="26"  label="Read length 1" help="Read length 1, which is used for P-site calculation. Default is '26' but it varies a lot in different datasets."/>
        <param name="read_lenghts_ribo2" type="text" value="28"  label="Read length 2" help="Read length 2, which is used for P-site calculation. Default is '28' but it varies a lot in different datasets."/>
        <param name="read_lenghts_ribo3" type="text" value="29"  label="Read length 3" help="Read length 3, which is used for P-site calculation. Default is '29' but it varies a lot in different datasets."/>
        <param name="cutoff1" type="text" value="9"  label="Cutoff 1" help="Offset 1, which is used for P-sites calculation. Default is '9' but it varies a lot in different datasets."/>
        <param name="cutoff2" type="text" value="12"  label="Cutoff 2" help="Offset 2, which is used for P-sites calculation. Default is '12' but it varies a lot in different datasets."/>
        <param name="cutoff3" type="text" value="12"  label="Cutoff 3" help="Offset 3, which is used for P-sites calculation. Default is '12' but it varies a lot in different datasets."/>
    </inputs>
    <outputs>
        <data name="output1" format="tabular" from_work_dir="ORFs_genes_found" label="Translated ORFs (table)"/>
        <data name="output2" format="pdf" from_work_dir="Final_ORF_results.pdf" label="ORF categories (pdf)"/>
    </outputs>
    <tests>
        <test>
            <param name="ribo_bam" value="test_ribo.bam"/>
            <param name="rna_bam" value="test_rna.bam"/>
            <param name="read_lenghts_ribo1" value="26"/>
            <param name="read_lenghts_ribo2" value="28"/>
            <param name="read_lenghts_ribo3" value="29"/>
            <param name="cutoff1" value="9"/>
            <param name="cutoff2" value="12"/>
            <param name="cutoff3" value="12"/>
            <output name="output1" file="ORFs_genes_found"/>
        </test>
    </tests>
    <help><![CDATA[
**What it does**:

RiboTaper is a new analysis pipeline for Ribosome Profiling (Ribo-seq) experiments, which exploits the triplet periodicity of ribosomal footprints to call translated regions.

**Run time**:

We ran the RiboTaper analysis on a SGE cluster, using 7 cores and h_vmem 8G. For each dataset the complete RiboTaper workflow (from the bam files to final results) took ~ 1 day.

**Environment**: Linux

**IMPORTANT:**

At least **2** cores should be used for running RiboTaper, therefore please configure job_conf.xml accordingly.

Be careful about scaffolds, both in the genome and GTF files, which may slow the whole pipeline.

The current RiboTaper framework is not designed to identify and quantify ORFs on different transcripts. Which means the transcript annotation is crucial.

**Outputs:**

*Output 1*:  a table with the translated ORFs/genes identified with their category/annotation,
which reports tab-separated values for number of ORFs found and their corresponding genes.

*Output 2*: a pdf containing info about the number of ORFs found, together with length/coverage distributions for different ORF categories.

]]></help>
    <citations>
        <citation type="doi">10.1038/nmeth.3688</citation>
    </citations>
</tool>
