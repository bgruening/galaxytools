<macros>
    <token name="@TOOL_VERSION@">1.0.6</token>
    <token name="@VERSION_SUFFIX@">1</token>
    <token name="@profile@">24.1</token>
    <xml name="requirements">
        <requirements>
            <requirement type="package" version="@TOOL_VERSION@">rbpbench</requirement>
            <requirement type="package" version="5.5.4">meme</requirement>
        </requirements>
    </xml>
    <xml name="bio_tools">
        <xrefs>
            <xref type="bio.tools">rbpbench</xref>
        </xrefs>
    </xml>
    <token name="@PREPARE_REF@"><![CDATA[
        ln -s -f
        #if str($reference_genome.reference_genome_selector) == "history"
            '$reference_genome.history_genome'
        #else
            '$reference_genome.builtin_genome.fields.path'
        #end if
        reference.fa &&
    ]]>    </token>
    <token name="@PREPARE_PHASTCONS@"><![CDATA[
        #if str($phastcons_file.cons_scores_file_selector) != "no"
            ln -s -f
            #if str($phastcons_file.cons_scores_file_selector) == "history"
                '$phastcons_file.history_cons_scores_file'
            #else
                '$phastcons_file.builtin_cons_scores_file.fields.path'
            #end if
            phastcons_file.bw &&
        #end if
    ]]>    </token>
    <token name="@PREPARE_PHYLOP@"><![CDATA[
        #if str($phylop_file.cons_scores_file_selector) != "no"
            ln -s -f
            #if str($phylop_file.cons_scores_file_selector) == "history"
                '$phylop_file.history_cons_scores_file'
            #else
                '$phylop_file.builtin_cons_scores_file.fields.path'
            #end if
            phylop_file.bw &&
        #end if
    ]]>    </token>
    <token name="@COMMON_PARAMS@"><![CDATA[
        --ext $search_options.search_ext
        #if $search_options.motif_db:
            --motif-db $search_options.motif_db
        #end if
        --fimo-pval $search_options.search_fimo_pval
        --bed-score-col $search_options.search_bed_score_col
        #if $search_options.search_bed_score_thr:
            --bed-sc-thr $search_options.search_bed_score_thr
        #end if
        $search_options.search_unstranded
        $search_options.search_unstranded_ct
        #if $search_options.fimo_nt_freqs_file:
            --fimo-ntf-file '$search_options.fimo_nt_freqs_file'
        #end if
        #if $search_options.search_regex:
            --regex '$search_options.search_regex'
        #end if
        --meme-no-check
        --meme-no-pgc
    ]]>    </token>
    <token name="@COMMON_PARAMS_RNA@"><![CDATA[
        #if $search_options.motif_db:
            --motif-db $search_options.motif_db
        #end if
        --fimo-pval $search_options.search_fimo_pval
        #if $search_options.fimo_nt_freqs_file:
            --fimo-ntf-file '$search_options.fimo_nt_freqs_file'
        #end if
        --meme-no-check
        --meme-no-pgc
    ]]>    </token>
    <token name="@RBP_LIST@"><![CDATA[
        --rbps
        #if str($action_type.select_db.select_db_selector) == "default_db":
            #if str($action_type.select_db.select_rbps.select_rbps_selector) == "list_db_rbps":
                #for $rbp_id in str($action_type.select_db.select_rbps.database).split(','):
                    $rbp_id
                #end for
            #else:
                ALL
            #end if
        #else:
            $action_type.select_db.custom_db_rbp_ids_list
        #end if        
        #if str($action_type.select_db.select_db_selector) == "custom_db":
            --custom-db-id $action_type.select_db.custom_db_id
            --custom-db-info $action_type.select_db.custom_db_info_file
            #if $action_type.select_db.custom_db_meme_xml_file:
                --custom-db-meme-xml '$action_type.select_db.custom_db_meme_xml_file'
            #end if
            #if $action_type.select_db.custom_db_cm_model_file:
                --custom-db-cm '$action_type.select_db.custom_db_cm_model_file'
            #end if
        #end if
    ]]>    </token>
    <token name="@USER_RBP@"><![CDATA[
        #if str($action_type.user_rbp.user_rbp_selector) == "sequence":
            USER
            --user-rbp-id $action_type.user_rbp.seq_rbp_id
            --user-meme-xml '$action_type.user_rbp.meme_motifs_xml'
        #elif str($action_type.user_rbp.user_rbp_selector) == "structure":
            USER
            --user-rbp-id $action_type.user_rbp.str_rbp_id
            --user-cm '$action_type.user_rbp.cm_model_file'
        #end if
    ]]>    </token>
    <token name="@SORT_JS@"><![CDATA[
        #if $advanced_html_output_options.store_sort_js_in_html:
            --sort-js-mode 3
        #else:
            --sort-js-mode 1
        #end if
    ]]>    </token>
    <token name="@PLOTLY_JS@"><![CDATA[
        --plotly-js-mode $advanced_html_output_options.plotly_js_mode
    ]]>    </token>
    <xml name="select_rbp_db">
        <conditional name="select_db">
            <param name="select_db_selector" type="select" label="Select RBP binding motif database">
                <option selected="True" value="default_db">Human motif database with 259 RBPs and 605 RBP binding motifs (catrapid.omics.v2.1.human.6plus)</option>
                <option value="custom_db">Provide a custom motif database</option>
            </param>
            <when value="default_db">
                <conditional name="select_rbps">
                    <param name="select_rbps_selector" type="select" label="Select RBPs for motif search">
                        <option selected="True" value="list_db_rbps">Select individual RBPs </option>
                        <option value="all_db_rbps">Select all 259 RBPs</option>
                    </param>
                    <when value="list_db_rbps">
                        <param name="database" type="select" label="Select RBPs" multiple="true">
                            <options from_data_table='rbp_ids_table' />
                        </param>
                    </when>
                    <when value="all_db_rbps"/>
                </conditional>
            </when>
            <when value="custom_db">
                <param name="custom_db_id" type="text" value="custom_db_id" label="Custom motif database ID" help="Set ID / name for provided custom motif database (default: custom_db_id)"/>
                <param name="custom_db_info_file" type="data" format="txt,tabular" label="Custom motif database info table file" help="Provide custom motif database info table file containing RBP ID -> motif ID -> motif type assignments. The motif IDs must correspond to the provided custom MEME / DREME XML and/or covariance models file(s)."/>
                <param name="custom_db_meme_xml_file" type="data" format="memexml" optional="True" label="Custom motif database MEME / DREME XML file" help="Provide custom motif database MEME / DREME XML file containing sequence motifs"/>
                <param name="custom_db_cm_model_file" type="data" format="cm" optional="True" label="Custom motif database covariance models file" help="Provide custom motif database covariance models file containing structure motif(s) (i.e., covariance model(s))"/>
                <param name="custom_db_rbp_ids_list" type="text" value="RBP1 RBP2 RBP3" label="Specify RBP IDs from custom motif database" help="Provide list of RBP IDs found in custom motif database to use for motif search. This can be a single ID, as well as several (separated by spaces, as in the example). To search using all RBPs in the custom database, simply type ALL."/>
            </when>
        </conditional>
    </xml>
    <xml name="user_rbp">
        <conditional name="user_rbp">
            <param name="user_rbp_selector" type="select" label="Add user-supplied motifs">
                <option selected="True" value="no">No</option>
                <option value="sequence">Yes (MEME/DREME XML based sequence motif(s))</option>
                <option value="structure">Yes (Covariance model based structure motif(s))</option>
            </param>
            <when value="sequence">
                <param name="meme_motifs_xml" type="data" format="memexml" label="DREME or MEME motifs XML file" help="DREME or MEME output XML file containing sequence motif(s)"/>
                <param name="seq_rbp_id" type="text" value="User_RBP" label="RBP ID" help="RBP ID (RBP name) for provided sequence motif(s). Make sure to provide user RBP IDs and motif IDs that are different from selected database RBP and motif IDs."/>
            </when>
            <when value="structure">
                <param name="cm_model_file" type="data" format="cm" label="Covariance models file" help="Covariance models file containing structure motif(s)"/>
                <param name="str_rbp_id" type="text" value="User_RBP" label="RBP ID" help="RBP ID (RBP name) for provided structure motif(s). Make sure to provide user RBP IDs and motif IDs that are different from selected database RBP and motif IDs."/>
            </when>
            <when value="no"/>
        </conditional>
    </xml>
    <xml name="reference_genome">
        <conditional name="reference_genome">
            <param name="reference_genome_selector" type="select" label="Select reference genome sequence (according to provided BED file)">
                <option selected="True" value="builtin">Select built-in genome sequence</option>
                <option value="history">Select genome sequence from history</option>
            </param>
            <when value="builtin">
                <param name="builtin_genome" type="select" label="Select built-in genome sequence">
                    <options from_data_table="fasta_indexes">
                        <filter column="2" type="sort_by" />
                        <validator message="No genomes are available for the selected input dataset" type="no_options" />
                    </options>
                </param>
            </when>
            <when value="history">
                <param name="history_genome" type="data" format="fasta" label="Select genome sequence in FASTA format from history"/>
            </when>
        </conditional>
    </xml>
    <xml name="cons_scores_file">
        <when value="no"/>
        <when value="builtin">
            <param name="builtin_cons_scores_file" type="select" label="Select built-in conservation score bigWig file">
                <options from_data_table="cons_scores_downloader">
                    <validator message="No files are available for the selected input dataset" type="no_options" />
                </options>
            </param>
        </when>
        <when value="history">
            <param name="history_cons_scores_file" type="data" format="bigwig" label="Select conservation score bigWig file from history"/>
        </when>
    </xml>
    <xml name="search_options">
        <section name="search_options" title="Advanced settings">
            <param name="search_ext" type="text" value="0" label="Up- and downstream extension of genomic regions" help='Up- and downstream extension of genomic regions in nucleotides (nt). E.g. set to "30" to extend 30 nt on both sides, or "20,10" for different up- and downstream extension (default: 0)'/>
            <param name="motif_db" type="select" optional="true" label="Built-in motif database to use">
                <option value="1" selected="true">Human RBP motifs (257
                        RBPs, 599 motifs, "catrapid_omics_v2.1_human_6plus_ext")</option>
                <option value="2">Human RBP motifs + 23 ucRBP motifs (277 RBPs, 622
                        motifs, "catrapid_omics_v2.1_human_6plus_ext_ucrbps")</option>
                <option value="3">Human RBP motifs from Ray et al. 2013 (80 RBPs, 102
                        motifs, "ray2013_human_rbps_rnacompete")</option>
            </param>
            <param name="search_fimo_pval" type="float" value="0.001" label="FIMO p-value threshold" help='FIMO p-value threshold (FIMO option: --fimo-pval) for reporting motif hits (default: 0.001)'/>
            <param name="search_bed_score_col" type="integer" value="5" label="BED score column used for p-value calculations" help="Score column of genomic regions BED file used for p-value calculations. BED score can be e.g. log2 fold change or -log10 p-value of the region (default: 5)"/>
            <param name="search_bed_score_thr" type="float" optional="True" label="Minimum site score for filtering" help="Minimum site score (e.g. log2FC or p-value) for including regions in the analysis, assuming higher score == better site (default fallback of 0 to include all sites)."/>
            <param name="search_regex" type="text" optional="True" label="Regex DNA motif to include in search" help="Define regular expression (regex) DNA motif to include in search, e.g. --regex AAACC, --regex 'C[ACGT]AC[AC]'"/>
            <param name="search_unstranded" type="boolean" truevalue="--unstranded" falsevalue="" checked="False" label="Treat genomic regions in BED file as NOT strand-specific" help="Set if genomic regions in BED file are NOT strand-specific, i.e., to look for motifs on both strands of the provided regions. Note that the two strands of a region will still be counted as one region (change with option below) (default: False)"/>
            <param name="search_unstranded_ct" type="boolean" truevalue="--unstranded-ct" falsevalue="" checked="False" label="Count each genomic region twice for RBP hit statistics" help="Count each genomic region twice for RBP hit statistics when non-strand-specific option above is enabled (default: False)"/>
            <param name="fimo_nt_freqs_file" type="data" format="txt" optional="True" label="Provide FIMO nucleotide frequencies file" help="Provide FIMO nucleotide frequencies (FIMO option: --bifile) file. By default, an internal frequencies file optimized for human transcripts is used"/>
        </section>
    </xml>
    <xml name="search_rna_options">
        <section name="search_options" title="Advanced settings">
            <param name="search_ext" type="text" value="0" label="Up- and downstream extension of genomic regions" help='Up- and downstream extension of genomic regions in nucleotides (nt). E.g. set to "30" to extend 30 nt on both sides, or "20,10" for different up- and downstream extension (default: 0)'/>
            <param name="motif_db" type="select" optional="true" label="Built-in motif database to use">
                <option value="1" selected="true">Human RBP motifs (257
                        RBPs, 599 motifs, "catrapid_omics_v2.1_human_6plus_ext")</option>
                <option value="2">Human RBP motifs + 23 ucRBP motifs (277 RBPs, 622
                        motifs, "catrapid_omics_v2.1_human_6plus_ext_ucrbps")</option>
                <option value="3">Human RBP motifs from Ray et al. 2013 (80 RBPs, 102
                        motifs, "ray2013_human_rbps_rnacompete")</option>
            </param>
            <param name="search_fimo_pval" type="float" value="0.001" label="FIMO p-value threshold" help='FIMO p-value threshold (FIMO option: --fimo-pval) for reporting motif hits (default: 0.001)'/>
            <param name="search_bed_score_col" type="integer" value="5" label="BED score column used for p-value calculations" help="Score column of genomic regions BED file used for p-value calculations. BED score can be e.g. log2 fold change or -log10 p-value of the region (default: 5)"/>
            <param name="search_bed_score_thr" type="float" optional="True" label="Minimum site score for filtering" help="Minimum site score (e.g. log2FC or p-value) for including regions in the analysis, assuming higher score == better site (default fallback of 0 to include all sites)."/>
            <param name="search_regex" type="text" optional="True" label="Regex DNA motif to include in search" help="Define regular expression (regex) DNA motif to include in search, e.g. --regex AAACC, --regex 'C[ACGT]AC[AC]'"/>
            <param name="fimo_nt_freqs_file" type="data" format="txt" optional="True" label="Provide FIMO nucleotide frequencies file" help="Provide FIMO nucleotide frequencies (FIMO option: --bifile) file. By default, an internal frequencies file optimized for human transcripts is used"/>
        </section>
    </xml>
    <xml name="search_longrna_options">
        <section name="search_options" title="Advanced settings">
            <param name="motif_db" type="select" optional="true" label="Built-in motif database to use">
                <option value="1" selected="true">Human RBP motifs (257
                        RBPs, 599 motifs, "catrapid_omics_v2.1_human_6plus_ext")</option>
                <option value="2">Human RBP motifs + 23 ucRBP motifs (277 RBPs, 622
                        motifs, "catrapid_omics_v2.1_human_6plus_ext_ucrbps")</option>
                <option value="3">Human RBP motifs from Ray et al. 2013 (80 RBPs, 102
                        motifs, "ray2013_human_rbps_rnacompete")</option>
            </param>
            <param name="search_fimo_pval" type="float" value="0.001" label="FIMO p-value threshold" help='FIMO p-value threshold (FIMO option: --fimo-pval) for reporting motif hits (default: 0.001)'/>

            <param name="fimo_nt_freqs_file" type="data" format="txt" optional="True" label="Provide FIMO nucleotide frequencies file" help="Provide FIMO nucleotide frequencies (FIMO option: --bifile) file. By default, an internal frequencies file optimized for human transcripts is used"/>
        </section>
    </xml>
    <xml name="advanced_html_output_options_sort_js">
        <param name="store_sort_js_in_html" type="boolean" checked="False" label="Embed JS code for table sorting inside HTML?" help="Store JavaScript code for table sorting inside output HTML files. By default link to packaged JS file included into HTML report."/>
    </xml>
    <xml name="advanced_html_output_options_plotly_js">
        <param name="plotly_js_mode" type="select" label="Define how to provide plotly JS code">
            <option value="1" selected="true">Use online version via "cdn"</option>
            <option value="2">Put link to packaged plotly JS file into HTML report</option>
            <option value="5">Put web version link and plotly plot codes into HTML report</option>
            <option value="6">Put local version link and plotly plot codes into HTML report</option>
            <option value="7">Enbed plotly JS and plotly plot codes into HTML report</option>
        </param>
    </xml>
    <token name="@HELP_HEADER@"><![CDATA[

**What is RBPBench?**

RBPBench is multi-function tool to evaluate CLIP-seq and other genomic region data using a comprehensive collection of known RNA-binding protein (RBP) binding motifs. RBPBench can be used for a variety of purposes, from RBP motif search (database or user-supplied RBPs) in genomic regions, over motif enrichment and co-occurrence analysis, in-depth comparisons over multiple datasets via sequence and genomic annotation statistics, to benchmarking CLIP-seq peak caller methods as well as comparisons across cell types and CLIP-seq protocols. RBPBench supports both sequence and structure motifs, as well as regular expressions. Moreover, users can easily provide their own motif collections. For more details, visit the `RBPBench GitHub repository`_ or the `RBPBench website`_.

.. _RBPBench GitHub repository: https://github.com/michauhl/RBPBench
.. _RBPBench website: https://backofenlab.github.io/RBPBench
    ]]>    </token>
    <xml name="citations">
        <citations>
            <citation type="doi">10.1093/nar/gkae410</citation>
        </citations>
    </xml>
    <xml name="creator">
        <creator>
            <organization name="European Galaxy Team" url="https://galaxyproject.org/eu/"/>
            <person givenName="Michael" familyName="Uhl" email="uhlm@informatik.uni-freiburg.de"/>
            <yield/>
            <person givenName="Polina" familyName="Polunina" email="polunina@informatik.uni-freiburg.de"/>
        </creator>
    </xml>
</macros>