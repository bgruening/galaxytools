<tool id="rbpbench_dist" name="RBPBench Plot" version="@TOOL_VERSION@+galaxy@VERSION_SUFFIX@" profile="@profile@">

    <description>nucleotide distribution at genomic positions</description>
    <macros>
        <import>macros.xml</import>
    </macros>
    <expand macro="bio_tools"/>
    <expand macro="requirements"/>

    <command detect_errors="exit_code"><![CDATA[
        @PREPARE_REF@
        rbpbench dist
            --in '$dist_bed_file'
            --out ./
            --genome reference.fa
            --cp-mode $dist_options.dist_cp_mode
            --ext $dist_options.dist_ext
            $dist_options.dist_plot_pdf
    ]]>    </command>

    <inputs>
        <param name="dist_bed_file" type="data" format="bed" label="Genomic regions BED file" help="Genomic regions (e.g. RBP binding sites) in BED format. Zero position for plotting can be defined in options"/>

        <expand macro="reference_genome"/>

        <section name="dist_options" title="Nucleotide distribution plot settings">
            <param name="dist_cp_mode" type="integer" min="1" max="3" value="1" label="Define zero position for plotting" help="Define which position of genomic sites to use as zero position for plotting. 1: upstream end position, 2: center position, 3: downstream end position (default: 1)"/>
            <param name="dist_ext" type="integer" value="10" label="Up- and downstream extension of defined genomic positions" help="Up- and downstream extension of defined genomic positions in nucleotides (nt) to include in plotting (default: 10)"/>
            <param name="dist_plot_pdf" type="boolean" truevalue="--plot-pdf" falsevalue="" checked="False" label="Plot as PDF?" help="Plot nucleotide distribution as PDF (default: PNG)"/>
            <param name="sites_bed_fasta_out" type="boolean" checked="False" label="Output genomic regions BED + FASTA files" help="Output genomic regions BED/FASTA file used for plotting"/>
        </section>

    </inputs>

    <outputs>
        <data name="nt_dist_plot_png_file" format="png" from_work_dir="nt_dist_zero_pos.png" label="${tool.name} on ${on_string}: Nucleotide distribution plot PNG">
            <filter>not dist_options["dist_plot_pdf"]</filter>
        </data>
        <data name="nt_dist_plot_pdf_file" format="pdf" from_work_dir="nt_dist_zero_pos.pdf" label="${tool.name} on ${on_string}: Nucleotide distribution plot PDF">
            <filter>dist_options["dist_plot_pdf"]</filter>
        </data>
        <data name="plot_sites_bed_file" format="bed" from_work_dir="in_sites.filtered.bed" label="${tool.name} on ${on_string}: Genomic regions used for plotting BED">
            <filter>dist_options["sites_bed_fasta_out"]</filter>
        </data>
        <data name="plot_sites_fa_file" format="fasta" from_work_dir="in_sites.filtered.fa" label="${tool.name} on ${on_string}: Genomic regions used for plotting FASTA">
            <filter>dist_options["sites_bed_fasta_out"]</filter>
        </data>
    </outputs>

    <tests>
        <test expect_num_outputs="3">
            <param name="dist_bed_file" value="test.bed" />
            <conditional name="reference_genome">
                <param name="reference_genome_selector" value="history"/>
                <param name="history_genome" value="test.fa"/>
            </conditional>
            <section name="dist_options">
                <param name="dist_cp_mode" value="1"/>
                <param name="dist_ext" value="10"/>
                <param name="dist_plot_pdf" value="false"/>
                <param name="sites_bed_fasta_out" value="true"/>
            </section>
            <output name="nt_dist_plot_png_file" file="nt_dist_plot.test.png" compare="sim_size"/>
            <output name="plot_sites_bed_file" file="in_sites.filtered.test.bed"/>
            <output name="plot_sites_fa_file" file="in_sites.filtered.test.fa"/>
        </test>

    </tests>

    <help><![CDATA[
@HELP_HEADER@

-----

**RBPBench program modes**

*RBPBench Plot* on Galaxy provides the following main functions: 

- Plot nucleotide distribution at genomic positions

**Plot nucleotide distribution at genomic positions**

In this mode, a set of genomic regions is input and the nucleotide distribution is plotted around a defined center positions (*Nucleotide distribution plot settings -> Define zero position for plotting*). By default, the upstream end position of each region is used (other choices are center and downstream end). This for example enables us to look at CLIP-seq crosslink positions and potential nucleotide biases at these sites.

    ]]>    </help>
    <expand macro="citations"/>
    <expand macro="creator"/>
</tool>