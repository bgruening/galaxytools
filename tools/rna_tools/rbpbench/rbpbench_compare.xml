<tool id="rbpbench_compare" name="RBPBench Compare" version="@TOOL_VERSION@+galaxy@VERSION_SUFFIX@" profile="@profile@">

    <description>different motif search results</description>
    <macros>
        <import>macros.xml</import>
    </macros>
    <expand macro="bio_tools"/>
    <expand macro="requirements"/>

    <command detect_errors="exit_code"><![CDATA[
        rbpbench compare
            --in 
            #for $in_file in $input_tables:
                $in_file
            #end for
            --out ./
            @SORT_JS@
    ]]>    </command>

    <inputs>
        <param name="input_tables" type="data" format="tabular" label="Motif search results" help="Supply motif search results table files for comparison. These are the hit statistics table files output by single or batch motif search jobs. Both RBP and motif hit statistics table files are needed, and can be from any single or batch search job." multiple="true"/>

        <section name="compare_output_options" title="Output options">
            <param name="compared_motif_hits_table" type="boolean" checked="False" label="Output compared motif hits table file" help="Output compared motif hits table file showing motif hits and which data or method IDs contain them"/>
            <param name="compared_motif_hits_bed" type="boolean" checked="False" label="Output compared motif hits BED file" help="Output compared motif hits table file showing motif hits and which data or method IDs contain them in BED format"/>
            <param name="comparisons_stats_out" type="boolean" checked="False" label="Output comparison statistics table file" help="Output comparison statistics table file containing the statistics found in the comparison HTML report"/>
        </section>

        <section name="advanced_html_output_options" title="Advanced HTML report options">
            <expand macro="advanced_html_output_options_sort_js"/>
        </section>

    </inputs>

    <outputs>
        <data name="compare_report_html_file" format="html" from_work_dir="report.rbpbench_compare.html" label="${tool.name} on ${on_string}: Comparison report HTML">
        </data>
        <data name="compared_motif_hits_bed_file" format="bed" from_work_dir="motif_hits.rbpbench_compare.bed" label="${tool.name} on ${on_string}: Compared motif hits BED">
            <filter>compare_output_options["compared_motif_hits_bed"]</filter>
        </data>
        <data name="compared_motif_hits_table_file" format="tabular" from_work_dir="motif_hits.rbpbench_compare.tsv" label="${tool.name} on ${on_string}: Compared motif hits table">
            <filter>compare_output_options["compared_motif_hits_table"]</filter>
        </data>
        <data name="compared_stats_table_file" format="tabular" from_work_dir="comparison_stats.rbpbench_compare.tsv" label="${tool.name} on ${on_string}: Comparison statistics table">
            <filter>compare_output_options["comparisons_stats_out"]</filter>
        </data>

    </outputs>
    <tests>
        <test expect_num_outputs="4">
            <param name="input_tables" value="rbp_hit_stats.compare_test.dewseq.tsv,rbp_hit_stats.compare_test.clipper_idr.tsv,motif_hit_stats.compare_test.dewseq.tsv,motif_hit_stats.compare_test.clipper_idr.tsv" ftype="tabular" />
            <section name="compare_output_options">
                <param name="compared_motif_hits_table" value="true"/>
                <param name="compared_motif_hits_bed" value="true"/>
                <param name="comparisons_stats_out" value="true"/>
            </section>
            <output name="compare_report_html_file" file="report.rbpbench_compare.test.html" compare="sim_size"/>
            <output name="compared_motif_hits_bed_file" file="motif_hits.rbpbench_compare.test.bed"/>
            <output name="compared_motif_hits_table_file" file="motif_hits.rbpbench_compare.test.tsv"/>
            <output name="compared_stats_table_file" file="comparison_stats.rbpbench_compare.test.tsv"/>
        </test>
    </tests>

    <help><![CDATA[
@HELP_HEADER@

-----

**RBPBench program modes**

*RBPBench Compare* on Galaxy provides the following main functions:

- Compare different search results

**Compare different search results**

This mode is used to compare different motif search results (produced by any of the three motif search modes in subtool *RBPBench Search*). Inputs are the RBP and motif hit statistics table files output by the motif subtool *RBPBench Search*. The set method IDs and data IDs (together with the selected RBP IDs) define what gets compared in comparison mode. Based on the IDs in the input tables, RBPBench looks for combinations of RBP ID+method ID+data ID, and produces method-ID-centered (with fixed RBP ID + data ID) and / or data-ID-centered (with fixed RBP ID + method ID) comparisons. At least two different IDs are needed for a comparison (e.g. two different method IDs or two different data IDs, with same RBP ID).
The comparison results are presented in an HTML report file, containing a hit statistics table and a 
Venn diagram plot for each found combination. Moreover, the report results are output as table files,
and the combined motifs are output in BED format, for a data ID / method ID centered comparison e.g. inside a Genome Viewer. Comparing numbers of unique and shared motif hits between methods also serves as a way of benchmarking different methods. Since no ground truth (i.e., set of true / experimentally verified transcriptome-wide binding sites of an RBP) exists, one obvious way to benchmark peak calling methods is to look at the enrichment of known RBP binding motifs in regions reported by the peak callers.
RBPBench makes such evaluations easy, especially by combining modes search, batch (subtool *RBPBench Search*), and compare (subtool *RBPBench Compare*).

    ]]>    </help>
    <expand macro="citations"/>
    <expand macro="creator"/>
</tool>