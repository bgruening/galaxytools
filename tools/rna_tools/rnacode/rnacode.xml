<tool id="rbc_rnacode" name="RNAcode" version="0.3.0">
    <description>Analyze the protein coding potential in MSA</description>
    <requirements>
        <requirement type="package" version="0.3">rnacode</requirement>
    </requirements>
    <stdio>
        <exit_code range="1:"  level="fatal" description="Error occurred. Please check Tool Standard Error"/>
        <exit_code range=":-1" level="fatal" description="Error occurred. Please check Tool Standard Error"/>
    </stdio>
    <version_command>RNAcode --version</version_command>
    <command>
    <![CDATA[
        RNAcode
        
        #if $outputFormat.value == 'default'
            --tabular
        #elif $outputFormat.value == 'gtf'
            --gtf
        #end if
        
        $generateEPS
        
        $alignment
        
        #if $outputFormat.value == 'default'
            --outfile $outFileDefault
        #elif $outputFormat.value == 'gtf'
            --outfile $outFileGTF
        #end if
        
    ]]>
    </command>
    <inputs>
        <param name="alignment" type="data" format="clustal,maf" label="Multiple Alignment" help="Alignment needs to be formatted in ClustalW or MAF format"/>
        <param name="generateEPS" type="boolean" truevalue="--eps" falsevalue="" label="Create colored plots in EPS format" help="The generated plots are resolution independent vector graphics that can be included in any graphics software. For each high scoring segment below a given cutoff (see --eps-cutoff) a file named hss-N.eps is created (N is the running number of the high scoring segment)"/>
        <param name="outputFormat" type="select" label="Output format">
            <option value="default" selected="true">Default</option>
            <option value="gtf">GTF genome annotation file</option>
        </param>
    </inputs>
    <outputs>
        <data argument="--outfile" name="outFileDefault" format="tabular" label="${tool.name} on ${on_string}">
            <filter>outputFormat == 'default'</filter>
        </data>
        <data argument="--outfile" name="outFileGTF" format="gtf" label="${tool.name} on ${on_string}">
            <filter>outputFormat == 'gtf'</filter>
        </data>
    </outputs>
    <tests>
        <test>
            <param name="alignment" value="coding.aln"/>
            <param name="generateEPS" value="False"/>
            <param name="outputFormat" value="default"/>
            <output name="outFileDefault" ftype="tabular" file="rnacode_result1.tabular" compare="sim_size"/>
        </test>
        <test>
            <param name="alignment" value="coding.maf"/>
            <param name="generateEPS" value="False"/>
            <param name="outputFormat" value="gtf"/>
            <output name="outFileGTF" ftype="gtf" file="rnacode_result2.gtf" compare="sim_size"/>
        </test>
    </tests>
    <help>
<![CDATA[
**RNAcode** 
Predicts protein coding regions in an alignment of homologous
nucleotide sequences. The prediction is based on evolutionary
signatures typical for protein genese, i.e. the presence of
synonyomous/conservative nucleotide mutations, conservation of the
reading frame and absence of stop codons.

RNAcode does not rely on any species specific sequence characteristics
whatsoever and does not use any machine learning techniques. The only
input required for RNAcode is a multiple sequence alignment either in
MAF or Clustal W format. RNAcode reports local regions of unusual high
coding potential together with an associated p-value.

**Input alignment**

The input alignment needs to be formatted in ClustalW format or MAF
format (http://genome.ucsc.edu/FAQ/FAQformat#format5). The latter
format allows to include genomic coordinates which can be used to
produce annotation files. 

Important: RNAcode uses the first sequence as reference sequence,
i.e. all results and reported coding regions apply to this reference
sequence.

Currently the alignments has to contain at least 3 sequences. Gaps
have to be given as dash ('-'). Unspecified letters given as 'N' are
allowed and treated neutrally during all calculations. No difference is
made between uppercase or lowercase input, i.e. 'softly'-repeat masked
sequences which use lowercase letters for masked regions are treated
the same way as unmasked sequences.

**Output format**

In the default output each prediction is reported on one line by 10 fields.

1. HSS id    Unique running number for each high scoring segment
             predicted in one RNAcode call

2. Frame:    The reading frame phasing relative to the starting
             nucleotide position in the reference sequence. +1 means
             that the first nucleotide in the reference sequence is in
             the same frame as the predicted coding region. Negative
             frames indicate that the predicted regions are on the
             reverse complement strand.

3. Length:   The length of the predicted region in amino acids

4. From:     The position of the first/last amino acid in the translated
5. To:       nucleotide sequence of the reference sequence starting
             with 1.

6. Name      The name of the reference sequence as given in the input alignment.
  
7. Start     The nucleotide position in the reference sequence of the

8. End       predicted coding region. If no genomic coordinates are given
             (if you provide a CLUSTAL W as input) the first nucleotide position in
             the references sequence is set to 1, otherwise the positions are the
             1-based genomic coordinates as given in the input MAF file.

9.  Score    The coding potential score. High scores indicate high coding potential. 

10. P        The p-value associated with the score. This is the probability
             that a random alignment with same properties contains an equally good
             or better hit.
]]>
    </help>
    <citations>
        <citation type="doi">10.1261/rna.2536111</citation>
    </citations>
</tool>
