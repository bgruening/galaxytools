<tool id="dotprep" name="dotPrep" version="@TOOL_VERSION@+galaxy@VERSION_SUFFIX@" profile="@PROFILE@" license="MIT">
    <description>Apply unique anchor filtering and prepare Dot coordinates</description>
        <macros>
        <token name="@TOOL_VERSION@">1.0</token>
        <token name="@VERSION_SUFFIX@">0</token>
        <token name="@PROFILE@">25.0</token>
    </macros>
    <command detect_errors="exit_code"><![CDATA[
        ln -s '$delta' input.delta.gz &&
        python3 '$__tool_directory__/dotPrep.py'
            --delta input.delta.gz
            --out result
            --unique-length $unique_length
            --overview $overview
    ]]></command>
    <inputs>
        <param name="delta" type="data" format="tabular" label="Delta file" help="Input delta file from alignment tool (e.g., MUMmer)"/>
        <param name="unique_length" type="integer" value="10000" min="0" label="Unique sequence length threshold" help="The total length of unique sequence an alignment must have on the query side to be retained"/>
        <param name="overview" type="integer" value="1000" min="1" label="Number of alignments for overview" help="The number of alignments to include in the coords.idx output file for Dot overview"/>
    </inputs>
    <outputs>
        <data name="result" format="tabular" label="${tool.name} on ${on_string}: Output delta file" from_work_dir="result.uniqueAnchorFiltered*"/>
        <data name="coords" format="tabular" label="${tool.name} on ${on_string}: filtered coords" from_work_dir="result.coords"/>
        <data name="coords_idx" format="tabular" label="${tool.name} on ${on_string}: coords.idx" from_work_dir="result.coords.idx"/>
    </outputs>
    <tests>
        <test expect_num_outputs="3">
            <param name="delta" location="https://zenodo.org/records/17592326/files/input.res.uniqueAnchorFiltered_l10000.delta.gz"/>
            <param name="unique_length" value="10000"/>
            <param name="overview" value="1000"/>
            <output name="result" location="https://zenodo.org/records/17592326/files/test_output.delta.gz" compare="sim_size"/>
            <output name="coords" ftype="tabular">
                <assert_contents>
                    <has_n_lines n="21848"/>
                    <has_line line="28999,29316,9912,10233,h1tg000718l"/>
                    <has_line line="32087,32264,16943,17122,h1tg000718l"/>
                    <has_line line="41139,41490,26157,26508,h1tg000718l"/>
                </assert_contents>
            </output>
            <output name="coords_idx" ftype="tabular">
                <assert_contents>
                    <has_n_lines n="1840"/>
                </assert_contents>
            </output>
        </test>
    </tests>
    <help><![CDATA[
**What it does**

This tool takes a delta file from genome alignment tools (such as MUMmer's nucmer), applies unique anchor filtering, and prepares coordinate input files for visualization with Dot.

**Inputs**

- **Delta file**: Output from alignment programs like MUMmer's nucmer
- **Unique sequence length threshold**: Minimum total length of unique sequence an alignment must have on the query side to be retained (Default: 10000 bp)
- **Number of alignments for overview**: Number of top alignments to include in the coords.idx file for Dot overview visualization (Default: 1000)

**Outputs**

- **Filtered coords file**: Coordinate file with unique anchor filtering applied
- **coords.idx file**: Index file containing top alignments for Dot visualization overview

**About Unique Anchor Filtering**

The unique anchor filtering strategy identifies high-quality alignments by requiring a minimum amount of unique sequence. This helps filter out repetitive regions and focus on reliable anchoring points between sequences.

**Aknowledgements**

dotPrep is part of Assemblytics, developed by Maria Nattestad. For more information, please visit the [Assemblytics GitHub repository](https://github.com/MariaNattestad/dot/tree/master)

    ]]></help>
<citations>
        <citation type="bibtex">
            @misc{githubdotprep,
            author = {MariaNattestad},
            year = {2023},
            title = {dotPrep},
            publisher = {GitHub},
            journal = {GitHub repository},
            url = {https://github.com/MariaNattestad/dot/blob/master/DotPrep.py},
        }</citation>
    </citations>
    <creator>
        <person givenName="Saim" familyName="Momin" url="https://github.com/SaimMomin12" identifier="https://orcid.org/0009-0003-9935-828X"/>
        <organization name="Galaxy Europe" url="https://galaxyproject.org/eu/"/>
    </creator>
</tool>