<tool id="methylkit" name="methylKit" version="0.99.2">
  <description>A method for DNA methylation analysis and annotation from high-throughput bisulfite sequencing</description>
  <requirements>
    <requirement type="package" version="0.99.2">bioconductor-methylkit</requirement>
  </requirements>
  <command interpreter="bash">r_wrapper.sh $script_file</command>

  <inputs>
    <repeat name="test_series" title="Test samples" min="1">
                <param name="input" type="data" format="txt" label="Add a file"
                    help="Such input file may be obtained from AMP pipeline for aligning RRBS reads." />
    </repeat>
    <repeat name="control_series" title="Control samples" min="1">
                <param name="input" type="data" format="txt" label="Add a file"
                    help="Such input file may be obtained from AMP pipeline for aligning RRBS reads." />
    </repeat>
  </inputs>

  <configfiles>
    <configfile name="script_file">
        test_files = list()
        control_files = list()

        test_ids = list()
        control_ids = list()

        #for $i, $s in enumerate( $test_series )
          test_ids[${i}] = past("test", ${i}, sep="")
          test_files[${i}] = "${s.input.file_name}"
        #end for

        #for $i, $s in enumerate( $control_series )
          control_ids[${i}] = past("control", ${i}, sep="")
          control_files[${i}] = "${s.input.file_name}"
        #end for

        sample_ids = append(test_ids, control_ids)
        treatment_tag = c(rep.int(1, length(test_ids)), rep.int(0, length(control_ids)))

        myobj=methRead( file.list,
                    sample.id=sample_ids,assembly="hg18",pipeline="amp",treatment=treatment_tag)

        # unite function
        methidh=unite(myobj)

        pdf( "${out_file1}" )
        methClust = clusterSamples(methidh)
        devname = dev.off()

        pdf( "${out_file2}" )
        PCASamples(methidh)
        devname = dev.off()
    </configfile>

  </configfiles>

  <outputs>
    <data format="pdf" name="out_file1" />
  </outputs>

    <tests>
        <test>

        </test>
    </tests>
<help>

</help>
</tool>
