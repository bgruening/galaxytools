<tool id="hicup_truncater" name="Truncater" version="0.1.0">
    <requirements>
        <requirement type="package" version="0.5.9">hicup</requirement>
    </requirements>
    <stdio>
        <exit_code range="1:" />
    </stdio>
    <command><![CDATA[
        hicup_truncater --re1 '$re1' $advanced_options.nofill 
        #if $advanced_options.sequences:
            --sequences '$advanced_options.sequences'
        #end if
        '$input_first_sequence' '$input_second_sequence'
        && ls -la
        && mv hicup_truncater_summary* hicup_truncater_summary.txt
        && trunc_result=\$(echo '$input_first_sequence' | rev | cut -d'/' -f1 | rev)
        && trunc_result+=".trunc.fastq"
        && echo \$trunc_result
        && echo '$input_first_sequence'
        && mv \$trunc_result dataset1.trunc.fastq
        && trunc_result=\$(echo '$input_second_sequence' | rev | cut -d'/' -f1 | rev)
        && trunc_result+=".trunc.fastq"
        && mv \$trunc_result dataset2.trunc.fastq   
        
    ]]></command>
    <inputs>
        <param name="input_first_sequence" type="data" format="fastq" label="First input sequence" help="The first sequence for the truncater."/>
        <param name="input_second_sequence" type="data" format="fastq" label="Second input sequence" help="The second sequence for the truncater."/>
        <param argument="--re1" type="text" value="" label="Restriction enzyme recognition sequence" help="Restriction enzyme recognition sequence"/>
        <section name="advanced_options" title="Advanced options">        
            <param argument="--nofill" type="boolean" value="false" truevalue="--nofill" falsevalue="" label="No fill" help="Hi-C protocol did NOT include a fill-in of sticky ends prior to re-ligation and therefore reads shall be truncated at the restriction site sequence"/>
            <param argument="--sequences" type="text" value="" label="Ligation sequence" help="Instead of specifying a restriction enzyme recognition sequence, specify the ligation sequences directly"/>
        </section>
    </inputs>
    <outputs>
        <data name="Rplots" format="pdf" label="Rplots.pdf" from_work_dir="Rplots.pdf" />
        <data name="hicup_truncater_summary" format="txt" label="hicup_truncater_summary.txt" from_work_dir="hicup_truncater_summary.txt" />
        <data name="dataset1.trunc" format="fastq" label="dataset1.trunc.fastq" from_work_dir="dataset1.trunc.fastq" />
        <data name="dataset2.trunc" format="fastq" label="dataset2.trunc.fastq" from_work_dir="dataset2.trunc.fastq" />
    </outputs>
     <tests>
        <test>
            <param name="input_first_sequence" value="dataset1.fastq" ftype="fastq"/>
            <param name="input_second_sequence" value="dataset2.fastq" ftype="fastq"/>
            <param name="re1" value="A^AGCTT"/>
            <output name="Rplots" file="Rplots.pdf"/>
            <output name="hicup_truncater_summary" file="hicup_truncater_summary.txt"/>
            <output name="dataset1.trunc.fastq" file="dataset1.trunc.fastq"/>
            <output name="dataset2.trunc.fastq" file="dataset2.trunc.fastq"/>
        </test>
    </tests>
    <help><![CDATA[

    For help please consult the documentation of HiCUP: http://www.bioinformatics.babraham.ac.uk/projects/hicup/overview/

    To get more information about the truncater visit: http://www.bioinformatics.babraham.ac.uk/projects/hicup/scripts_description/#Truncater
    ]]></help>

    <citations>
        <citation type="bibtex">
            @article{wingett2015hicup,
                title={HiCUP: pipeline for mapping and processing Hi-C data},
                author={Wingett, Steven and Ewels, Philip and Furlan-Magaril, Mayra and Nagano, Takashi and Schoenfelder, Stefan and Fraser, Peter and Andrews, Simon},
                journal={F1000Research},
                volume={4},
                year={2015},
                publisher={Faculty of 1000 Ltd}
                }
        </citation>
    </citations>
</tool>
