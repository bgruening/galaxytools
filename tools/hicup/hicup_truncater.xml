<tool id="hicup_truncater" name="HiCUP Truncater" version="0.1.0">
    <requirements>
        <requirement type="package" version="0.5.9">hicup</requirement>
    </requirements>
    <stdio>
        <exit_code range="1:" />
    </stdio>
    <command><![CDATA[
        hicup_truncater --re1 $re1 $advanced_options.nofill 
        #if $advanced_options.index:
            --index $advanced_options.index
        #end if
        #if $advanced_options.sequences:
            --sequences $advanced_options.sequences
        #end if
        --threads $advanced_options.threads $advanced_options.zip
        #for $file_pair in $input_files:
            $file_pair.input_first_sequence $file_pair.input_second_sequence
        #end for
    ]]></command>
    <inputs>
         <repeat name="input_files" min="1" max="10000" title="Select input file(s):">
            <param name="input_first_sequence" type="data" format="fastq,fa" label="First input sequence" help="The first sequence for the truncater."/>
            <param name="input_second_sequence" type="data" format="fastq,fa" label="Second input sequence" help="The second sequence for the truncater."/>
        </repeat>
        <param argument="--re1" type="text" value="" label="Restriction enzyme recognition sequence" help="Restriction enzyme recognition sequence"/>
        <section name="advanced_options" title="Advanced options">        
            <param argument="--nofill" type="boolean" value="false" truevalue="--nofill" falsevalue="" label="No fill" help="Hi-C protocol did NOT include a fill-in of sticky ends prior to re-ligation and therefore reads shall be truncated at the restriction site sequence"/>
            <param argument="--sequences" type="text" value="" label="Ligation sequence" help="Instead of specifying a restriction enzyme recognition sequence, specify the ligation sequences directly"/>
            <param argument="--threads" type="integer" value="1" label="Threads" help="Specify the number of threads, allowing simultaneous processing of multiple files"/>
            <param argument="--zip" type="boolean" value="false" truevalue="--zip" falsevalue="" label="Compress output" help="Compress the output with zip"/>
        </section>
    </inputs>
    <outputs>
    <data format="txt" name="hicup_truncater_summary">
        <discover_datasets pattern="__designation_and_ext__" visible="true" />
    </data>
    </outputs>

    <help><![CDATA[
        
Valid Hi-C pairs comprise two DNA fragments from different regions of the genome ligated together. Typically, a forward read maps to one ligation fragment; the reverse read maps to the other. However, this is not always true since the Hi-C ligation junction may be found within the sequenced region. Such reads will most likely be removed from the Hi-C pipeline during the mapping process, thereby losing potentially valid data. The hicup_truncater script helps remedy this by identifying ligation junctions within reads and deleting sequence downstream of the restriction enzyme recognition site.

The names of the files to be processed and the restriction site may be passed to the scrip using a configuration file or command line arguments. The configuration file contains: i) the recognition sequence of the first (or only) restriction enzyme used in the Hi-C protocol and ii) the sequence files to be processed by the HiCUP Truncater.
    ]]></help>

    <citations>
        <citation type="bibtex">
            @article{wingett2015hicup,
                title={HiCUP: pipeline for mapping and processing Hi-C data},
                author={Wingett, Steven and Ewels, Philip and Furlan-Magaril, Mayra and Nagano, Takashi and Schoenfelder, Stefan and Fraser, Peter and Andrews, Simon},
                journal={F1000Research},
                volume={4},
                year={2015},
                publisher={Faculty of 1000 Ltd}
                }
        </citation>
    </citations>
</tool>
