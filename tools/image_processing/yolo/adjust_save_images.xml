<tool id="adjust_save_images" name="Adjust input images for YOLO" version="@VERSION@+galaxy0" profile="24.2">
    <description>Adjust contrast of input TIF images,and/or covnert them into 8bit RGB</description>
    <macros>
        <import>macros.xml</import>
    </macros>
    <requirements>
        <requirement type="package" version="0.25.2">scikit-image</requirement>
        <requirement type="package" version="3.0">zip</requirement>
    </requirements>
    <command detect_errors="aggressive">
    <![CDATA[
      mkdir ./input ./output &&

      #if $con_input_type.input_type =="yes"
          tar -C ./input -xvf $con_input_type.input_images &&
      #else
          #for $i, $filename in enumerate($con_input_type.input_images):
              ln -s '$filename' './input/${filename.element_identifier}.${filename.ext}' &&
          #end for
      #end if

      python '$__tool_directory__/adjust_save_images.py' 
		    --input_folder ./input 
		    --results_folder ./output 
		    #if $clahe:
		        --clahe
		    #end if
		    #if $convert8bit:
		        --convert8bit
		    #end if
    ]]>
    </command>
    <inputs>
	 <conditional name="con_input_type">
            <param name="input_type" type="select" label="Are the input images packed into a tar archive?">
                <option value="yes">Yes</option>
                <option value="no">No</option>
            </param>
            <when value="no">
                <param name="input_images" type="data" multiple="true" format="tif,tiff" label="Images" />
            </when>
            <when value="yes">
                <param name="input_images" type="data" format="tar" label="A tarball of images" />
            </when>
        </conditional>
        <param name="clahe" type="boolean" label="Apply CLAHE" checked="true" />
        <param name="convert8bit" type="boolean" label="Convert to 8-bit" checked="true" />
     </inputs>
    <outputs>
        <collection name="output_jpgs" type="list" label="Adjusted JPEGS">
		<discover_datasets pattern="(?P&lt;name&gt;.+)\.jpg" visible="true" directory="./output/jpegs" format="jpg"/>
        </collection>
    </outputs>
    <tests>
        <test>
             <conditional name="con_input_type">
                 <param name="input_type" value="yes"/>
                 <param name="input_images" location="https://zenodo.org/records/15611612/files/images.tar"/>
             </conditional>
             <param name="clahe" value="true"/>
             <param name="convert8bit" value="true"/>
            <output_collection name="output_jpgs" type="list">
		<element name="0001" file="jpegs/0001.jpg" ftype="jpg"/>
                <element name="0003" file="jpegs/0003.jpg" ftype="jpg"/>
            </output_collection>
        </test>
    </tests>
    <help><![CDATA[
      **What it does**
	
        This tool processes a folder of .tif images by applying optional CLAHE and 8-bit conversion.

        Inputs:
        - A tar file of .tif images.

        Outputs:
        - A dataset collection of .jpg files.

        Options:
        - CLAHE: Contrast limited adjustment.
        - 8-bit: Convert  images to 8-bit.
    ]]>
    </help>
    <expand macro="citations" />
</tool>
