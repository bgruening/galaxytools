<?xml version='1.0' encoding='UTF-8'?>
<tool id="imagej2_adjust_threshold_binary" name="Adjust binary threshold" version="1.0.0">
    <description>with ImageJ2</description>
    <macros>
        <import>imagej2_macros.xml</import>
    </macros>
    <expand macro="fiji_20141125_requirements" />
    <command>
<![CDATA[
    python $__tool_directory__/imagej2_adjust_threshold_binary.py
    --input "$input"
    --input_datatype $input.ext
    @adjust_threshold_binary_args@
    @max_heap_size_args@
    --jython_script $__tool_directory__/jython_script.py
    --output_datatype $output_datatype
    --output "$output"
]]>
    </command>
    <inputs>
        <param format="bmp,eps,gif,jpg,pcx,pgm,png,psd,tiff" name="input" type="data" label="Select image"/>
        <expand macro="adjust_threshold_binary_params" />
        <param name="output_datatype" type="select" label="Save as format">
            <expand macro="image_datatypes" />
        </param>
        <expand macro="max_heap_size_type_conditional" />
    </inputs>
    <outputs>
        <data name="output" format_source="input" label="${tool.name} on ${on_string}">
            <actions>
                <action type="format">
                    <option type="from_param" name="output_datatype" />
                 </action>
           </actions>
       </data>
    </outputs>
    <tests>
        <test>
            <param name="input" value="blobs.gif" />
            <param name="output_datatype" value="gif" />
            <param name="threshold_min" value="0.0" />
            <param name="threshold_max" value="129.0" />
            <param name="method" value="Default" />
            <param name="display" value="red" />
            <param name="dark_background" value="no" />
            <param name="stack_histogram" value="no" />
            <output name="output" file="blobs_threshold_default.gif" compare="sim_size" />
        </test>
        <test>
            <param name="input" value="blobs.gif" />
            <param name="output_datatype" value="gif" />
            <param name="threshold_min" value="118.0" />
            <param name="threshold_max" value="255.0" />
            <param name="method" value="IJ_IsoData" />
            <param name="display" value="over_under" />
            <param name="dark_background" value="no" />
            <param name="stack_histogram" value="no" />
            <output name="output" file="blobs_threshold_ijiso.gif" compare="sim_size" />
        </test>
        <test>
            <param name="input" value="blobs.gif" />
            <param name="output_datatype" value="gif" />
            <param name="threshold_min" value="72.0" />
            <param name="threshold_max" value="255.0" />
            <param name="method" value="Huang" />
            <param name="display" value="bw" />
            <param name="dark_background" value="yes" />
            <param name="stack_histogram" value="no" />
            <output name="output" file="blobs_threshold_huang_dark.gif" compare="sim_size" />
        </test>
    </tests>
    <help>
.. class:: warningmark

This tool works on binary images, so other image types will automatically be converted to binary
before they are analyzed.  This step is performed using the ImageJ2 **Make Binary** command with
the following settings: **Iterations:** 1, **Count:** 1, **Black background:** No, **Pad edges when
eroding:** No.  If these settings are not appropriate, first manually convert the image to binary
using the **Convert to binary (black and white) with ImageJ2** tool, which allows you to change them.

**What it does**

<![CDATA[
Sets lower and upper threshold values, segmenting grayscale images into features of interest and background

- **Minimum threshold value** - Adjusts the minimum threshold value.
- **Maximum threshold value** - Adjusts the maximum threshold value.
- **Method** - Allows any of the 16 different automatic thresholding methods to be selected.  These are global thresholding methods that typically cannot deal with unevenly illuminated images (such as in brightfield microscopy)."
- **Display** - Selects one of three display mode:  **Red** displays the thresholded values in red, **Black and White** features are displayed in black and background in white, **Over/Under** displays pixels below the lower threshold value in blue, thresholded pixels in grayscale, and pixels above the upper threshold value in green.
- **Dark background** - Select **yes** when features are lighter than the background.
- **Stack histogram**  Select **yes** to first compute the histogram of the whole stack (or hyperstack) and then compute the threshold based on that histogram.  As such, all slices are binarized using the single computed value. If unchecked, the threshold of each slice is computed separately.
]]>

    </help>
    <expand macro="fiji_headless_citations" />
</tool>
