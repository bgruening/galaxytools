<tool id="woundhealing" name="Wound healing scratch assay image analysis" version="@VERSION@+galaxy1">
    <description></description>
    <macros>
        <import>macros.xml</import>
    </macros>
    <expand macro="requirements" />
    <command detect_errors="aggressive">
    <![CDATA[
	bash '$script_file' &&
        ImageJ --ij2 --headless --run '$__tool_directory__/measureWoundClosing.groovy' 'inputDir="./input",datasetId="$dataset_id",threshold="$threshold",headless="true",saveResults="true",outDirName="./output"'
		    
    ]]>
    </command>
    <configfiles>
	<configfile name="script_file">
mkdir ./input

#if $con_input_type.input_type =="yes"
    tar -C ./input -xvf $con_input_type.input_images
#else
    #for $i, $filename in enumerate($con_input_type.input_images):
        ln -s '$filename' './input/${filename.element_identifier}.${filename.ext}'
    #end for
#end if

        </configfile>
    </configfiles>

    <inputs>
	<conditional name="con_input_type">
            <param name="input_type" type="select" label="Are the input images packed into a tar archive?">
                <option value="yes">Yes</option>
                <option value="no">No</option>
            </param> 
            <when value="no">
                <param name="input_images" type="data" multiple="true" format="@FORMATS@" label="Images" />
            </when>
            <when value="yes">
                <param name="input_images" type="data" format="tar" label="A tarball of images" />
            </when>
        </conditional>
	<param name="dataset_id" type="text" label="Dataset ID" />
	<param name="threshold"  type="text" label="CoV threshold (-1: auto)" value="-1"/>
    </inputs>
    <outputs>
	    <data name="pipeline_output">
		 <discover_datasets pattern="(?P&lt;designation&gt;.+)\.csv" visible="true" directory="output" format="tabular"/>
	        <discover_datasets pattern="(?P&lt;designation&gt;.+)\.tif" visible="true" directory="output" ext="tif" />
	   </data>
    </outputs>
    <tests>
     <test >
        <conditional name="con_input_type">
            <param name="input_type" value="no" />
            <param name="input_images" value="images/A3ROI2_Slow_0000.tif,images/A3ROI2_Slow_0001.tif" />
	</conditional>
	<param name="dataset_id" value="A3ROI2_Slow" />
	<output name="pipeline_output" >
		<discovered_dataset designation="A3ROI2_Slow" file="A3ROI2_Slow.csv" ftype="tabular" compare="sim_size" delta="0"/>
	</output>
      </test>

    </tests>
    <help>
<![CDATA[

**What it does**
Automated quantification of would healing in high-throughput microscopy scartch assays.
]]>
    </help>
    <expand macro="citations" />
</tool>
