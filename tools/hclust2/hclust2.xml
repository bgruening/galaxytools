<tool id="hclust2" name="Hclust2" version="0.1.0">

    <requirements>
        <requirement type="package">hclust2</requirement>
    </requirements>

    <command detect_errors="exit_code"><![CDATA[
    	hclust2.py
    			
    				-i $i
    			#if $o == "png"
					-o '$out_png'
				#else if $o == "pdf"
					-o 'output.pdf'
				#else if $o == "svg"
					-o 'output.svg'
				#end if
        			--out_table $out_table
        			
        			--legend_file $legend_file
        			-t $t	
        			--fname_row $fname_row
        			--sname_row $sname_row
        		#if  $metadata_rows
        			--metadata_rows '$metadata_rows'
        		#end if

        		#if $skip_rows
        			--skip_rows '$skip_rows'
        		#end if

        			--sperc $sperc
        			--fperc $fperc

        		#if $stop
        			--stop '$stop'
        		#end if

				#if $ftop
        			--ftop '$ftop'
        		#end if

        		#if $def_na
        			--def_na '$def_na'
        		#end if

        			--f_dist_f $f_dist_f
        			--s_dist_f $s_dist_f

				#if $load_dist_matrix_f
					--load_dist_matrix_f '$load_dist_matrix_f'
				#end if

				#if $load_dist_matrix_s
					--load_dist_matrix_s '$load_dist_matrix_s'
				#end if

				#if $load_pickled_dist_matrix_f
					--load_pickled_dist_matrix_f '$load_pickled_dist_matrix_f'
				#end if

				#if $load_pickled_dist_matrix_s
					--load_pickled_dist_matrix_s '$load_pickled_dist_matrix_s'
				#end if

        			$save_pickled_dist_matrix_f
        			$save_pickled_dist_matrix_s
        			$no_fclustering
					$no_sclustering
        			--flinkage $flinkage
        			--slinkage $slinkage
        			--dpi $dpi
        			$log_scale

        		#if $title
        			--title '$title'
        		#end if

        			$sqrt_scale
					$no_slabels 
					$no_flabels
        		#if $minv
        			--minv '$minv'
        		#end if
        		#if $maxv
        			--maxv '$maxv'
        		#end if
        			--max_slabel_len $max_slabel_len
        			--max_flabel_len $max_flabel_len
        			--flabel_size $flabel_size
        			--slabel_size $slabel_size
        			--fdend_width $fdend_width
        			--sdend_height $sdend_height
        			--metadata_height $metadata_height
        			--metadata_separation $metadata_separation
        			--image_size $image_size
        			--cell_aspect_ratio $cell_aspect_ratio
        			-c $c
        		#if $bottom_c
        			--bottom_c '$bottom_c'
        		#end if
        		#if $top_c
        			--top_c '$top_c'
        		#end if
        		#if $nan_c
        			--nan_c '$nan_c'
        		#end if

    ]]></command>
    <inputs>

	<!--input_file-->
        <param argument="-i" type="data" format="tabular" label="The input matrix"/>

	
       	<param argument="-o" type="select"  label="Format for the output image">
        	<option value="png">PNG</option>
        	<option value="pdf">PDF</option>
        	<option value="svg">SVG</option>
        </param>

	<!--input_type-->
		<param argument="-t" type="select" label="The input type can be a data matrix or distance matrix">
            <option value="data_matrix" selected="true">Data Matrix</option>
            <option value="distance_matrix">Distance Matrix</option>
        </param>

		<param argument="--fname_row" type="integer" value="0" label="Row number containing the names of the features" help="Specify -1 if no names are present in the matrix"/>

		<param argument="--sname_row" type="integer" value="0" label="Column number containing the names of the samples" help="Specify -1 if no names are present in the matrix"/>

		<param argument="--metadata_rows" type="text" optional="True" label="Row numbers to use as metadata [No input means no metadata]"/>

		<param argument="--skip_rows" type="integer" optional="True" label="Row numbers to skip (0-indexed, comma separated) from the input file [No input means no rows skipped]"/>

		<param argument="--sperc" type="integer" value="90" label="Percentile of sample value distribution for sample selection"/>

		<param argument="--fperc" type="integer" value="90" label=" Percentile of feature value distribution for feature selection"/>

		<param argument="--stop" type="integer" optional="True" label="Number of top samples to select (ordering based on percentile specified by percentile of sample value distribution)"/>

		<param argument="--ftop" type="integer" optional="True" label="Number of top features to select (ordering percentile specified by percentile of feature value distribution)"/>

		<param argument="--def_na" type="float" optional="True" label="Set the default value for missing values" help=" [No input means no replacement]"/>

		<param argument="--f_dist_f" type="select" label="Distance function for features">
		    <option value="euclidean">Euclidean</option>
			<option value="correlation" selected="true">Correlation</option>
			<option value="hamming">Hamming</option>
			<option value="braycurtis">Braycurtis</option>
    		<option value="minkowski">Minkowski</option>
    		<option value="cityblock">Cityblock</option>
    		<option value="seuclidean">Seuclidean</option>
    		<option value="sqeuclidean">Sqeuclidean</option>
    		<option value="jaccard">Jaccard</option>
    		<option value="chebyshev">Chebyshev</option>
    		<option value="canberra">Canberra</option>
    		<option value="mahalanobis">Mahalanobis</option>
    		<option value="yule">Yule</option>
    		<option value="matching">Matching</option>
    		<option value="dice">Dice</option>
    		<option value="kulsinski">Kulsinski</option>
    		<option value="rogerstanimoto">Rogerstanimoto</option>
    		<option value="russellrao">Russellrao</option>
    		<option value="sokalmichener">Sokalmichener</option>
    		<option value="sokalsneath">Sokalsneath</option>
    		<option value="wminkowski">Wminkowski</option>
    		<option value="ward">Ward</option>
    	</param>

		<param argument="--s_dist_f" type="select" label="Distance function for sample">
			 <option value="euclidean">Euclidean</option>
			<option value="correlation" selected="true">Correlation</option>
			<option value="hamming">Hamming</option>
			<option value="braycurtis">Braycurtis</option>
    		<option value="minkowski">Minkowski</option>
    		<option value="cityblock">Cityblock</option>
    		<option value="seuclidean">Seuclidean</option>
    		<option value="sqeuclidean">Sqeuclidean</option>
    		<option value="jaccard">Jaccard</option>
    		<option value="chebyshev">Chebyshev</option>
    		<option value="canberra">Canberra</option>
    		<option value="mahalanobis">Mahalanobis</option>
    		<option value="yule">Yule</option>
    		<option value="matching">Matching</option>
    		<option value="dice">Dice</option>
    		<option value="kulsinski">Kulsinski</option>
    		<option value="rogerstanimoto">Rogerstanimoto</option>
    		<option value="russellrao">Russellrao</option>
    		<option value="sokalmichener">Sokalmichener</option>
    		<option value="sokalsneath">Sokalsneath</option>
    		<option value="wminkowski">Wminkowski</option>
    		<option value="ward">Ward</option>
    	</param>

		<param argument="--load_dist_matrix_f" type="data" format="tabular" optional="true" label="Distance matrix to be used for features"/>

        <param argument="--load_dist_matrix_s" type="data" format="tabular" optional="true" label="Distance matrix to be used for samples"/>

		<param argument="--load_pickled_dist_matrix_f" type="data" format="tabular" optional="true" label="Distance matrix to be used for features as previously saved as pickle file using hclust2 itself"/>

		<param argument="--load_pickled_dist_matrix_s" type="data" format="tabular" optional="true" label="Distance matrix to be used for samples as previously saved as pickle file using hclust2 itself"/>

	<!--distance parameters-save-->
		<param argument="--save_pickled_dist_matrix_f" type="boolean" truevalue="--save_pickled_dist_matrix_f" falsevalue="" label="Save the distance matrix for features"/>

		<param argument="--save_pickled_dist_matrix_s" type="boolean" truevalue="--save_pickled_dist_matrix_s" falsevalue="" label="Save the distance matrix for samples"/>

	<!--clustering parameters-->
		<param argument="--no_fclustering" type="boolean" truevalue="--no_fclustering" falsevalue="" label="Avoid clustering features"/>

		<param argument="--no_sclustering" type="boolean" truevalue="--no_sclustering" falsevalue="" label="Avoid clustering samples"/>

    	<param argument="--flinkage" type="select" label="Linkage method for feature clustering">
    		<option value="single">Single</option>
    		<option value="complete">Complete</option>
    		<option value="average" selected="true">Average</option>
    		<option value="weighted">Weighted</option>
    		<option value="centroid">Centroid</option>
    		<option value="median">Median</option>
    		<option value="ward">Ward</option>
		</param>

		<param argument="--slinkage" type="select" label="Linkage method for sample clustering">
    		<option value="single">Single</option>
    		<option value="complete">Complete</option>
    		<option value="average" selected="true">Average</option>
    		<option value="weighted">Weighted</option>
    		<option value="centroid">Centroid</option>
    		<option value="median">Median</option>
    		<option value="ward">Ward</option>
		</param>

		<param argument="--dpi" type="integer" value="150" label="Image resolution in dpi"/>

		<param argument="--log_scale" type="boolean" truevalue="--log_scale" falsevalue="" label="Log scale"/>

		<param argument="--title" type="text" optional="true" label="Title of the plot"/>

		<param argument="--sqrt_scale" type="boolean" truevalue="--sqrt_scale" falsevalue="" label="Square root scale"/>

		<param argument="--no_slabels" type="boolean" truevalue="--no_slabels" falsevalue="" label="Do not show sample labels"/>

		<param argument="--no_flabels" type="boolean" truevalue="--no_flabels" falsevalue="" label="Do not show feature labels"/>

		<param argument="--minv" type="float" optional="true" label="Minimum value to display in the color map"/>

		<param argument="--maxv" type="float" optional="true" label="Maximum value to display in the color map"/>

		<param argument="--max_slabel_len" type="integer" value="15" label="Max number of chars to report for sample labels"/>

		<param argument="--max_flabel_len" type="integer" value="15" label="Max number of chars to report for feature labels"/>

		<param argument="--flabel_size" type="integer" value="10" label="Feature label font size"/>

		<param argument="--slabel_size" type="integer" value="10" label="Sample label font size"/>

		<param argument="--fdend_width" type="float" value="1" label="Width of the feature dendrogram" help="1 meaning 100% of default heatmap width"/>

		<param argument="--sdend_height" type="float" value="1" label="Height of the sample dendrogram" help="1 meaning 100% of default heatmap height"/>

		<param argument="--metadata_height" type="float" value="0.05" label="Height of the metadata panel" help="0.05 meaning 5% of default heatmap height"/>

		<param argument="--metadata_separation" type="float" value="0.001" label="Distance between the metadata and data panels" help="0.001 meaning 0.1% of default heatmap height"/>

		<param argument="--image_size" type="float" value="8" label="Size of the largest between width and eight size for the image in inches"/>

		<param argument="--cell_aspect_ratio" type="float" value="1.0" label="Aspect ratio between width and height for the cells of the heatmap"/>

		<param argument="-c" type="select" label="Color Map [default bbcry]">
			<option value="Accent">Accent</option>
    		<option value="Blues">Blues</option>
    		<option value="BrBG">BrBG</option>
    		<option value="BuPu">BuPu</option>
    		<option value="Dark2">Dark2</option>
    		<option value="Greens">Greens</option>
    		<option value="Greys">Greys</option>
    		<option value="OrRd">OrRd</option>
    		<option value="Oranges">Oranges</option>
    		<option value="PRGn">PRGn</option>
    		<option value="BuPu">BuPu</option>
    		<option value="Paired">Paired</option>
    		<option value="Pastel1">Pastel1</option>
    		<option value="Pastel2">Pastel2</option>
    		<option value="PiYG">PiYG</option>
    		<option value="PuBu">PuBu</option>
    		<option value="PuBuGn">PuBuGn</option>
    		<option value="PuOr">PuOr</option>
    		<option value="PuRd">PuRd</option>
    		<option value="Purples">Purples</option>
    		<option value="RdBu">RdBu</option>
    		<option value="RdGy">RdGy</option>
    		<option value="RdPu">RdPu</option>
    		<option value="RdYlBu">RdYlBu</option>
    		<option value="RdYlGn">RdYlGn</option>
    		<option value="Reds">Reds</option>
    		<option value="Set1">Set1</option>
    		<option value="Set2">Set2</option>
    		<option value="Set3">Set3</option>
    		<option value="Spectral">Spectral</option>
    		<option value="YlGn">YlGn</option>
    		<option value="YlGnBu">YlGnBu</option>
    		<option value="YlOrBr">YlOrBr</option>
    		<option value="YlOrRd">YlOrRd</option>
    		<option value="afmhot">afmhot</option>
    		<option value="autumn">autumn</option>
    		<option value="binary">binary</option>
    		<option value="bone">bone</option>
    		<option value="brg">brg</option>
    		<option value="bwr">bwr</option>
    		<option value="cool">cool</option>
    		<option value="copper">copper</option>
    		<option value="flag">flag</option>
    		<option value="gist_earth">gist_earth</option>
    		<option value="gist_gray">gist_gray</option>
    		<option value="gist_heat">gist_heat</option>
    		<option value="gist_ncar">gist_ncar</option>
    		<option value="gist_rainbow">gist_rainbow</option>
    		<option value="gist_stern">gist_stern</option>
    		<option value="gist_yarg">gist_yarg</option>
    		<option value="gnuplot">gnuplot</option>
    		<option value="gnuplot2">gnuplot2</option>
    		<option value="gray">gray</option>
    		<option value="hot">hot</option>
    		<option value="hsv">hsv</option>
    		<option value="jet">jet</option>
    		<option value="ocean">ocean</option>
    		<option value="pink">pink</option>
    		<option value="prism">prism</option>
    		<option value="rainbow">rainbow</option>
    		<option value="seismic">seismic</option>
    		<option value="spectral">spectral</option>
    		<option value="spring">spring</option>
    		<option value="summer">summer</option>
    		<option value="terrain">terrain</option>
    		<option value="winter">winter</option>
    		<option value="bbcyr">bbcyr</option>
    		<option value="bbcry" selected="true">bbcry</option>
    		<option value="bcry">bcry</option>
		</param>

		<param argument="--bottom_c" type="data" format="data" optional="true" label="Color to use for cells below the minimum value of the scale [No input means no bottom color of the scale]"/>
	
		<param argument="--top_c" type="data" format="data" optional="true" label=" Color to use for cells below the maximum value of the scale [No input means no bottom color of the scale]"/>

		<param argument="--nan_c" type="data" format="data" optional="true" label="Color to use for nan cells"/>

    </inputs>

    <outputs>

		<data format="png" name="out_png" label="${tool.name} on ${on_string}: Output image file">
			 <filter>o == "png"</filter>
		</data>
        <data format="pdf" name="out_pdf" from_work_dir="output.pdf" label="${tool.name} on ${on_string}: Output image file">
			 <filter>o == "pdf"</filter>
		</data>
		<data format="svg" name="out_svg" from_work_dir="output.svg" label="${tool.name} on ${on_string}: Output image file">
			 <filter>o == "svg"</filter>
		</data>

		<!--<data format="png" argument="-o" label="${tool.name} on ${on_string}: Output image file"/>-->
			 

    	<data format="png" name="legend_file"  label="${tool.name} on ${on_string}: Output file for the legend of the provided metadata"/>

    	<data name="out_table" format="tabular" label="${tool.name} on ${on_string}: Processed data matrix">
    		<filter>(save_pickled_dist_matrix_f is True and save_pickled_dist_matrix_s is True</filter>
    	</data>
   

    </outputs>
    <tests>
        <test>
            <param name="i" value="HMP.species.txt"/>
            <param name="skip_rows" value="1"/>
            <param name="ftop" value="50"/>
            <param name="f_dist_f" value="correlation"/>
            <param name="s_dist_f" value="braycurtis"/>
            <param name="cell_aspect_ratio" value="9"/>
            <param name="sqrt_scale" value="true"/>
			<param name="metadata_rows" value="2,3,4"/>
			<param name="max_flabel_len" value="100"/>
			<param name="metadata_height" value="0.075"/>
			<param name="minv" value="0.01"/>
			<param name="no_slabels" value="true"/>
			<param name="dpi" value="300"/>
            <output name="legend_file" file="HMP.sqrt_scale.legend.png"/>
            <output name="out_png" file="HMP.sqrt_scale.png"/>
        </test>

        <!--<test>
            <param name="i" value="HMP.species.txt"/>
            <param name="skip_rows" value="1"/>
            <param name="ftop" value="50"/>
            <param name="f_dist_f" value="correlation"/>
            <param name="s_dist_f" value="braycurtis"/>
            <param name="cell_aspect_ratio" value="9"/>
            <param name="log_scale" value="true"/>
            <param name="fperc" value="99"/>
            <param name="flabel_size" value="4"/>
			<param name="metadata_rows" value="2,3,4"/>
			<param name="max_flabel_len" value="100"/>
			<param name="metadata_height" value="0.075"/>
			<param name="minv" value="0.01"/>
			<param name="no_slabels" value="true"/>
			<param name="dpi" value="300"/>
            <output name="legend_file" file="HMP.log_scale.legend.png"/>
            <output name="out_png" file="HMP.log_scale.png"/>
        </test>-->

    </tests>

    <help><![CDATA[

    **What it does**

    Hclust2 is a handy tool for plotting heat-maps with several useful options to produce high quality figures that can be used in publication. For more information, check ` <https://bitbucket.org/nsegata/hclust2>`_.
    ]]></help>

    <citations>
		<citation type="doi">TODO</citation>
    </citations>
</tool>