<tool id="juicer_hiccups" name="Annotating loops" version="0.1.0">
    <requirements>
    </requirements>
    <stdio>
        <exit_code range="1:" />
    </stdio>
    <command><![CDATA[
        java -jar juicebox_tools.jar hiccups "$hic_files" 
    ]]></command>
    <inputs>
        <param name="hic_files" type="data" format="hic" label="HiC file(s)"/>
        <section name="advanced_options" title="Advanced options" expanded="False">
            <param name="m" type="integer" label="Maximum size of the submatrix within the chromosome passed on to GPU (Must be an even number greater than 40 to prevent issues from running the CUDA kernel)."/>
            <param name="c" type="text" label="Chromosome(s) on which HiCCUPS will be run."/>
            <param name="r" type="integer" label="Resolution(s) for which HiCCUPS will be run."/>
            <param name="k" type="select" label="Normalization">
                <option value="NONE" selected="True">None</option>
                <option value="VC">VC</option>
                <option value="VC_square">VC_square</option>
                <option value="KR">KR</option>
            </param>
            <param name="f" type="integer" label="FDR values actually corresponding to max_q_val"/>
            <param name="p" type="integer" label="Peak width used for finding enriched pixels."/>
            <param name="i" type="integer" label="Window width used for finding enriched pixels."/>
            <param name="t" type="float" label="Thresholds for merging loop lists of different resolutions. "/>
            <param name="d" type="integer" label="Distances used for merging nearby pixels to a centroid."/>
        
        </section>
        
    </inputs>
    <outputs>
    </outputs>
    <help><![CDATA[
        The required arguments are:

<HiC file(s)>: Address of HiC file(s) which should end with ".hic". This is the file you will load into Juicebox. URLs or local addresses may be used.

<outputLoopsList>: Final list of all loops found by HiCCUPS. Can be visualized directly in Juicebox as a 2D annotation. By default, various values critical to the HICCUPS algorithm are saved as attributes for each loop found. These can be disabled using the suppress flag below.

The optional arguments are:
-m <int> Maximum size of the submatrix within the chromosome passed on to GPU (Must be an even number greater than 40 to prevent issues from running the CUDA kernel). The upper limit will depend on your GPU. Dedicated GPUs should be able to use values such as 500, 1000, or 2048 without trouble. Integrated GPUs are unlikely to run sizes larger than 90 or 100. Matrix size will not effect the result, merely the time it takes for hiccups. Larger values (with a dedicated GPU) will run fastest.
-c <String(s)> Chromosome(s) on which HiCCUPS will be run. The number/letter for the chromosome can be used with or without appending the "chr" string. Multiple chromosomes can be specified using commas (e.g. 1,chr2,X,chrY)
-r <int(s)> Resolution(s) for which HiCCUPS will be run. Multiple resolutions can be specified using commas (e.g. 25000,10000,5000). Due to the nature of DNA looping, it is unlikely that loops will be found at lower resolutions (i.e. 50kB or 100kB) IMPORTANT: if multiple resolutions are used, the flags below can be configured so that different parameters are used for the different resolutions.
-k <NONE/VC/VC_SQRT/KR> Normalizations (case sensitive) that can be selected. Generally, KR (Knight-Ruiz) balancing should be used when available.
-f <int(s)> FDR values actually corresponding to max_q_val (i.e. for 1% FDR use 0.01, for 10%FDR use 0.1). Different FDR values can be used for each resolution using commas. (e.g "-r 5000,10000 -f 0.1,0.15" would run HiCCUPS at 10% FDR for resolution 5000 and 15% FDR for resolution 10000)
-p <int(s)> Peak width used for finding enriched pixels in HiCCUPS. Different peak widths can be used for each resolution using commas. (e.g "-r 5000,10000 -p 4,2" would run at peak width 4 for resolution 5000 and peak width 2 for resolution 10000)
-i <int(s)> Window width used for finding enriched pixels in HiCCUPS. Different window widths can be used for each resolution using commas. (e.g "-r 5000,10000 -p 10,6" would run at window width 10 for resolution 5000 and window width 6 for resolution 10000)
-t <floats> Thresholds for merging loop lists of different resolutions. Four values must be given, separated by commas (e.g. 0.02,1.5,1.75,2). These thresholds (in order) represent: - threshold allowed for sum of FDR values of the horizontal, vertical, donut, and bottom left filters (an accepted loop must stay below this threshold) - threshold ratio that both the horizontal and vertical filters must exceed - threshold ratio that both the donut and bottom left filters must exceed - threshold ratio that at least one of the donut and bottom left filters must exceed
-d <ints> Distances used for merging nearby pixels to a centroid. Different distances can be used for each resolution using commas. (e.g "-r 5000,10000 -d 20000,21000” would merge pixels within 20kB of each other at 5kB resolution and within 21kB at 10kB resolution.

Defaults:

Medium resolution maps:
-m 512
-c (all chromosomes)
-r 10000
-k KR
-f .1
-p 2
-i 5
-t 0.02,1.5,1.75,2
-d 20000,20000,50000

High resolution maps:
-m 512
-c (all chromosomes)
-r 5000,10000
-k KR
-f .1,.1
-p 4,2
-i 7,5
-t 0.02,1.5,1.75,2
-d 20000,20000,50000
    ]]></help>
</tool>