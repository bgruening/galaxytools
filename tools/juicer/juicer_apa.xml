<tool id="Juicer_apa" name="HiC" version="0.1.0">

    <description>Conducting aggregate peak analysis</description>

    <requirements>
    </requirements>
    <stdio>
        <exit_code range="1:" />
    </stdio>
    <command>
      <![CDATA[
          mkdir input_dir
          &&
          mkdir output_dir
          &&
          java -jar juicebox_tools.7.0.jar
            apa
            input_dir
            input_dir
            output_dir
            #if $adv.n
                -n $adv.n
            #end if
            #if $adv.x
                -x $adv.x
            #end if
            #if $adv.w
                -w $adv.w
            #end if
            #if $adv.r
                -r $adv.r
            #end if
            #if $adv.c
                -c $adv.c
            #end if
            #if $adv.k
                -k $adv.k
            #end if

      ]]></command>
    <inputs>
        <param type="data" name="HiC_files" multiple="true" label="HiC file(s)" format="hic">
            <help>
              <![CDATA[
              "Address of HiC file(s) which should end with ".hic". This is the file you will load into Juicebox. URLs or local addresses may be used."
              ]]>
            </help>
        </param>
        <param type="data" name="PeaksFile" label="Peak File" format="txt" help="List of peaks in standard 2D feature format (chr1 x1 x2 chr2 y1 y2 color ...) " />
        <section name="adv" title="Advanced Options">
            <param argument="-n" type="integer" optional="True"
              label="Minimum distance away from the diagonal." value="30"
              help="Used to filter peaks too close to the diagonal. Units are in terms of the provided resolution. (e.g. -n 30 @ resolution 5kB will filter loops within 30(5000/sqrt(2)) units of the diagonal)" />
            <param argument="-x" type="integer" optional="True"
              label="Maximum distance away from the diagonal." value=""
              help="Used to filter peaks too close to the diagonal. Units are in terms of the provided resolution. (e.g. -n 30 @ resolution 5kB will filter loops further than 30(5000/sqrt(2)) units of the diagonal)" />
            <param argument="-w" type="integer" optional="True"
              label="Units of Resolustion." value="10"
              help="Width of region to be aggregated around the specified loops" />
            <param argument="-r" type="integer" optional="True"
              label="Resolution for APA." value="10000"
              help="Multiple resolutions can be specified using commas (e.g. 5000,10000)" />
            <param argument="-c" type="text" optional="True" label="Chromosomes(s) on which APA will be run." value="">
                <help>
                  <![CDATA[
                  "The number/letter for the chromosome can be used with or without appending the "chr" string. Multiple chromosomes can be specified using commas (e.g. 1,chr2,X,chrY)"
                  ]]>
                </help>
            </param>
            <param name="-k" type="select" label="Normalization" help="Normalizations that can be selected. Generally, KR (Knight-Ruiz) balancing should be used when available. ">
                <option value="KR" selected="true">KR</option>
                <option value="">None</option>
                <option value="VC">VC</option>
                <option value="VC_SQRT">VC_SQRT</option>
            </param>
        </section>
    </inputs>
    <outputs>
        <collection name="output" type="list" label="Results">
            <discover_datasets pattern="(?P&lt;designation&gt;.+)\.*" format="*" directory="output_dir" />
        </collection>
    </outputs>
    <tests>
        <test>
            <param name="Hic_files" value="test-data/HIC006.hic" ftype="hic" />
            <param name="PeaksFiles" value="test-data/all_loops.txt" ftype="txt" />
            <param name="output" value="XXXXXXXXXX" ftype="XXX" />
        </test>
    </tests>
    <help><![CDATA[
        **Juicer** is a platform for analyzing kilobase resolution Hi-C data. In this distribution, we include the pipeline for generating Hi-C maps from fastq raw data files and command line tools for feature annotation on the Hi-C maps.
    ]]></help>
</tool>
