<tool id="biostudies_upload" name="BioStudies upload" version="0.1" profile="25.1">
    <description>using aspera client</description>
    <xrefs>
        <xref type="bio.tools">aspera</xref>
    </xrefs>
    <requirements>
        <requirement type="package" version="4.20.0">aspera-cli</requirement>
        <!--credentials name="biostudies" version="0.1" label="BioStudies" description="The BioStudies database holds descriptions of biological studies, links to data from these studies in other databases at EMBL-EBI or outside, as well as data that do not fit in the structured archives at EMBL-EBI. The database can accept a wide range of types of studies described via a simple format. It also enables manuscript authors to submit supplementary information and link to it from the publication.">
            <secret name="password" inject_as_env="BIOSTUDIES_PASS" optional="false" label="Password" description="Your password to upload to BioStudies" />
            <secret name="secret_dir" inject_as_env="BIOSTUDIES_SECRET_DIR" optional="false" label="Secret Directory" description="Secret directory root where your files will be uploaded" />
        </credentials-->
    </requirements>
    <command><![CDATA[
        echo \$BIOSTUDIES_PASS &&
        echo \$BIOSTUDIES_SECRET_DIR &&
        echo '$input_zarr' &&
        ascli config ascp install &&
ascli server upload '$input_zarr' --url=ssh://fasp.ebi.ac.uk:33001 --username=bs-upload --password=vsr5nW7Y --to-folder=/67/aaaaeb-b3a8-4ad7-be99-e0583d0b896c-a29738/$target_dir 2>&1 | tee $stdout
    ]]>
    </command>
    <inputs>
        <param name="input_zarr" type="data" format="tiff" label="Input image" />
        <param name="target_dir" type="text" optional="false" label="Target remote folder name" />
    </inputs>
    <outputs>
        <data name="stdout" format="txt" label="Upload Log" />
    </outputs>
    <tests>
        <test expect_num_outputs="1">
            <param name="input_zarr" value="smaller_MT_image.tiff"/>
            <param name="target_dir" value="galaxy_tool_test"/>
            <output name="stdout">
                <assert_contents>
                    <has_text text="100%"/>
                </assert_contents>
            </output>
        </test>
    </tests>
    <help><![CDATA[
**What it does**

Upload images to BioStudies

------

**Inputs**

Imaging data in tiff, png, jpeg, zarr formats 

------

**Outputs**

A log file with progress.


    ]]>    </help>
    <citations>
        <citation type="doi">10.1126/science.abl5197</citation>
    </citations>
</tool>