<tool id="biostudies_upload" name="BioStudies upload" version="0.1" profile="25.1">
    <description>Upload imaging data to BioStudies using Aspera high-speed transfer</description>
    <xrefs>
        <xref type="bio.tools">aspera</xref>
    </xrefs>
    <requirements>
        <requirement type="package" version="4.20.0">aspera-cli</requirement>
        <credentials name="biostudies" version="0.1" label="BioStudies" description="The BioStudies database holds descriptions of biological studies, links to data from these studies in other databases at EMBL-EBI or outside, as well as data that do not fit in the structured archives at EMBL-EBI. The database can accept a wide range of types of studies described via a simple format. It also enables manuscript authors to submit supplementary information and link to it from the publication.">
            <secret name="password" inject_as_env="BIOSTUDIES_PASS" optional="false" label="Password" description="Your password to upload to BioStudies"/>
            <secret name="secret_dir" inject_as_env="BIOSTUDIES_SECRET_DIR" optional="false" label="Secret Directory" description="Secret directory root where your files will be uploaded"/>
        </credentials>
    </requirements>
    <command><![CDATA[
ascli config ascp install &&
ascli server upload '$input_zarr' --url=ssh://fasp.ebi.ac.uk:33001 --username=bs-upload --password=$BIOSTUDIES_PASS --to-folder=$BIOSTUDIES_SECRET_DIR/$target_dir 2>&1 | tee $stdout
    ]]>
    </command>
    <inputs>
        <param name="input_zarr" type="data" format="tiff" label="Input image"/>
        <param name="target_dir" type="text" optional="false" label="Target remote folder name"/>
    </inputs>
    <outputs>
        <data name="stdout" format="txt" label="Upload Log"/>
    </outputs>
    <tests>
        <test expect_num_outputs="1">
            <param name="input_zarr" value="smaller_MT_image.tiff"/>
            <param name="target_dir" value="galaxy_tool_test"/>
            <output name="stdout">
                <assert_contents>
                    <has_text text="100%"/>
                </assert_contents>
            </output>
        </test>
    </tests>
    <help><![CDATA[
**What it does**

This tool uploads imaging data to the BioStudies database at EMBL-EBI using the Aspera high-speed file transfer protocol. BioStudies is a repository that holds descriptions of biological studies and associated data that may not fit in other structured archives.

The tool uses Aspera CLI to securely transfer your imaging files to a specified directory in your BioStudies submission area.

------

**Inputs**

- **Input image**: Imaging data file in TIFF, PNG, JPEG, or ZARR format
- **Target remote folder name**: Name of the destination folder in your BioStudies secret directory where files will be uploaded

------

**Outputs**

- **Upload Log**: A text file containing the transfer process details.

------

**Authentication**

This tool requires BioStudies credentials configured in Galaxy:

- **Password**: Your BioStudies upload password
- **Secret Directory**: The root directory path where you have permission to upload files in BioStudies

------

**Additional Information**

The tool uses Aspera's FASP (Fast and Secure Protocol) technology for accelerated file transfer, which is particularly useful for large imaging datasets.

For more information about BioStudies, visit: https://www.ebi.ac.uk/biostudies/


    ]]>    </help>
    <citations>
        <citation type="doi">10.1126/science.abl5197</citation>
    </citations>
</tool>
