<tool id="gspan" name="structure_to_gspan" version="0.1">
    <requirements>
        <requirement type="package" version="0.2.0">graphclust-wrappers</requirement>
    </requirements>
    <stdio>
        <exit_code range="1:" />
    </stdio>
    <command>
    <![CDATA[
      structure_to_gspan.pl
            --input-file '$dataFile'
            --input-format 
            $i_abstr
            $i_stacks
            $seq_graph_t
            -group $group


    ]]>
    </command>
    <inputs>
        <param type="data" name="dataFile" format="data" label="Sequence and Structure input file in the prediction tool format" />
        <param name="inputFormat" type="text" value="rnafold"
            label="  Sequence Structure format of the input. Allowed format: rnafold" help="-input-format"/>
        <param name="i_stacks" truevalue="-stack" falsevalue="" checked="True"  type="boolean"
            label="Add stacking information to graphs." help="-stack"/>
        <param name="i_abstr" truevalue="-abstr" falsevalue=""  type="boolean"
            label="Add abstract structure graphs to the single shrep graph instances." help="-abstr"/>
        <param name="seq_graph_t" truevalue="-seq-graph-t" falsevalue="" checked="True"  type="boolean"
            label="Add for each 't #' a graph which contains no structure" help="--seq-graph-t"/>
        <param name="group" type="integer" value="10000"
            label="Group size" help="by default 10000"/>
    </inputs>
    <outputs>
        <collection name="gspan_compressed" type="list" label="GSPAN Groups" >
            <discover_datasets pattern="(?P&lt;name&gt;.*)\.bz2$" directory="GSPAN_Outputs" />
        </collection>
    </outputs>
    <tests>
        <test>
            <param name="dataFile" value="sample_3.struct"/>
            <param name="i_stacks" value="True" />
            <param name="i_abstr" value="False" />
            <param name="seq_graph_t" value="True" />
            <param name="group" value="10000" />
            <output_collection name="gspan_compressed" type="list">
                <element name="1.group.gspan" file="sample_3.1.group.gspan.bz2"/>
            </output_collection>
        </test>
    </tests>
    <help>
    <![CDATA[

**What it does**
For each pair of sequence and structure provided in the input file
and convert them into GSPAN format graphs.


**Parameters**

                HELP
        -help   brief help message
        -man    full documentation

        COMPULSORY
        -input-file     <STRING> e.g. "sequence.struct"
                        The sequence and structure data, the output of structure prediction tool.

        OPTIONS
        -input-format Sequence Structure format of the input. Allowed format: "rnafold"
        -stack          Adds stacking information to graphs. This adds an additional
                        vertex (type P) for each pair of stacked base-pairs and four edges
                        (type p) from each of the involved bases to the new vertex.
        -seq-graph-win  add for each window a graph which contains no structure
        -seq-graph-t    add for each 't #' a graph which contains no structure
        -seq-graph-alph change the alphabet of unstructured graphs
        -annotate               <STRING> annotation.tab
                                        A file with annotations to be added as abstract graphs
                                        on the sequence leven (if given) and on the structure
                                        (SHREP) level. The format is has the following TAB-delimited
                                        columns: SEQID, START, END, NAMESPACE#LABEL.
                                        Labels with the same name-space and SEQID form connected
                                        components, which is a sequence of label vertices ordered
                                        by the START position in the sequence.
        -abstr                  Add abstract structure graphs to the single shrep graph
                                        instances.
        -nostr                  Calculate no structures, only add sequence information,
                                        if this is given, then -seq-graph-win AND/OR -seq-graph-t
                                        are required.
        -match-shape    <SHAPE>
                all seqs/windows will be constraint folded into that shape via
                RNAshapes (if structure is given in another way this struct will be kept),
                if this shape is not possible within given energy range, produce a
                specific t graph with only one vertex 'X'. By this the instance
                becomes very unsimilar to all other graphs (for knn)
        -vp     enable graph computation with viewpoints:
                svmsgdnspdk will center on those nucleotides that are given
                via capital letters and ignore those given as lowercase letters
        -tmp            <STRING> e.g. "/scratch/1/sita/tmp"
                        A directory for writing temporary files
        -o              <STRING> e.g. "ProjectX/MySequences/GSPAN/"
                        Output directory for gspan files containing graphs.
        -group          <INTEGER> e.g. 5
                        Combine/group that number of input seqs into 1 gspan file
                        output name is then '<INT>.group.gspan.bz2'

        -stdout         send graphs to stdout instead of writing to files
        -ignore-header  don't write fasta id part after first space to gspan
        -debug          additional debug output


        DEFAULT VALUES
        -tmp    "/var/tmp/fasta2shrep"
        -o              "CURRENT_DIR/GSPAN_Outputs/"



    ]]>
    </help>
    <citations>
        <citation type="doi">10.1093/bioinformatics/bts224</citation>
        <citation type="doi">10.1093/bioinformatics/btu649</citation>
    </citations>
</tool>
