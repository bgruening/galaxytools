<tool id="bg_platypus" name="Platypus" version="0.0.11">
    <description>Find transmembrane domains in protein sequences</description>
    <requirements>
        <requirement type="package">platypus</requirement>
    </requirements>
    <stdio>
        <!-- Anything other than zero is an error -->
        <exit_code range="1:" />
        <exit_code range=":-1" />
    </stdio>
    <command interpreter="python">
      Platypus.py callVariants
        -output $outfile
--refFile $reference_genome 
            --nCPU \${GALAXY_SLOTS:-4}


  --regions=REGIONS     region as comma-separated list of chr:start-end, or
                        just list of chr, or nothing
  --skipRegionsFile=SKIPREGIONSFILE
                        region as comma-separated list of chr:start-end, or
                        just list of chr, or nothing
  --bamFiles=BAMFILES   (Required) Comma-delimited list of bam file names
  --bufferSize=BUFFERSIZE
                        Data will be buffered in regions of this size
  --minReads=MINREADS   Minimum number of supporting reads required before a
                        variant candidate will be considered.
  --maxReads=MAXREADS   Maximium coverage in window
  --verbosity=VERBOSITY
                        Level of logging
  --printAlignments=PRINTALIGNMENTS
                        If 1, then alignments of reads to haplotypes will be
                        printed to the log file
  --maxReadLength=RLEN  Maximum read length
  --logFileName=LOGFILENAME
                        Name of log file
  --source=SOURCEFILE   vcf file(s) to get candidates from

  --parseNCBI=PARSENCBI
  --compressReads=COMPRESSREADS
                        If this is set to 1, then all reads will be
                        compressed, and decompressd on demand. This will slow
                        things down, but reduce memory usage.
  --qualBinSize=QUALBINSIZE
                        This sets the granularity used when compressing
                        quality scores. If > 1 then quality compression is
                        lossy
  --maxSize=MAXSIZE     Largest variant to consider
  --largeWindows=LARGEWINDOWS
                        If set to 1, window size can be up to 'maxSize'
  --maxVariants=MAXVARIANTS
                        Maximium variants to consider in a given window
  --coverageSamplingLevel=COVERAGESAMPLINGLEVEL
                        Downsample to this level of coverage when filtering
                        haplotypes in divergent regions.
  --maxHaplotypes=MAXHAPLOTYPES
                        Maximium haplotypes to consider in a given window
  --skipDifficultWindows=SKIPDIFFICULTWINDOWS
                        If set to 1, skip windows with > maxVariants
                        candidates
  --getVariantsFromBAMs=GETVARIANTSFROMBAMS
                        If set to TRUE (default), variant candidates will be
                        generated from BAMs as well as any other inputs
  --genSNPs=GENSNPS     If set to TRUE (default), SNP candidates will be
                        considered
  --genIndels=GENINDELS
                        If set to TRUE (default), Indel candidates will be
                        considered
  --mergeClusteredVariants=MERGECLUSTEREDVARIANTS
                        If set to 1, variant-containing windows which are
                        close together will be merged, resulting in slower,
                        more accurate variant calls in diverse regions
  --useIndelErrorModel=USEINDELERRORMODEL
                        If set to 1, the new indel error model will be used
  --minFlank=MINFLANK   Flank size for indel candidates
  --filterVarsByCoverage=FILTERVARSBYCOVERAGE
                        If 1, Platypus filters variants in difficult regions
                        by the number of times each variant is seen.
  --filteredReadsFrac=FILTEREDREADSFRAC
                        If > this fraction of reads are filtered in a given
                        window, the 'badReads filter is triggered.
  --maxVarDist=MAXVARDIST
                        Max distance between variants to be considered in the
                        same window
  --minVarDist=MINVARDIST
                        Min distance allowed between windows
  --useEMLikelihoods=USEEMLIKELIHOODS
                        If 1, likelihoods computed from EM algorithm will be
                        used to call genotypes for each sample, otherwise
                        likelihoods from individual sample will be used.
  --countOnlyExactIndelMatches=COUNTONLYEXACTINDELMATCHES
                        If 1, only exactly matching indels will be counted in
                        the NV field
  --assemble=ASSEMBLE   If 1, Cortex will be used to assemble variant
                        candidates for Platypus to call.
  --assembleAll=ASSEMBLEALL
                        If 1 then Platypus will assemble all regions.'.
  --assemblyRegionSize=ASSEMBLYREGIONSIZE
                        Size of region to assemble with Cortex
  --assembleBadReads=ASSEMBLEBADREADS
                        If 1, then use filtered 'bad' reads for local assembly
  --assemblerKmerSize=ASSEMBLERKMERSIZE
                        Kmer size to use for cortex assembly'.
  --assembleBrokenPairs=ASSEMBLEBROKENPAIRS
                        If 1, then use broken read pairs for local assembly
  --noCycles=NOCYCLES   If 1, then don't allow cycles in the graph
  --minMapQual=MINMAPQUAL
                        Minimum mapping quality of read. Any reads with map
                        qual below this are ignored
  --minBaseQual=MINBASEQUAL
                        Minimum allowed base-calling quality. Any bases with
                        qual below this are ignored in SNP-calling
  --minGoodQualBases=MINGOODQUALBASES
                        Min bases per read that must have base-quality >= 20.



  --maxGOF=MAXGOF       Max allowed value for goodness-of-fit test. Higher than this triggers GOF filter (Phred-scaled).
  --minPosterior=MINPOSTERIOR  Only variants with posterior >= this will be outpu to the VCF. Value is a Phred-score.
  --sbThreshold=SBTHRESHOLD
                        P-value for strand-bias filtering..
  --scThreshold=SCTHRESHOLD
                        Cut-off for SC filter.
  --abThreshold=ABTHRESHOLD
                        P-value for allele-bias filtering.
  --minVarFreq=MINVARFREQ
                        Variants below this frequency will be flagged as allele-biased
  --badReadsWindow=BADREADSWINDOW
                        Size of window around variant to look for low-quality bases.
  --badReadsThreshold=BADREADSTHRESHOLD
                        Variants where the median minimum quality in a window of badReadsWindow around the variant position falls below this value will be filtered with the flag 'badReads'.
  --rmsmqThreshold=RMSMQTHRESHOLD
                        RMSMQ filter triggers when root-mean-square mapping quality across region containing variant is below this.
  --qdThreshold=QDTHRESHOLD
                        QD filter triggers quality/depth for variant is below this.
  --hapScoreThreshold=HAPSCORETHRESHOLD
                        HapScore filter triggers HapScore for variant is above this.

#bool
  --outputRefCalls=OUTPUTREFCALLS
                        If 1, output block reference calls.
  --trimAdapter=TRIMADAPTER
                        If set to 1, then sets to qual 0 any part of read which exceeds the mapped fragment length. This is mainly useful for trimming adapter sequences
  --trimOverlapping=TRIMOVERLAPPING
                        If set to 1, overlapping paired reads have overlap set to qual 0
  --filterDuplicates=FILTERDUPLICATES
                        If set to 1, duplicate reads will be removed based on the read-pair start and end
  --filterReadsWithUnmappedMates=FILTERREADSWITHUNMAPPEDMATES
                        If set to 1, reads with un-mapped mates will be removed
  --filterReadsWithDistantMates=FILTERREADSWITHDISTANTMATES
                        If set to 1, reads with mates mapped far away will be removed
  --filterReadPairsWithSmallInserts=FILTERREADPAIRSWITHSMALLINSERTS
                        If set to 1, read pairs with insert sizes < one read length will be removed

    </command>
    <inputs>
        <param name="fasta_file" type="data" format="fasta" label="FASTA file of protein sequences"/> 
        <!--
        <param name="version" type="select" display="radio" label="Model version">
            <option value="">Version 1 (old)</option>
            <option value="" selected="True">Version 2 (default)</option>
        </param>
        -->

        <param name="reference_genome" type="select" label="Using reference genome" help="Name of the reference FASTA file used for variant calling. (--refFile)">
              <options from_data_table="fasta_indexes">
                <filter type="data_meta" ref="infile" key="dbkey" column="1" />
                <validator type="no_options" message="No reference genome is available for the build associated with the selected input dataset" />
              </options>
        </param>
        <!--param name="intervals_file" type="data" format="bed" optional="True" label="File containing list of intervals" /-->
        <param name="outputRefCalls" type="integer" value="10000" size="10" label="Window size for local sorting of variants" 
            help="(--outputRefCalls)">
            <validator type="in_range" min="0"/>
        </param>

    </inputs>
    <outputs>
        <data name="outfile" format="vcf" label="${tool.name} on ${on_string}" />
    </outputs>

    <tests>
    </tests>
    <help>
    
**What it does**

Platypus is a tool designed for efficient and accurate variant-detection in high-throughput sequencing data.
By using local realignment of reads and local assembly it achieves both high sensitivity and high specificity.
Platypus can detect SNPs, MNPs, short indels, replacements and (using the assembly option) deletions up to several kb.


    </help>
    <citations>
        <citation type="doi">doi:10.1038/ng.3036</citation>
    </citations>
</tool>
